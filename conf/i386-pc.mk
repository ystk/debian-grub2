# -*- makefile -*-
# Generated by genmk.rb, please don't edit!

COMMON_CFLAGS = -mrtd -mregparm=3

# Images.
pkglib_IMAGES = boot.img cdboot.img diskboot.img lnxboot.img pxeboot.img

# For boot.img.
boot_img_SOURCES = boot/i386/pc/boot.S

clean-image-boot.img.1:
	rm -f boot.img boot.exec boot_img-boot_i386_pc_boot.o

CLEAN_IMAGE_TARGETS += clean-image-boot.img.1

mostlyclean-image-boot.img.1:
	rm -f boot_img-boot_i386_pc_boot.d

MOSTLYCLEAN_IMAGE_TARGETS += mostlyclean-image-boot.img.1

ifneq ($(TARGET_APPLE_CC),1)
boot.img: boot.exec
	$(OBJCOPY) -O $(boot_img_FORMAT) --strip-unneeded -R .note -R .comment -R .note.gnu.build-id -R .reginfo -R .rel.dyn $< $@
else
ifneq (boot.exec,kernel.exec)
boot.img: boot.exec ./grub-macho2img
	./grub-macho2img $< $@
else
boot.img: boot.exec ./grub-macho2img
	./grub-macho2img --bss $< $@
endif
endif

boot.exec: boot_img-boot_i386_pc_boot.o
	$(TARGET_CC) -o $@ $^ $(TARGET_LDFLAGS) $(boot_img_LDFLAGS)

boot_img-boot_i386_pc_boot.o: boot/i386/pc/boot.S $(boot/i386/pc/boot.S_DEPENDENCIES)
	$(TARGET_CC) -Iboot/i386/pc -I$(srcdir)/boot/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(boot_img_ASFLAGS) -DGRUB_FILE=\"boot/i386/pc/boot.S\" -MD -c -o $@ $<
-include boot_img-boot_i386_pc_boot.d

boot_img_ASFLAGS = $(COMMON_ASFLAGS)
boot_img_LDFLAGS = $(COMMON_LDFLAGS) $(TARGET_IMG_LDFLAGS)0x7C00
boot_img_FORMAT = binary

# For pxeboot.img
pxeboot_img_SOURCES = boot/i386/pc/pxeboot.S

clean-image-pxeboot.img.1:
	rm -f pxeboot.img pxeboot.exec pxeboot_img-boot_i386_pc_pxeboot.o

CLEAN_IMAGE_TARGETS += clean-image-pxeboot.img.1

mostlyclean-image-pxeboot.img.1:
	rm -f pxeboot_img-boot_i386_pc_pxeboot.d

MOSTLYCLEAN_IMAGE_TARGETS += mostlyclean-image-pxeboot.img.1

ifneq ($(TARGET_APPLE_CC),1)
pxeboot.img: pxeboot.exec
	$(OBJCOPY) -O $(pxeboot_img_FORMAT) --strip-unneeded -R .note -R .comment -R .note.gnu.build-id -R .reginfo -R .rel.dyn $< $@
else
ifneq (pxeboot.exec,kernel.exec)
pxeboot.img: pxeboot.exec ./grub-macho2img
	./grub-macho2img $< $@
else
pxeboot.img: pxeboot.exec ./grub-macho2img
	./grub-macho2img --bss $< $@
endif
endif

pxeboot.exec: pxeboot_img-boot_i386_pc_pxeboot.o
	$(TARGET_CC) -o $@ $^ $(TARGET_LDFLAGS) $(pxeboot_img_LDFLAGS)

pxeboot_img-boot_i386_pc_pxeboot.o: boot/i386/pc/pxeboot.S $(boot/i386/pc/pxeboot.S_DEPENDENCIES)
	$(TARGET_CC) -Iboot/i386/pc -I$(srcdir)/boot/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(pxeboot_img_ASFLAGS) -DGRUB_FILE=\"boot/i386/pc/pxeboot.S\" -MD -c -o $@ $<
-include pxeboot_img-boot_i386_pc_pxeboot.d

pxeboot_img_ASFLAGS = $(COMMON_ASFLAGS)
pxeboot_img_LDFLAGS = $(COMMON_LDFLAGS) $(TARGET_IMG_LDFLAGS)0x7C00
pxeboot_img_FORMAT = binary

# For diskboot.img.
diskboot_img_SOURCES = boot/i386/pc/diskboot.S

clean-image-diskboot.img.1:
	rm -f diskboot.img diskboot.exec diskboot_img-boot_i386_pc_diskboot.o

CLEAN_IMAGE_TARGETS += clean-image-diskboot.img.1

mostlyclean-image-diskboot.img.1:
	rm -f diskboot_img-boot_i386_pc_diskboot.d

MOSTLYCLEAN_IMAGE_TARGETS += mostlyclean-image-diskboot.img.1

ifneq ($(TARGET_APPLE_CC),1)
diskboot.img: diskboot.exec
	$(OBJCOPY) -O $(diskboot_img_FORMAT) --strip-unneeded -R .note -R .comment -R .note.gnu.build-id -R .reginfo -R .rel.dyn $< $@
else
ifneq (diskboot.exec,kernel.exec)
diskboot.img: diskboot.exec ./grub-macho2img
	./grub-macho2img $< $@
else
diskboot.img: diskboot.exec ./grub-macho2img
	./grub-macho2img --bss $< $@
endif
endif

diskboot.exec: diskboot_img-boot_i386_pc_diskboot.o
	$(TARGET_CC) -o $@ $^ $(TARGET_LDFLAGS) $(diskboot_img_LDFLAGS)

diskboot_img-boot_i386_pc_diskboot.o: boot/i386/pc/diskboot.S $(boot/i386/pc/diskboot.S_DEPENDENCIES)
	$(TARGET_CC) -Iboot/i386/pc -I$(srcdir)/boot/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(diskboot_img_ASFLAGS) -DGRUB_FILE=\"boot/i386/pc/diskboot.S\" -MD -c -o $@ $<
-include diskboot_img-boot_i386_pc_diskboot.d

diskboot_img_ASFLAGS = $(COMMON_ASFLAGS)
diskboot_img_LDFLAGS = $(COMMON_LDFLAGS) $(TARGET_IMG_LDFLAGS)0x8000
diskboot_img_FORMAT = binary

# For lnxboot.img.
lnxboot_img_SOURCES = boot/i386/pc/lnxboot.S

clean-image-lnxboot.img.1:
	rm -f lnxboot.img lnxboot.exec lnxboot_img-boot_i386_pc_lnxboot.o

CLEAN_IMAGE_TARGETS += clean-image-lnxboot.img.1

mostlyclean-image-lnxboot.img.1:
	rm -f lnxboot_img-boot_i386_pc_lnxboot.d

MOSTLYCLEAN_IMAGE_TARGETS += mostlyclean-image-lnxboot.img.1

ifneq ($(TARGET_APPLE_CC),1)
lnxboot.img: lnxboot.exec
	$(OBJCOPY) -O $(lnxboot_img_FORMAT) --strip-unneeded -R .note -R .comment -R .note.gnu.build-id -R .reginfo -R .rel.dyn $< $@
else
ifneq (lnxboot.exec,kernel.exec)
lnxboot.img: lnxboot.exec ./grub-macho2img
	./grub-macho2img $< $@
else
lnxboot.img: lnxboot.exec ./grub-macho2img
	./grub-macho2img --bss $< $@
endif
endif

lnxboot.exec: lnxboot_img-boot_i386_pc_lnxboot.o
	$(TARGET_CC) -o $@ $^ $(TARGET_LDFLAGS) $(lnxboot_img_LDFLAGS)

lnxboot_img-boot_i386_pc_lnxboot.o: boot/i386/pc/lnxboot.S $(boot/i386/pc/lnxboot.S_DEPENDENCIES)
	$(TARGET_CC) -Iboot/i386/pc -I$(srcdir)/boot/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(lnxboot_img_ASFLAGS) -DGRUB_FILE=\"boot/i386/pc/lnxboot.S\" -MD -c -o $@ $<
-include lnxboot_img-boot_i386_pc_lnxboot.d

lnxboot_img_ASFLAGS = $(COMMON_ASFLAGS)
lnxboot_img_LDFLAGS = $(COMMON_LDFLAGS) $(TARGET_IMG_LDFLAGS)0x6000
lnxboot_img_FORMAT = binary

# For cdboot.img.
cdboot_img_SOURCES = boot/i386/pc/cdboot.S

clean-image-cdboot.img.1:
	rm -f cdboot.img cdboot.exec cdboot_img-boot_i386_pc_cdboot.o

CLEAN_IMAGE_TARGETS += clean-image-cdboot.img.1

mostlyclean-image-cdboot.img.1:
	rm -f cdboot_img-boot_i386_pc_cdboot.d

MOSTLYCLEAN_IMAGE_TARGETS += mostlyclean-image-cdboot.img.1

ifneq ($(TARGET_APPLE_CC),1)
cdboot.img: cdboot.exec
	$(OBJCOPY) -O $(cdboot_img_FORMAT) --strip-unneeded -R .note -R .comment -R .note.gnu.build-id -R .reginfo -R .rel.dyn $< $@
else
ifneq (cdboot.exec,kernel.exec)
cdboot.img: cdboot.exec ./grub-macho2img
	./grub-macho2img $< $@
else
cdboot.img: cdboot.exec ./grub-macho2img
	./grub-macho2img --bss $< $@
endif
endif

cdboot.exec: cdboot_img-boot_i386_pc_cdboot.o
	$(TARGET_CC) -o $@ $^ $(TARGET_LDFLAGS) $(cdboot_img_LDFLAGS)

cdboot_img-boot_i386_pc_cdboot.o: boot/i386/pc/cdboot.S $(boot/i386/pc/cdboot.S_DEPENDENCIES)
	$(TARGET_CC) -Iboot/i386/pc -I$(srcdir)/boot/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(cdboot_img_ASFLAGS) -DGRUB_FILE=\"boot/i386/pc/cdboot.S\" -MD -c -o $@ $<
-include cdboot_img-boot_i386_pc_cdboot.d

cdboot_img_ASFLAGS = $(COMMON_ASFLAGS)
cdboot_img_LDFLAGS = $(COMMON_LDFLAGS) $(TARGET_IMG_LDFLAGS)0x7C00
cdboot_img_FORMAT = binary

# For kernel.img.
pkglib_PROGRAMS = kernel.img
kernel_img_SOURCES = kern/i386/pc/startup.S \
	kern/i386/misc.S \
	kern/main.c kern/device.c \
	kern/disk.c kern/dl.c kern/file.c kern/fs.c kern/err.c \
	kern/misc.c kern/mm.c kern/term.c \
	kern/rescue_parser.c kern/rescue_reader.c \
	kern/time.c kern/list.c kern/command.c kern/corecmd.c \
	kern/$(target_cpu)/dl.c kern/i386/pc/init.c kern/i386/pc/mmap.c \
	kern/parser.c kern/partition.c \
	kern/i386/tsc.c kern/i386/pit.c \
	kern/generic/rtc_get_time_ms.c \
	kern/generic/millisleep.c \
	kern/env.c \
	term/i386/pc/console.c term/i386/vga_common.c \
	symlist.c
MOSTLYCLEANFILES += kernel_img-kern_i386_pc_startup.d kernel_img-kern_i386_misc.d kernel_img-kern_main.d kernel_img-kern_device.d kernel_img-kern_disk.d kernel_img-kern_dl.d kernel_img-kern_file.d kernel_img-kern_fs.d kernel_img-kern_err.d kernel_img-kern_misc.d kernel_img-kern_mm.d kernel_img-kern_term.d kernel_img-kern_rescue_parser.d kernel_img-kern_rescue_reader.d kernel_img-kern_time.d kernel_img-kern_list.d kernel_img-kern_command.d kernel_img-kern_corecmd.d kernel_img-kern___target_cpu__dl.d kernel_img-kern_i386_pc_init.d kernel_img-kern_i386_pc_mmap.d kernel_img-kern_parser.d kernel_img-kern_partition.d kernel_img-kern_i386_tsc.d kernel_img-kern_i386_pit.d kernel_img-kern_generic_rtc_get_time_ms.d kernel_img-kern_generic_millisleep.d kernel_img-kern_env.d kernel_img-term_i386_pc_console.d kernel_img-term_i386_vga_common.d kernel_img-symlist.d

kernel_img-kern_i386_pc_startup.o: kern/i386/pc/startup.S $(kern/i386/pc/startup.S_DEPENDENCIES)
	$(TARGET_CC) -Ikern/i386/pc -I$(srcdir)/kern/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(kernel_img_ASFLAGS) -DGRUB_FILE=\"kern/i386/pc/startup.S\" -MD -c -o $@ $<

-include kernel_img-kern_i386_pc_startup.d

kernel_img_OBJECTS += kernel_img-kern_i386_pc_startup.o
kernel_img-kern_i386_misc.o: kern/i386/misc.S $(kern/i386/misc.S_DEPENDENCIES)
	$(TARGET_CC) -Ikern/i386 -I$(srcdir)/kern/i386 $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(kernel_img_ASFLAGS) -DGRUB_FILE=\"kern/i386/misc.S\" -MD -c -o $@ $<

-include kernel_img-kern_i386_misc.d

kernel_img_OBJECTS += kernel_img-kern_i386_misc.o
kernel_img-kern_main.o: kern/main.c $(kern/main.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/main.c\" -MD -c -o $@ $<

-include kernel_img-kern_main.d

kernel_img_OBJECTS += kernel_img-kern_main.o
kernel_img-kern_device.o: kern/device.c $(kern/device.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/device.c\" -MD -c -o $@ $<

-include kernel_img-kern_device.d

kernel_img_OBJECTS += kernel_img-kern_device.o
kernel_img-kern_disk.o: kern/disk.c $(kern/disk.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/disk.c\" -MD -c -o $@ $<

-include kernel_img-kern_disk.d

kernel_img_OBJECTS += kernel_img-kern_disk.o
kernel_img-kern_dl.o: kern/dl.c $(kern/dl.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/dl.c\" -MD -c -o $@ $<

-include kernel_img-kern_dl.d

kernel_img_OBJECTS += kernel_img-kern_dl.o
kernel_img-kern_file.o: kern/file.c $(kern/file.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/file.c\" -MD -c -o $@ $<

-include kernel_img-kern_file.d

kernel_img_OBJECTS += kernel_img-kern_file.o
kernel_img-kern_fs.o: kern/fs.c $(kern/fs.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/fs.c\" -MD -c -o $@ $<

-include kernel_img-kern_fs.d

kernel_img_OBJECTS += kernel_img-kern_fs.o
kernel_img-kern_err.o: kern/err.c $(kern/err.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/err.c\" -MD -c -o $@ $<

-include kernel_img-kern_err.d

kernel_img_OBJECTS += kernel_img-kern_err.o
kernel_img-kern_misc.o: kern/misc.c $(kern/misc.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/misc.c\" -MD -c -o $@ $<

-include kernel_img-kern_misc.d

kernel_img_OBJECTS += kernel_img-kern_misc.o
kernel_img-kern_mm.o: kern/mm.c $(kern/mm.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/mm.c\" -MD -c -o $@ $<

-include kernel_img-kern_mm.d

kernel_img_OBJECTS += kernel_img-kern_mm.o
kernel_img-kern_term.o: kern/term.c $(kern/term.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/term.c\" -MD -c -o $@ $<

-include kernel_img-kern_term.d

kernel_img_OBJECTS += kernel_img-kern_term.o
kernel_img-kern_rescue_parser.o: kern/rescue_parser.c $(kern/rescue_parser.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/rescue_parser.c\" -MD -c -o $@ $<

-include kernel_img-kern_rescue_parser.d

kernel_img_OBJECTS += kernel_img-kern_rescue_parser.o
kernel_img-kern_rescue_reader.o: kern/rescue_reader.c $(kern/rescue_reader.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/rescue_reader.c\" -MD -c -o $@ $<

-include kernel_img-kern_rescue_reader.d

kernel_img_OBJECTS += kernel_img-kern_rescue_reader.o
kernel_img-kern_time.o: kern/time.c $(kern/time.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/time.c\" -MD -c -o $@ $<

-include kernel_img-kern_time.d

kernel_img_OBJECTS += kernel_img-kern_time.o
kernel_img-kern_list.o: kern/list.c $(kern/list.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/list.c\" -MD -c -o $@ $<

-include kernel_img-kern_list.d

kernel_img_OBJECTS += kernel_img-kern_list.o
kernel_img-kern_command.o: kern/command.c $(kern/command.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/command.c\" -MD -c -o $@ $<

-include kernel_img-kern_command.d

kernel_img_OBJECTS += kernel_img-kern_command.o
kernel_img-kern_corecmd.o: kern/corecmd.c $(kern/corecmd.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/corecmd.c\" -MD -c -o $@ $<

-include kernel_img-kern_corecmd.d

kernel_img_OBJECTS += kernel_img-kern_corecmd.o
kernel_img-kern___target_cpu__dl.o: kern/$(target_cpu)/dl.c $(kern/$(target_cpu)/dl.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern/$(target_cpu) -I$(srcdir)/kern/$(target_cpu) $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/$(target_cpu)/dl.c\" -MD -c -o $@ $<

-include kernel_img-kern___target_cpu__dl.d

kernel_img_OBJECTS += kernel_img-kern___target_cpu__dl.o
kernel_img-kern_i386_pc_init.o: kern/i386/pc/init.c $(kern/i386/pc/init.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern/i386/pc -I$(srcdir)/kern/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/i386/pc/init.c\" -MD -c -o $@ $<

-include kernel_img-kern_i386_pc_init.d

kernel_img_OBJECTS += kernel_img-kern_i386_pc_init.o
kernel_img-kern_i386_pc_mmap.o: kern/i386/pc/mmap.c $(kern/i386/pc/mmap.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern/i386/pc -I$(srcdir)/kern/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/i386/pc/mmap.c\" -MD -c -o $@ $<

-include kernel_img-kern_i386_pc_mmap.d

kernel_img_OBJECTS += kernel_img-kern_i386_pc_mmap.o
kernel_img-kern_parser.o: kern/parser.c $(kern/parser.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/parser.c\" -MD -c -o $@ $<

-include kernel_img-kern_parser.d

kernel_img_OBJECTS += kernel_img-kern_parser.o
kernel_img-kern_partition.o: kern/partition.c $(kern/partition.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/partition.c\" -MD -c -o $@ $<

-include kernel_img-kern_partition.d

kernel_img_OBJECTS += kernel_img-kern_partition.o
kernel_img-kern_i386_tsc.o: kern/i386/tsc.c $(kern/i386/tsc.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern/i386 -I$(srcdir)/kern/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/i386/tsc.c\" -MD -c -o $@ $<

-include kernel_img-kern_i386_tsc.d

kernel_img_OBJECTS += kernel_img-kern_i386_tsc.o
kernel_img-kern_i386_pit.o: kern/i386/pit.c $(kern/i386/pit.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern/i386 -I$(srcdir)/kern/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/i386/pit.c\" -MD -c -o $@ $<

-include kernel_img-kern_i386_pit.d

kernel_img_OBJECTS += kernel_img-kern_i386_pit.o
kernel_img-kern_generic_rtc_get_time_ms.o: kern/generic/rtc_get_time_ms.c $(kern/generic/rtc_get_time_ms.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern/generic -I$(srcdir)/kern/generic $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/generic/rtc_get_time_ms.c\" -MD -c -o $@ $<

-include kernel_img-kern_generic_rtc_get_time_ms.d

kernel_img_OBJECTS += kernel_img-kern_generic_rtc_get_time_ms.o
kernel_img-kern_generic_millisleep.o: kern/generic/millisleep.c $(kern/generic/millisleep.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern/generic -I$(srcdir)/kern/generic $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/generic/millisleep.c\" -MD -c -o $@ $<

-include kernel_img-kern_generic_millisleep.d

kernel_img_OBJECTS += kernel_img-kern_generic_millisleep.o
kernel_img-kern_env.o: kern/env.c $(kern/env.c_DEPENDENCIES)
	$(TARGET_CC) -Ikern -I$(srcdir)/kern $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"kern/env.c\" -MD -c -o $@ $<

-include kernel_img-kern_env.d

kernel_img_OBJECTS += kernel_img-kern_env.o
kernel_img-term_i386_pc_console.o: term/i386/pc/console.c $(term/i386/pc/console.c_DEPENDENCIES)
	$(TARGET_CC) -Iterm/i386/pc -I$(srcdir)/term/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"term/i386/pc/console.c\" -MD -c -o $@ $<

-include kernel_img-term_i386_pc_console.d

kernel_img_OBJECTS += kernel_img-term_i386_pc_console.o
kernel_img-term_i386_vga_common.o: term/i386/vga_common.c $(term/i386/vga_common.c_DEPENDENCIES)
	$(TARGET_CC) -Iterm/i386 -I$(srcdir)/term/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"term/i386/vga_common.c\" -MD -c -o $@ $<

-include kernel_img-term_i386_vga_common.d

kernel_img_OBJECTS += kernel_img-term_i386_vga_common.o
kernel_img-symlist.o: symlist.c $(symlist.c_DEPENDENCIES)
	$(TARGET_CC) -I. -I$(srcdir)/. $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(kernel_img_CFLAGS) -DGRUB_FILE=\"symlist.c\" -MD -c -o $@ $<

-include kernel_img-symlist.d

kernel_img_OBJECTS += kernel_img-symlist.o
kernel_img_HEADERS += machine/biosdisk.h machine/vga.h machine/vbe.h \
	machine/pxe.h i386/pit.h machine/kernel.h
kernel_img_CFLAGS = $(COMMON_CFLAGS)  $(TARGET_IMG_CFLAGS)
kernel_img_ASFLAGS = $(COMMON_ASFLAGS)
kernel_img_LDFLAGS += $(COMMON_LDFLAGS) $(TARGET_IMG_LDFLAGS)0x8200 $(COMMON_CFLAGS)

# Utilities.
sbin_UTILITIES = grub-setup

# For grub-setup.
util/i386/pc/grub-setup.c_DEPENDENCIES = grub_setup_init.h
grub_setup_SOURCES = gnulib/progname.c util/i386/pc/grub-setup.c	\
	util/misc.c kern/emu/misc.c kern/emu/getroot.c			\
	kern/emu/hostdisk.c kern/device.c kern/disk.c kern/err.c	\
	kern/misc.c kern/partition.c kern/file.c			\
	kern/emu/mm.c kern/fs.c kern/env.c kern/list.c fs/fshelp.c	\
									\
	fs/affs.c fs/cpio.c fs/ext2.c fs/fat.c fs/hfs.c			\
	fs/hfsplus.c fs/iso9660.c fs/udf.c fs/jfs.c fs/minix.c		\
	fs/nilfs2.c fs/ntfs.c fs/ntfscomp.c fs/reiserfs.c		\
	fs/sfs.c fs/ufs.c fs/ufs2.c fs/xfs.c fs/afs.c			\
	fs/afs_be.c fs/befs.c fs/befs_be.c fs/tar.c			\
									\
	$(GRUB_CONTRIB)/zfs/zfs.c \
	$(GRUB_CONTRIB)/zfs/zfs_lzjb.c \
	$(GRUB_CONTRIB)/zfs/zfs_sha256.c \
	$(GRUB_CONTRIB)/zfs/zfs_fletcher.c \
									\
									\
	partmap/msdos.c partmap/bsdlabel.c partmap/sunpc.c		\
	partmap/gpt.c							\
									\
	disk/raid.c disk/raid5_recover.c disk/raid6_recover.c		\
	disk/mdraid_linux.c disk/lvm.c					\
	util/raid.c util/lvm.c						\
	grub_setup_init.c

clean-utility-grub-setup.1:
	rm -f grub-setup$(EXEEXT) grub_setup-gnulib_progname.o grub_setup-util_i386_pc_grub_setup.o grub_setup-util_misc.o grub_setup-kern_emu_misc.o grub_setup-kern_emu_getroot.o grub_setup-kern_emu_hostdisk.o grub_setup-kern_device.o grub_setup-kern_disk.o grub_setup-kern_err.o grub_setup-kern_misc.o grub_setup-kern_partition.o grub_setup-kern_file.o grub_setup-kern_emu_mm.o grub_setup-kern_fs.o grub_setup-kern_env.o grub_setup-kern_list.o grub_setup-fs_fshelp.o grub_setup-fs_affs.o grub_setup-fs_cpio.o grub_setup-fs_ext2.o grub_setup-fs_fat.o grub_setup-fs_hfs.o grub_setup-fs_hfsplus.o grub_setup-fs_iso9660.o grub_setup-fs_udf.o grub_setup-fs_jfs.o grub_setup-fs_minix.o grub_setup-fs_nilfs2.o grub_setup-fs_ntfs.o grub_setup-fs_ntfscomp.o grub_setup-fs_reiserfs.o grub_setup-fs_sfs.o grub_setup-fs_ufs.o grub_setup-fs_ufs2.o grub_setup-fs_xfs.o grub_setup-fs_afs.o grub_setup-fs_afs_be.o grub_setup-fs_befs.o grub_setup-fs_befs_be.o grub_setup-fs_tar.o grub_setup-__GRUB_CONTRIB__zfs_zfs.o grub_setup-__GRUB_CONTRIB__zfs_zfs_lzjb.o grub_setup-__GRUB_CONTRIB__zfs_zfs_sha256.o grub_setup-__GRUB_CONTRIB__zfs_zfs_fletcher.o grub_setup-partmap_msdos.o grub_setup-partmap_bsdlabel.o grub_setup-partmap_sunpc.o grub_setup-partmap_gpt.o grub_setup-disk_raid.o grub_setup-disk_raid5_recover.o grub_setup-disk_raid6_recover.o grub_setup-disk_mdraid_linux.o grub_setup-disk_lvm.o grub_setup-util_raid.o grub_setup-util_lvm.o grub_setup-grub_setup_init.o

CLEAN_UTILITY_TARGETS += clean-utility-grub-setup.1

mostlyclean-utility-grub-setup.1:
	rm -f grub_setup-gnulib_progname.d grub_setup-util_i386_pc_grub_setup.d grub_setup-util_misc.d grub_setup-kern_emu_misc.d grub_setup-kern_emu_getroot.d grub_setup-kern_emu_hostdisk.d grub_setup-kern_device.d grub_setup-kern_disk.d grub_setup-kern_err.d grub_setup-kern_misc.d grub_setup-kern_partition.d grub_setup-kern_file.d grub_setup-kern_emu_mm.d grub_setup-kern_fs.d grub_setup-kern_env.d grub_setup-kern_list.d grub_setup-fs_fshelp.d grub_setup-fs_affs.d grub_setup-fs_cpio.d grub_setup-fs_ext2.d grub_setup-fs_fat.d grub_setup-fs_hfs.d grub_setup-fs_hfsplus.d grub_setup-fs_iso9660.d grub_setup-fs_udf.d grub_setup-fs_jfs.d grub_setup-fs_minix.d grub_setup-fs_nilfs2.d grub_setup-fs_ntfs.d grub_setup-fs_ntfscomp.d grub_setup-fs_reiserfs.d grub_setup-fs_sfs.d grub_setup-fs_ufs.d grub_setup-fs_ufs2.d grub_setup-fs_xfs.d grub_setup-fs_afs.d grub_setup-fs_afs_be.d grub_setup-fs_befs.d grub_setup-fs_befs_be.d grub_setup-fs_tar.d grub_setup-__GRUB_CONTRIB__zfs_zfs.d grub_setup-__GRUB_CONTRIB__zfs_zfs_lzjb.d grub_setup-__GRUB_CONTRIB__zfs_zfs_sha256.d grub_setup-__GRUB_CONTRIB__zfs_zfs_fletcher.d grub_setup-partmap_msdos.d grub_setup-partmap_bsdlabel.d grub_setup-partmap_sunpc.d grub_setup-partmap_gpt.d grub_setup-disk_raid.d grub_setup-disk_raid5_recover.d grub_setup-disk_raid6_recover.d grub_setup-disk_mdraid_linux.d grub_setup-disk_lvm.d grub_setup-util_raid.d grub_setup-util_lvm.d grub_setup-grub_setup_init.d

MOSTLYCLEAN_UTILITY_TARGETS += mostlyclean-utility-grub-setup.1

grub_setup_OBJECTS += grub_setup-gnulib_progname.o grub_setup-util_i386_pc_grub_setup.o grub_setup-util_misc.o grub_setup-kern_emu_misc.o grub_setup-kern_emu_getroot.o grub_setup-kern_emu_hostdisk.o grub_setup-kern_device.o grub_setup-kern_disk.o grub_setup-kern_err.o grub_setup-kern_misc.o grub_setup-kern_partition.o grub_setup-kern_file.o grub_setup-kern_emu_mm.o grub_setup-kern_fs.o grub_setup-kern_env.o grub_setup-kern_list.o grub_setup-fs_fshelp.o grub_setup-fs_affs.o grub_setup-fs_cpio.o grub_setup-fs_ext2.o grub_setup-fs_fat.o grub_setup-fs_hfs.o grub_setup-fs_hfsplus.o grub_setup-fs_iso9660.o grub_setup-fs_udf.o grub_setup-fs_jfs.o grub_setup-fs_minix.o grub_setup-fs_nilfs2.o grub_setup-fs_ntfs.o grub_setup-fs_ntfscomp.o grub_setup-fs_reiserfs.o grub_setup-fs_sfs.o grub_setup-fs_ufs.o grub_setup-fs_ufs2.o grub_setup-fs_xfs.o grub_setup-fs_afs.o grub_setup-fs_afs_be.o grub_setup-fs_befs.o grub_setup-fs_befs_be.o grub_setup-fs_tar.o grub_setup-__GRUB_CONTRIB__zfs_zfs.o grub_setup-__GRUB_CONTRIB__zfs_zfs_lzjb.o grub_setup-__GRUB_CONTRIB__zfs_zfs_sha256.o grub_setup-__GRUB_CONTRIB__zfs_zfs_fletcher.o grub_setup-partmap_msdos.o grub_setup-partmap_bsdlabel.o grub_setup-partmap_sunpc.o grub_setup-partmap_gpt.o grub_setup-disk_raid.o grub_setup-disk_raid5_recover.o grub_setup-disk_raid6_recover.o grub_setup-disk_mdraid_linux.o grub_setup-disk_lvm.o grub_setup-util_raid.o grub_setup-util_lvm.o grub_setup-grub_setup_init.o

grub_setup-gnulib_progname.o: gnulib/progname.c $(gnulib/progname.c_DEPENDENCIES)
	$(CC) -Ignulib -I$(srcdir)/gnulib $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"gnulib/progname.c\" -MD -c -o $@ $<
-include grub_setup-gnulib_progname.d

grub_setup-util_i386_pc_grub_setup.o: util/i386/pc/grub-setup.c $(util/i386/pc/grub-setup.c_DEPENDENCIES)
	$(CC) -Iutil/i386/pc -I$(srcdir)/util/i386/pc $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"util/i386/pc/grub-setup.c\" -MD -c -o $@ $<
-include grub_setup-util_i386_pc_grub_setup.d

grub_setup-util_misc.o: util/misc.c $(util/misc.c_DEPENDENCIES)
	$(CC) -Iutil -I$(srcdir)/util $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"util/misc.c\" -MD -c -o $@ $<
-include grub_setup-util_misc.d

grub_setup-kern_emu_misc.o: kern/emu/misc.c $(kern/emu/misc.c_DEPENDENCIES)
	$(CC) -Ikern/emu -I$(srcdir)/kern/emu $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"kern/emu/misc.c\" -MD -c -o $@ $<
-include grub_setup-kern_emu_misc.d

grub_setup-kern_emu_getroot.o: kern/emu/getroot.c $(kern/emu/getroot.c_DEPENDENCIES)
	$(CC) -Ikern/emu -I$(srcdir)/kern/emu $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"kern/emu/getroot.c\" -MD -c -o $@ $<
-include grub_setup-kern_emu_getroot.d

grub_setup-kern_emu_hostdisk.o: kern/emu/hostdisk.c $(kern/emu/hostdisk.c_DEPENDENCIES)
	$(CC) -Ikern/emu -I$(srcdir)/kern/emu $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"kern/emu/hostdisk.c\" -MD -c -o $@ $<
-include grub_setup-kern_emu_hostdisk.d

grub_setup-kern_device.o: kern/device.c $(kern/device.c_DEPENDENCIES)
	$(CC) -Ikern -I$(srcdir)/kern $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"kern/device.c\" -MD -c -o $@ $<
-include grub_setup-kern_device.d

grub_setup-kern_disk.o: kern/disk.c $(kern/disk.c_DEPENDENCIES)
	$(CC) -Ikern -I$(srcdir)/kern $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"kern/disk.c\" -MD -c -o $@ $<
-include grub_setup-kern_disk.d

grub_setup-kern_err.o: kern/err.c $(kern/err.c_DEPENDENCIES)
	$(CC) -Ikern -I$(srcdir)/kern $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"kern/err.c\" -MD -c -o $@ $<
-include grub_setup-kern_err.d

grub_setup-kern_misc.o: kern/misc.c $(kern/misc.c_DEPENDENCIES)
	$(CC) -Ikern -I$(srcdir)/kern $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"kern/misc.c\" -MD -c -o $@ $<
-include grub_setup-kern_misc.d

grub_setup-kern_partition.o: kern/partition.c $(kern/partition.c_DEPENDENCIES)
	$(CC) -Ikern -I$(srcdir)/kern $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"kern/partition.c\" -MD -c -o $@ $<
-include grub_setup-kern_partition.d

grub_setup-kern_file.o: kern/file.c $(kern/file.c_DEPENDENCIES)
	$(CC) -Ikern -I$(srcdir)/kern $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"kern/file.c\" -MD -c -o $@ $<
-include grub_setup-kern_file.d

grub_setup-kern_emu_mm.o: kern/emu/mm.c $(kern/emu/mm.c_DEPENDENCIES)
	$(CC) -Ikern/emu -I$(srcdir)/kern/emu $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"kern/emu/mm.c\" -MD -c -o $@ $<
-include grub_setup-kern_emu_mm.d

grub_setup-kern_fs.o: kern/fs.c $(kern/fs.c_DEPENDENCIES)
	$(CC) -Ikern -I$(srcdir)/kern $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"kern/fs.c\" -MD -c -o $@ $<
-include grub_setup-kern_fs.d

grub_setup-kern_env.o: kern/env.c $(kern/env.c_DEPENDENCIES)
	$(CC) -Ikern -I$(srcdir)/kern $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"kern/env.c\" -MD -c -o $@ $<
-include grub_setup-kern_env.d

grub_setup-kern_list.o: kern/list.c $(kern/list.c_DEPENDENCIES)
	$(CC) -Ikern -I$(srcdir)/kern $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"kern/list.c\" -MD -c -o $@ $<
-include grub_setup-kern_list.d

grub_setup-fs_fshelp.o: fs/fshelp.c $(fs/fshelp.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/fshelp.c\" -MD -c -o $@ $<
-include grub_setup-fs_fshelp.d

grub_setup-fs_affs.o: fs/affs.c $(fs/affs.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/affs.c\" -MD -c -o $@ $<
-include grub_setup-fs_affs.d

grub_setup-fs_cpio.o: fs/cpio.c $(fs/cpio.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/cpio.c\" -MD -c -o $@ $<
-include grub_setup-fs_cpio.d

grub_setup-fs_ext2.o: fs/ext2.c $(fs/ext2.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/ext2.c\" -MD -c -o $@ $<
-include grub_setup-fs_ext2.d

grub_setup-fs_fat.o: fs/fat.c $(fs/fat.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/fat.c\" -MD -c -o $@ $<
-include grub_setup-fs_fat.d

grub_setup-fs_hfs.o: fs/hfs.c $(fs/hfs.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/hfs.c\" -MD -c -o $@ $<
-include grub_setup-fs_hfs.d

grub_setup-fs_hfsplus.o: fs/hfsplus.c $(fs/hfsplus.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/hfsplus.c\" -MD -c -o $@ $<
-include grub_setup-fs_hfsplus.d

grub_setup-fs_iso9660.o: fs/iso9660.c $(fs/iso9660.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/iso9660.c\" -MD -c -o $@ $<
-include grub_setup-fs_iso9660.d

grub_setup-fs_udf.o: fs/udf.c $(fs/udf.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/udf.c\" -MD -c -o $@ $<
-include grub_setup-fs_udf.d

grub_setup-fs_jfs.o: fs/jfs.c $(fs/jfs.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/jfs.c\" -MD -c -o $@ $<
-include grub_setup-fs_jfs.d

grub_setup-fs_minix.o: fs/minix.c $(fs/minix.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/minix.c\" -MD -c -o $@ $<
-include grub_setup-fs_minix.d

grub_setup-fs_nilfs2.o: fs/nilfs2.c $(fs/nilfs2.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/nilfs2.c\" -MD -c -o $@ $<
-include grub_setup-fs_nilfs2.d

grub_setup-fs_ntfs.o: fs/ntfs.c $(fs/ntfs.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/ntfs.c\" -MD -c -o $@ $<
-include grub_setup-fs_ntfs.d

grub_setup-fs_ntfscomp.o: fs/ntfscomp.c $(fs/ntfscomp.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/ntfscomp.c\" -MD -c -o $@ $<
-include grub_setup-fs_ntfscomp.d

grub_setup-fs_reiserfs.o: fs/reiserfs.c $(fs/reiserfs.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/reiserfs.c\" -MD -c -o $@ $<
-include grub_setup-fs_reiserfs.d

grub_setup-fs_sfs.o: fs/sfs.c $(fs/sfs.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/sfs.c\" -MD -c -o $@ $<
-include grub_setup-fs_sfs.d

grub_setup-fs_ufs.o: fs/ufs.c $(fs/ufs.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/ufs.c\" -MD -c -o $@ $<
-include grub_setup-fs_ufs.d

grub_setup-fs_ufs2.o: fs/ufs2.c $(fs/ufs2.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/ufs2.c\" -MD -c -o $@ $<
-include grub_setup-fs_ufs2.d

grub_setup-fs_xfs.o: fs/xfs.c $(fs/xfs.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/xfs.c\" -MD -c -o $@ $<
-include grub_setup-fs_xfs.d

grub_setup-fs_afs.o: fs/afs.c $(fs/afs.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/afs.c\" -MD -c -o $@ $<
-include grub_setup-fs_afs.d

grub_setup-fs_afs_be.o: fs/afs_be.c $(fs/afs_be.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/afs_be.c\" -MD -c -o $@ $<
-include grub_setup-fs_afs_be.d

grub_setup-fs_befs.o: fs/befs.c $(fs/befs.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/befs.c\" -MD -c -o $@ $<
-include grub_setup-fs_befs.d

grub_setup-fs_befs_be.o: fs/befs_be.c $(fs/befs_be.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/befs_be.c\" -MD -c -o $@ $<
-include grub_setup-fs_befs_be.d

grub_setup-fs_tar.o: fs/tar.c $(fs/tar.c_DEPENDENCIES)
	$(CC) -Ifs -I$(srcdir)/fs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"fs/tar.c\" -MD -c -o $@ $<
-include grub_setup-fs_tar.d

grub_setup-__GRUB_CONTRIB__zfs_zfs.o: $(GRUB_CONTRIB)/zfs/zfs.c $($(GRUB_CONTRIB)/zfs/zfs.c_DEPENDENCIES)
	$(CC) -I$(GRUB_CONTRIB)/zfs -I$(srcdir)/$(GRUB_CONTRIB)/zfs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"$(GRUB_CONTRIB)/zfs/zfs.c\" -MD -c -o $@ $<
-include grub_setup-__GRUB_CONTRIB__zfs_zfs.d

grub_setup-__GRUB_CONTRIB__zfs_zfs_lzjb.o: $(GRUB_CONTRIB)/zfs/zfs_lzjb.c $($(GRUB_CONTRIB)/zfs/zfs_lzjb.c_DEPENDENCIES)
	$(CC) -I$(GRUB_CONTRIB)/zfs -I$(srcdir)/$(GRUB_CONTRIB)/zfs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"$(GRUB_CONTRIB)/zfs/zfs_lzjb.c\" -MD -c -o $@ $<
-include grub_setup-__GRUB_CONTRIB__zfs_zfs_lzjb.d

grub_setup-__GRUB_CONTRIB__zfs_zfs_sha256.o: $(GRUB_CONTRIB)/zfs/zfs_sha256.c $($(GRUB_CONTRIB)/zfs/zfs_sha256.c_DEPENDENCIES)
	$(CC) -I$(GRUB_CONTRIB)/zfs -I$(srcdir)/$(GRUB_CONTRIB)/zfs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"$(GRUB_CONTRIB)/zfs/zfs_sha256.c\" -MD -c -o $@ $<
-include grub_setup-__GRUB_CONTRIB__zfs_zfs_sha256.d

grub_setup-__GRUB_CONTRIB__zfs_zfs_fletcher.o: $(GRUB_CONTRIB)/zfs/zfs_fletcher.c $($(GRUB_CONTRIB)/zfs/zfs_fletcher.c_DEPENDENCIES)
	$(CC) -I$(GRUB_CONTRIB)/zfs -I$(srcdir)/$(GRUB_CONTRIB)/zfs $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"$(GRUB_CONTRIB)/zfs/zfs_fletcher.c\" -MD -c -o $@ $<
-include grub_setup-__GRUB_CONTRIB__zfs_zfs_fletcher.d

grub_setup-partmap_msdos.o: partmap/msdos.c $(partmap/msdos.c_DEPENDENCIES)
	$(CC) -Ipartmap -I$(srcdir)/partmap $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"partmap/msdos.c\" -MD -c -o $@ $<
-include grub_setup-partmap_msdos.d

grub_setup-partmap_bsdlabel.o: partmap/bsdlabel.c $(partmap/bsdlabel.c_DEPENDENCIES)
	$(CC) -Ipartmap -I$(srcdir)/partmap $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"partmap/bsdlabel.c\" -MD -c -o $@ $<
-include grub_setup-partmap_bsdlabel.d

grub_setup-partmap_sunpc.o: partmap/sunpc.c $(partmap/sunpc.c_DEPENDENCIES)
	$(CC) -Ipartmap -I$(srcdir)/partmap $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"partmap/sunpc.c\" -MD -c -o $@ $<
-include grub_setup-partmap_sunpc.d

grub_setup-partmap_gpt.o: partmap/gpt.c $(partmap/gpt.c_DEPENDENCIES)
	$(CC) -Ipartmap -I$(srcdir)/partmap $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"partmap/gpt.c\" -MD -c -o $@ $<
-include grub_setup-partmap_gpt.d

grub_setup-disk_raid.o: disk/raid.c $(disk/raid.c_DEPENDENCIES)
	$(CC) -Idisk -I$(srcdir)/disk $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"disk/raid.c\" -MD -c -o $@ $<
-include grub_setup-disk_raid.d

grub_setup-disk_raid5_recover.o: disk/raid5_recover.c $(disk/raid5_recover.c_DEPENDENCIES)
	$(CC) -Idisk -I$(srcdir)/disk $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"disk/raid5_recover.c\" -MD -c -o $@ $<
-include grub_setup-disk_raid5_recover.d

grub_setup-disk_raid6_recover.o: disk/raid6_recover.c $(disk/raid6_recover.c_DEPENDENCIES)
	$(CC) -Idisk -I$(srcdir)/disk $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"disk/raid6_recover.c\" -MD -c -o $@ $<
-include grub_setup-disk_raid6_recover.d

grub_setup-disk_mdraid_linux.o: disk/mdraid_linux.c $(disk/mdraid_linux.c_DEPENDENCIES)
	$(CC) -Idisk -I$(srcdir)/disk $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"disk/mdraid_linux.c\" -MD -c -o $@ $<
-include grub_setup-disk_mdraid_linux.d

grub_setup-disk_lvm.o: disk/lvm.c $(disk/lvm.c_DEPENDENCIES)
	$(CC) -Idisk -I$(srcdir)/disk $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"disk/lvm.c\" -MD -c -o $@ $<
-include grub_setup-disk_lvm.d

grub_setup-util_raid.o: util/raid.c $(util/raid.c_DEPENDENCIES)
	$(CC) -Iutil -I$(srcdir)/util $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"util/raid.c\" -MD -c -o $@ $<
-include grub_setup-util_raid.d

grub_setup-util_lvm.o: util/lvm.c $(util/lvm.c_DEPENDENCIES)
	$(CC) -Iutil -I$(srcdir)/util $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"util/lvm.c\" -MD -c -o $@ $<
-include grub_setup-util_lvm.d

grub_setup-grub_setup_init.o: grub_setup_init.c $(grub_setup_init.c_DEPENDENCIES)
	$(CC) -I. -I$(srcdir)/. $(CPPFLAGS) $(CFLAGS) -DGRUB_UTIL=1 $(grub_setup_CFLAGS) -DGRUB_FILE=\"grub_setup_init.c\" -MD -c -o $@ $<
-include grub_setup-grub_setup_init.d

grub_setup_CFLAGS = -I$(GRUB_CONTRIB)/zfs/include

sbin_SCRIPTS += grub-install
grub_install_SOURCES = util/grub-install.in
CLEANFILES += grub-install

grub-install: util/grub-install.in $(util/grub-install.in_DEPENDENCIES) config.status
	./config.status --file=-:util/grub-install.in | sed -e 's,@pkglib_DATA@,$(pkglib_DATA),g' > $@
	chmod +x $@


bin_SCRIPTS += grub-mkrescue
grub_mkrescue_SOURCES = util/grub-mkrescue.in
CLEANFILES += grub-mkrescue

grub-mkrescue: util/grub-mkrescue.in $(util/grub-mkrescue.in_DEPENDENCIES) config.status
	./config.status --file=-:util/grub-mkrescue.in | sed -e 's,@pkglib_DATA@,$(pkglib_DATA),g' > $@
	chmod +x $@


pkglib_MODULES = biosdisk.mod chain.mod 				\
	halt.mod				\
	vbe.mod vbetest.mod vbeinfo.mod 		\
	vga.mod				\
	aout.mod bsd.mod pxe.mod pxecmd.mod datetime.mod  	\
	ata_pthru.mod hdparm.mod 		\
	usb.mod uhci.mod ohci.mod usbtest.mod usbms.mod usb_keyboard.mod \
	efiemu.mod mmap.mod acpi.mod drivemap.mod

# For drivemap.mod.
drivemap_mod_SOURCES = commands/i386/pc/drivemap.c \
                       commands/i386/pc/drivemap_int13h.S

clean-module-drivemap.mod.1:
	rm -f drivemap.mod mod-drivemap.o mod-drivemap.c pre-drivemap.o drivemap_mod-commands_i386_pc_drivemap.o drivemap_mod-commands_i386_pc_drivemap_int13h.o und-drivemap.lst

CLEAN_MODULE_TARGETS += clean-module-drivemap.mod.1

clean-module-drivemap.mod-symbol.1:
	rm -f def-drivemap.lst

CLEAN_MODULE_TARGETS += clean-module-drivemap.mod-symbol.1
DEFSYMFILES += def-drivemap.lst
mostlyclean-module-drivemap.mod.1:
	rm -f drivemap_mod-commands_i386_pc_drivemap.d drivemap_mod-commands_i386_pc_drivemap_int13h.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-drivemap.mod.1
UNDSYMFILES += und-drivemap.lst

ifeq ($(TARGET_NO_MODULES), yes)
drivemap.mod: pre-drivemap.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(drivemap_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-drivemap.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
drivemap.mod: pre-drivemap.o mod-drivemap.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(drivemap_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-drivemap.o mod-drivemap.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
drivemap.mod: pre-drivemap.o mod-drivemap.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(drivemap_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-drivemap.o mod-drivemap.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-drivemap.o: $(drivemap_mod_DEPENDENCIES) drivemap_mod-commands_i386_pc_drivemap.o drivemap_mod-commands_i386_pc_drivemap_int13h.o
	-rm -f $@
	$(TARGET_CC) $(drivemap_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ drivemap_mod-commands_i386_pc_drivemap.o drivemap_mod-commands_i386_pc_drivemap_int13h.o

mod-drivemap.o: mod-drivemap.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(drivemap_mod_CFLAGS) -DGRUB_FILE=\"mod-drivemap.c\" -c -o $@ $<

mod-drivemap.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'drivemap' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-drivemap.lst: pre-drivemap.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 drivemap/' > $@
else
def-drivemap.lst: pre-drivemap.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 drivemap/' > $@
endif

und-drivemap.lst: pre-drivemap.o
	echo 'drivemap' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

drivemap_mod-commands_i386_pc_drivemap.o: commands/i386/pc/drivemap.c $(commands/i386/pc/drivemap.c_DEPENDENCIES)
	$(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(drivemap_mod_CFLAGS) -DGRUB_FILE=\"commands/i386/pc/drivemap.c\" -MD -c -o $@ $<
-include drivemap_mod-commands_i386_pc_drivemap.d

clean-module-drivemap_mod-commands_i386_pc_drivemap-extra.1:
	rm -f cmd-drivemap_mod-commands_i386_pc_drivemap.lst fs-drivemap_mod-commands_i386_pc_drivemap.lst partmap-drivemap_mod-commands_i386_pc_drivemap.lst handler-drivemap_mod-commands_i386_pc_drivemap.lst parttool-drivemap_mod-commands_i386_pc_drivemap.lst video-drivemap_mod-commands_i386_pc_drivemap.lst terminal-drivemap_mod-commands_i386_pc_drivemap.lst

CLEAN_MODULE_TARGETS += clean-module-drivemap_mod-commands_i386_pc_drivemap-extra.1

COMMANDFILES += cmd-drivemap_mod-commands_i386_pc_drivemap.lst
FSFILES += fs-drivemap_mod-commands_i386_pc_drivemap.lst
PARTTOOLFILES += parttool-drivemap_mod-commands_i386_pc_drivemap.lst
PARTMAPFILES += partmap-drivemap_mod-commands_i386_pc_drivemap.lst
HANDLERFILES += handler-drivemap_mod-commands_i386_pc_drivemap.lst
TERMINALFILES += terminal-drivemap_mod-commands_i386_pc_drivemap.lst
VIDEOFILES += video-drivemap_mod-commands_i386_pc_drivemap.lst

cmd-drivemap_mod-commands_i386_pc_drivemap.lst: commands/i386/pc/drivemap.c $(commands/i386/pc/drivemap.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(drivemap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh drivemap > $@ || (rm -f $@; exit 1)

fs-drivemap_mod-commands_i386_pc_drivemap.lst: commands/i386/pc/drivemap.c $(commands/i386/pc/drivemap.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(drivemap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh drivemap > $@ || (rm -f $@; exit 1)

parttool-drivemap_mod-commands_i386_pc_drivemap.lst: commands/i386/pc/drivemap.c $(commands/i386/pc/drivemap.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(drivemap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh drivemap > $@ || (rm -f $@; exit 1)

partmap-drivemap_mod-commands_i386_pc_drivemap.lst: commands/i386/pc/drivemap.c $(commands/i386/pc/drivemap.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(drivemap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh drivemap > $@ || (rm -f $@; exit 1)

handler-drivemap_mod-commands_i386_pc_drivemap.lst: commands/i386/pc/drivemap.c $(commands/i386/pc/drivemap.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(drivemap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh drivemap > $@ || (rm -f $@; exit 1)

terminal-drivemap_mod-commands_i386_pc_drivemap.lst: commands/i386/pc/drivemap.c $(commands/i386/pc/drivemap.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(drivemap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh drivemap > $@ || (rm -f $@; exit 1)

video-drivemap_mod-commands_i386_pc_drivemap.lst: commands/i386/pc/drivemap.c $(commands/i386/pc/drivemap.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(drivemap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh drivemap > $@ || (rm -f $@; exit 1)

drivemap_mod-commands_i386_pc_drivemap_int13h.o: commands/i386/pc/drivemap_int13h.S $(commands/i386/pc/drivemap_int13h.S_DEPENDENCIES)
	$(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(drivemap_mod_ASFLAGS) -DGRUB_FILE=\"commands/i386/pc/drivemap_int13h.S\" -MD -c -o $@ $<
-include drivemap_mod-commands_i386_pc_drivemap_int13h.d

clean-module-drivemap_mod-commands_i386_pc_drivemap_int13h-extra.1:
	rm -f cmd-drivemap_mod-commands_i386_pc_drivemap_int13h.lst fs-drivemap_mod-commands_i386_pc_drivemap_int13h.lst partmap-drivemap_mod-commands_i386_pc_drivemap_int13h.lst handler-drivemap_mod-commands_i386_pc_drivemap_int13h.lst parttool-drivemap_mod-commands_i386_pc_drivemap_int13h.lst video-drivemap_mod-commands_i386_pc_drivemap_int13h.lst terminal-drivemap_mod-commands_i386_pc_drivemap_int13h.lst

CLEAN_MODULE_TARGETS += clean-module-drivemap_mod-commands_i386_pc_drivemap_int13h-extra.1

COMMANDFILES += cmd-drivemap_mod-commands_i386_pc_drivemap_int13h.lst
FSFILES += fs-drivemap_mod-commands_i386_pc_drivemap_int13h.lst
PARTTOOLFILES += parttool-drivemap_mod-commands_i386_pc_drivemap_int13h.lst
PARTMAPFILES += partmap-drivemap_mod-commands_i386_pc_drivemap_int13h.lst
HANDLERFILES += handler-drivemap_mod-commands_i386_pc_drivemap_int13h.lst
TERMINALFILES += terminal-drivemap_mod-commands_i386_pc_drivemap_int13h.lst
VIDEOFILES += video-drivemap_mod-commands_i386_pc_drivemap_int13h.lst

cmd-drivemap_mod-commands_i386_pc_drivemap_int13h.lst: commands/i386/pc/drivemap_int13h.S $(commands/i386/pc/drivemap_int13h.S_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(drivemap_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh drivemap > $@ || (rm -f $@; exit 1)

fs-drivemap_mod-commands_i386_pc_drivemap_int13h.lst: commands/i386/pc/drivemap_int13h.S $(commands/i386/pc/drivemap_int13h.S_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 -DGRUB_LST_GENERATOR $(TARGET_ASFLAGS) $(drivemap_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh drivemap > $@ || (rm -f $@; exit 1)

parttool-drivemap_mod-commands_i386_pc_drivemap_int13h.lst: commands/i386/pc/drivemap_int13h.S $(commands/i386/pc/drivemap_int13h.S_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(drivemap_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh drivemap > $@ || (rm -f $@; exit 1)

partmap-drivemap_mod-commands_i386_pc_drivemap_int13h.lst: commands/i386/pc/drivemap_int13h.S $(commands/i386/pc/drivemap_int13h.S_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 -DGRUB_LST_GENERATOR $(TARGET_ASFLAGS) $(drivemap_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh drivemap > $@ || (rm -f $@; exit 1)

handler-drivemap_mod-commands_i386_pc_drivemap_int13h.lst: commands/i386/pc/drivemap_int13h.S $(commands/i386/pc/drivemap_int13h.S_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(drivemap_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh drivemap > $@ || (rm -f $@; exit 1)

terminal-drivemap_mod-commands_i386_pc_drivemap_int13h.lst: commands/i386/pc/drivemap_int13h.S $(commands/i386/pc/drivemap_int13h.S_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(drivemap_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh drivemap > $@ || (rm -f $@; exit 1)

video-drivemap_mod-commands_i386_pc_drivemap_int13h.lst: commands/i386/pc/drivemap_int13h.S $(commands/i386/pc/drivemap_int13h.S_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 -DGRUB_LST_GENERATOR $(TARGET_ASFLAGS) $(drivemap_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh drivemap > $@ || (rm -f $@; exit 1)

drivemap_mod_ASFLAGS = $(COMMON_ASFLAGS)
drivemap_mod_CFLAGS = $(COMMON_CFLAGS)
drivemap_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For efiemu.mod.
efiemu_mod_SOURCES = efiemu/main.c efiemu/i386/loadcore32.c \
		     efiemu/i386/loadcore64.c efiemu/i386/pc/cfgtables.c \
		     efiemu/mm.c efiemu/loadcore_common.c efiemu/symbols.c \
		     efiemu/loadcore32.c efiemu/loadcore64.c \
		     efiemu/prepare32.c efiemu/prepare64.c efiemu/pnvram.c \
		     efiemu/i386/coredetect.c

clean-module-efiemu.mod.1:
	rm -f efiemu.mod mod-efiemu.o mod-efiemu.c pre-efiemu.o efiemu_mod-efiemu_main.o efiemu_mod-efiemu_i386_loadcore32.o efiemu_mod-efiemu_i386_loadcore64.o efiemu_mod-efiemu_i386_pc_cfgtables.o efiemu_mod-efiemu_mm.o efiemu_mod-efiemu_loadcore_common.o efiemu_mod-efiemu_symbols.o efiemu_mod-efiemu_loadcore32.o efiemu_mod-efiemu_loadcore64.o efiemu_mod-efiemu_prepare32.o efiemu_mod-efiemu_prepare64.o efiemu_mod-efiemu_pnvram.o efiemu_mod-efiemu_i386_coredetect.o und-efiemu.lst

CLEAN_MODULE_TARGETS += clean-module-efiemu.mod.1

clean-module-efiemu.mod-symbol.1:
	rm -f def-efiemu.lst

CLEAN_MODULE_TARGETS += clean-module-efiemu.mod-symbol.1
DEFSYMFILES += def-efiemu.lst
mostlyclean-module-efiemu.mod.1:
	rm -f efiemu_mod-efiemu_main.d efiemu_mod-efiemu_i386_loadcore32.d efiemu_mod-efiemu_i386_loadcore64.d efiemu_mod-efiemu_i386_pc_cfgtables.d efiemu_mod-efiemu_mm.d efiemu_mod-efiemu_loadcore_common.d efiemu_mod-efiemu_symbols.d efiemu_mod-efiemu_loadcore32.d efiemu_mod-efiemu_loadcore64.d efiemu_mod-efiemu_prepare32.d efiemu_mod-efiemu_prepare64.d efiemu_mod-efiemu_pnvram.d efiemu_mod-efiemu_i386_coredetect.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-efiemu.mod.1
UNDSYMFILES += und-efiemu.lst

ifeq ($(TARGET_NO_MODULES), yes)
efiemu.mod: pre-efiemu.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(efiemu_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-efiemu.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
efiemu.mod: pre-efiemu.o mod-efiemu.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(efiemu_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-efiemu.o mod-efiemu.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
efiemu.mod: pre-efiemu.o mod-efiemu.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(efiemu_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-efiemu.o mod-efiemu.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-efiemu.o: $(efiemu_mod_DEPENDENCIES) efiemu_mod-efiemu_main.o efiemu_mod-efiemu_i386_loadcore32.o efiemu_mod-efiemu_i386_loadcore64.o efiemu_mod-efiemu_i386_pc_cfgtables.o efiemu_mod-efiemu_mm.o efiemu_mod-efiemu_loadcore_common.o efiemu_mod-efiemu_symbols.o efiemu_mod-efiemu_loadcore32.o efiemu_mod-efiemu_loadcore64.o efiemu_mod-efiemu_prepare32.o efiemu_mod-efiemu_prepare64.o efiemu_mod-efiemu_pnvram.o efiemu_mod-efiemu_i386_coredetect.o
	-rm -f $@
	$(TARGET_CC) $(efiemu_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ efiemu_mod-efiemu_main.o efiemu_mod-efiemu_i386_loadcore32.o efiemu_mod-efiemu_i386_loadcore64.o efiemu_mod-efiemu_i386_pc_cfgtables.o efiemu_mod-efiemu_mm.o efiemu_mod-efiemu_loadcore_common.o efiemu_mod-efiemu_symbols.o efiemu_mod-efiemu_loadcore32.o efiemu_mod-efiemu_loadcore64.o efiemu_mod-efiemu_prepare32.o efiemu_mod-efiemu_prepare64.o efiemu_mod-efiemu_pnvram.o efiemu_mod-efiemu_i386_coredetect.o

mod-efiemu.o: mod-efiemu.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -DGRUB_FILE=\"mod-efiemu.c\" -c -o $@ $<

mod-efiemu.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'efiemu' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-efiemu.lst: pre-efiemu.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 efiemu/' > $@
else
def-efiemu.lst: pre-efiemu.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 efiemu/' > $@
endif

und-efiemu.lst: pre-efiemu.o
	echo 'efiemu' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

efiemu_mod-efiemu_main.o: efiemu/main.c $(efiemu/main.c_DEPENDENCIES)
	$(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -DGRUB_FILE=\"efiemu/main.c\" -MD -c -o $@ $<
-include efiemu_mod-efiemu_main.d

clean-module-efiemu_mod-efiemu_main-extra.1:
	rm -f cmd-efiemu_mod-efiemu_main.lst fs-efiemu_mod-efiemu_main.lst partmap-efiemu_mod-efiemu_main.lst handler-efiemu_mod-efiemu_main.lst parttool-efiemu_mod-efiemu_main.lst video-efiemu_mod-efiemu_main.lst terminal-efiemu_mod-efiemu_main.lst

CLEAN_MODULE_TARGETS += clean-module-efiemu_mod-efiemu_main-extra.1

COMMANDFILES += cmd-efiemu_mod-efiemu_main.lst
FSFILES += fs-efiemu_mod-efiemu_main.lst
PARTTOOLFILES += parttool-efiemu_mod-efiemu_main.lst
PARTMAPFILES += partmap-efiemu_mod-efiemu_main.lst
HANDLERFILES += handler-efiemu_mod-efiemu_main.lst
TERMINALFILES += terminal-efiemu_mod-efiemu_main.lst
VIDEOFILES += video-efiemu_mod-efiemu_main.lst

cmd-efiemu_mod-efiemu_main.lst: efiemu/main.c $(efiemu/main.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh efiemu > $@ || (rm -f $@; exit 1)

fs-efiemu_mod-efiemu_main.lst: efiemu/main.c $(efiemu/main.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh efiemu > $@ || (rm -f $@; exit 1)

parttool-efiemu_mod-efiemu_main.lst: efiemu/main.c $(efiemu/main.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh efiemu > $@ || (rm -f $@; exit 1)

partmap-efiemu_mod-efiemu_main.lst: efiemu/main.c $(efiemu/main.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh efiemu > $@ || (rm -f $@; exit 1)

handler-efiemu_mod-efiemu_main.lst: efiemu/main.c $(efiemu/main.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh efiemu > $@ || (rm -f $@; exit 1)

terminal-efiemu_mod-efiemu_main.lst: efiemu/main.c $(efiemu/main.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh efiemu > $@ || (rm -f $@; exit 1)

video-efiemu_mod-efiemu_main.lst: efiemu/main.c $(efiemu/main.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh efiemu > $@ || (rm -f $@; exit 1)

efiemu_mod-efiemu_i386_loadcore32.o: efiemu/i386/loadcore32.c $(efiemu/i386/loadcore32.c_DEPENDENCIES)
	$(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -DGRUB_FILE=\"efiemu/i386/loadcore32.c\" -MD -c -o $@ $<
-include efiemu_mod-efiemu_i386_loadcore32.d

clean-module-efiemu_mod-efiemu_i386_loadcore32-extra.1:
	rm -f cmd-efiemu_mod-efiemu_i386_loadcore32.lst fs-efiemu_mod-efiemu_i386_loadcore32.lst partmap-efiemu_mod-efiemu_i386_loadcore32.lst handler-efiemu_mod-efiemu_i386_loadcore32.lst parttool-efiemu_mod-efiemu_i386_loadcore32.lst video-efiemu_mod-efiemu_i386_loadcore32.lst terminal-efiemu_mod-efiemu_i386_loadcore32.lst

CLEAN_MODULE_TARGETS += clean-module-efiemu_mod-efiemu_i386_loadcore32-extra.1

COMMANDFILES += cmd-efiemu_mod-efiemu_i386_loadcore32.lst
FSFILES += fs-efiemu_mod-efiemu_i386_loadcore32.lst
PARTTOOLFILES += parttool-efiemu_mod-efiemu_i386_loadcore32.lst
PARTMAPFILES += partmap-efiemu_mod-efiemu_i386_loadcore32.lst
HANDLERFILES += handler-efiemu_mod-efiemu_i386_loadcore32.lst
TERMINALFILES += terminal-efiemu_mod-efiemu_i386_loadcore32.lst
VIDEOFILES += video-efiemu_mod-efiemu_i386_loadcore32.lst

cmd-efiemu_mod-efiemu_i386_loadcore32.lst: efiemu/i386/loadcore32.c $(efiemu/i386/loadcore32.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh efiemu > $@ || (rm -f $@; exit 1)

fs-efiemu_mod-efiemu_i386_loadcore32.lst: efiemu/i386/loadcore32.c $(efiemu/i386/loadcore32.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh efiemu > $@ || (rm -f $@; exit 1)

parttool-efiemu_mod-efiemu_i386_loadcore32.lst: efiemu/i386/loadcore32.c $(efiemu/i386/loadcore32.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh efiemu > $@ || (rm -f $@; exit 1)

partmap-efiemu_mod-efiemu_i386_loadcore32.lst: efiemu/i386/loadcore32.c $(efiemu/i386/loadcore32.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh efiemu > $@ || (rm -f $@; exit 1)

handler-efiemu_mod-efiemu_i386_loadcore32.lst: efiemu/i386/loadcore32.c $(efiemu/i386/loadcore32.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh efiemu > $@ || (rm -f $@; exit 1)

terminal-efiemu_mod-efiemu_i386_loadcore32.lst: efiemu/i386/loadcore32.c $(efiemu/i386/loadcore32.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh efiemu > $@ || (rm -f $@; exit 1)

video-efiemu_mod-efiemu_i386_loadcore32.lst: efiemu/i386/loadcore32.c $(efiemu/i386/loadcore32.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh efiemu > $@ || (rm -f $@; exit 1)

efiemu_mod-efiemu_i386_loadcore64.o: efiemu/i386/loadcore64.c $(efiemu/i386/loadcore64.c_DEPENDENCIES)
	$(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -DGRUB_FILE=\"efiemu/i386/loadcore64.c\" -MD -c -o $@ $<
-include efiemu_mod-efiemu_i386_loadcore64.d

clean-module-efiemu_mod-efiemu_i386_loadcore64-extra.1:
	rm -f cmd-efiemu_mod-efiemu_i386_loadcore64.lst fs-efiemu_mod-efiemu_i386_loadcore64.lst partmap-efiemu_mod-efiemu_i386_loadcore64.lst handler-efiemu_mod-efiemu_i386_loadcore64.lst parttool-efiemu_mod-efiemu_i386_loadcore64.lst video-efiemu_mod-efiemu_i386_loadcore64.lst terminal-efiemu_mod-efiemu_i386_loadcore64.lst

CLEAN_MODULE_TARGETS += clean-module-efiemu_mod-efiemu_i386_loadcore64-extra.1

COMMANDFILES += cmd-efiemu_mod-efiemu_i386_loadcore64.lst
FSFILES += fs-efiemu_mod-efiemu_i386_loadcore64.lst
PARTTOOLFILES += parttool-efiemu_mod-efiemu_i386_loadcore64.lst
PARTMAPFILES += partmap-efiemu_mod-efiemu_i386_loadcore64.lst
HANDLERFILES += handler-efiemu_mod-efiemu_i386_loadcore64.lst
TERMINALFILES += terminal-efiemu_mod-efiemu_i386_loadcore64.lst
VIDEOFILES += video-efiemu_mod-efiemu_i386_loadcore64.lst

cmd-efiemu_mod-efiemu_i386_loadcore64.lst: efiemu/i386/loadcore64.c $(efiemu/i386/loadcore64.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh efiemu > $@ || (rm -f $@; exit 1)

fs-efiemu_mod-efiemu_i386_loadcore64.lst: efiemu/i386/loadcore64.c $(efiemu/i386/loadcore64.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh efiemu > $@ || (rm -f $@; exit 1)

parttool-efiemu_mod-efiemu_i386_loadcore64.lst: efiemu/i386/loadcore64.c $(efiemu/i386/loadcore64.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh efiemu > $@ || (rm -f $@; exit 1)

partmap-efiemu_mod-efiemu_i386_loadcore64.lst: efiemu/i386/loadcore64.c $(efiemu/i386/loadcore64.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh efiemu > $@ || (rm -f $@; exit 1)

handler-efiemu_mod-efiemu_i386_loadcore64.lst: efiemu/i386/loadcore64.c $(efiemu/i386/loadcore64.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh efiemu > $@ || (rm -f $@; exit 1)

terminal-efiemu_mod-efiemu_i386_loadcore64.lst: efiemu/i386/loadcore64.c $(efiemu/i386/loadcore64.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh efiemu > $@ || (rm -f $@; exit 1)

video-efiemu_mod-efiemu_i386_loadcore64.lst: efiemu/i386/loadcore64.c $(efiemu/i386/loadcore64.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh efiemu > $@ || (rm -f $@; exit 1)

efiemu_mod-efiemu_i386_pc_cfgtables.o: efiemu/i386/pc/cfgtables.c $(efiemu/i386/pc/cfgtables.c_DEPENDENCIES)
	$(TARGET_CC) -Iefiemu/i386/pc -I$(srcdir)/efiemu/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -DGRUB_FILE=\"efiemu/i386/pc/cfgtables.c\" -MD -c -o $@ $<
-include efiemu_mod-efiemu_i386_pc_cfgtables.d

clean-module-efiemu_mod-efiemu_i386_pc_cfgtables-extra.1:
	rm -f cmd-efiemu_mod-efiemu_i386_pc_cfgtables.lst fs-efiemu_mod-efiemu_i386_pc_cfgtables.lst partmap-efiemu_mod-efiemu_i386_pc_cfgtables.lst handler-efiemu_mod-efiemu_i386_pc_cfgtables.lst parttool-efiemu_mod-efiemu_i386_pc_cfgtables.lst video-efiemu_mod-efiemu_i386_pc_cfgtables.lst terminal-efiemu_mod-efiemu_i386_pc_cfgtables.lst

CLEAN_MODULE_TARGETS += clean-module-efiemu_mod-efiemu_i386_pc_cfgtables-extra.1

COMMANDFILES += cmd-efiemu_mod-efiemu_i386_pc_cfgtables.lst
FSFILES += fs-efiemu_mod-efiemu_i386_pc_cfgtables.lst
PARTTOOLFILES += parttool-efiemu_mod-efiemu_i386_pc_cfgtables.lst
PARTMAPFILES += partmap-efiemu_mod-efiemu_i386_pc_cfgtables.lst
HANDLERFILES += handler-efiemu_mod-efiemu_i386_pc_cfgtables.lst
TERMINALFILES += terminal-efiemu_mod-efiemu_i386_pc_cfgtables.lst
VIDEOFILES += video-efiemu_mod-efiemu_i386_pc_cfgtables.lst

cmd-efiemu_mod-efiemu_i386_pc_cfgtables.lst: efiemu/i386/pc/cfgtables.c $(efiemu/i386/pc/cfgtables.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386/pc -I$(srcdir)/efiemu/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh efiemu > $@ || (rm -f $@; exit 1)

fs-efiemu_mod-efiemu_i386_pc_cfgtables.lst: efiemu/i386/pc/cfgtables.c $(efiemu/i386/pc/cfgtables.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386/pc -I$(srcdir)/efiemu/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh efiemu > $@ || (rm -f $@; exit 1)

parttool-efiemu_mod-efiemu_i386_pc_cfgtables.lst: efiemu/i386/pc/cfgtables.c $(efiemu/i386/pc/cfgtables.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386/pc -I$(srcdir)/efiemu/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh efiemu > $@ || (rm -f $@; exit 1)

partmap-efiemu_mod-efiemu_i386_pc_cfgtables.lst: efiemu/i386/pc/cfgtables.c $(efiemu/i386/pc/cfgtables.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386/pc -I$(srcdir)/efiemu/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh efiemu > $@ || (rm -f $@; exit 1)

handler-efiemu_mod-efiemu_i386_pc_cfgtables.lst: efiemu/i386/pc/cfgtables.c $(efiemu/i386/pc/cfgtables.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386/pc -I$(srcdir)/efiemu/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh efiemu > $@ || (rm -f $@; exit 1)

terminal-efiemu_mod-efiemu_i386_pc_cfgtables.lst: efiemu/i386/pc/cfgtables.c $(efiemu/i386/pc/cfgtables.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386/pc -I$(srcdir)/efiemu/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh efiemu > $@ || (rm -f $@; exit 1)

video-efiemu_mod-efiemu_i386_pc_cfgtables.lst: efiemu/i386/pc/cfgtables.c $(efiemu/i386/pc/cfgtables.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386/pc -I$(srcdir)/efiemu/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh efiemu > $@ || (rm -f $@; exit 1)

efiemu_mod-efiemu_mm.o: efiemu/mm.c $(efiemu/mm.c_DEPENDENCIES)
	$(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -DGRUB_FILE=\"efiemu/mm.c\" -MD -c -o $@ $<
-include efiemu_mod-efiemu_mm.d

clean-module-efiemu_mod-efiemu_mm-extra.1:
	rm -f cmd-efiemu_mod-efiemu_mm.lst fs-efiemu_mod-efiemu_mm.lst partmap-efiemu_mod-efiemu_mm.lst handler-efiemu_mod-efiemu_mm.lst parttool-efiemu_mod-efiemu_mm.lst video-efiemu_mod-efiemu_mm.lst terminal-efiemu_mod-efiemu_mm.lst

CLEAN_MODULE_TARGETS += clean-module-efiemu_mod-efiemu_mm-extra.1

COMMANDFILES += cmd-efiemu_mod-efiemu_mm.lst
FSFILES += fs-efiemu_mod-efiemu_mm.lst
PARTTOOLFILES += parttool-efiemu_mod-efiemu_mm.lst
PARTMAPFILES += partmap-efiemu_mod-efiemu_mm.lst
HANDLERFILES += handler-efiemu_mod-efiemu_mm.lst
TERMINALFILES += terminal-efiemu_mod-efiemu_mm.lst
VIDEOFILES += video-efiemu_mod-efiemu_mm.lst

cmd-efiemu_mod-efiemu_mm.lst: efiemu/mm.c $(efiemu/mm.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh efiemu > $@ || (rm -f $@; exit 1)

fs-efiemu_mod-efiemu_mm.lst: efiemu/mm.c $(efiemu/mm.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh efiemu > $@ || (rm -f $@; exit 1)

parttool-efiemu_mod-efiemu_mm.lst: efiemu/mm.c $(efiemu/mm.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh efiemu > $@ || (rm -f $@; exit 1)

partmap-efiemu_mod-efiemu_mm.lst: efiemu/mm.c $(efiemu/mm.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh efiemu > $@ || (rm -f $@; exit 1)

handler-efiemu_mod-efiemu_mm.lst: efiemu/mm.c $(efiemu/mm.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh efiemu > $@ || (rm -f $@; exit 1)

terminal-efiemu_mod-efiemu_mm.lst: efiemu/mm.c $(efiemu/mm.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh efiemu > $@ || (rm -f $@; exit 1)

video-efiemu_mod-efiemu_mm.lst: efiemu/mm.c $(efiemu/mm.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh efiemu > $@ || (rm -f $@; exit 1)

efiemu_mod-efiemu_loadcore_common.o: efiemu/loadcore_common.c $(efiemu/loadcore_common.c_DEPENDENCIES)
	$(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -DGRUB_FILE=\"efiemu/loadcore_common.c\" -MD -c -o $@ $<
-include efiemu_mod-efiemu_loadcore_common.d

clean-module-efiemu_mod-efiemu_loadcore_common-extra.1:
	rm -f cmd-efiemu_mod-efiemu_loadcore_common.lst fs-efiemu_mod-efiemu_loadcore_common.lst partmap-efiemu_mod-efiemu_loadcore_common.lst handler-efiemu_mod-efiemu_loadcore_common.lst parttool-efiemu_mod-efiemu_loadcore_common.lst video-efiemu_mod-efiemu_loadcore_common.lst terminal-efiemu_mod-efiemu_loadcore_common.lst

CLEAN_MODULE_TARGETS += clean-module-efiemu_mod-efiemu_loadcore_common-extra.1

COMMANDFILES += cmd-efiemu_mod-efiemu_loadcore_common.lst
FSFILES += fs-efiemu_mod-efiemu_loadcore_common.lst
PARTTOOLFILES += parttool-efiemu_mod-efiemu_loadcore_common.lst
PARTMAPFILES += partmap-efiemu_mod-efiemu_loadcore_common.lst
HANDLERFILES += handler-efiemu_mod-efiemu_loadcore_common.lst
TERMINALFILES += terminal-efiemu_mod-efiemu_loadcore_common.lst
VIDEOFILES += video-efiemu_mod-efiemu_loadcore_common.lst

cmd-efiemu_mod-efiemu_loadcore_common.lst: efiemu/loadcore_common.c $(efiemu/loadcore_common.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh efiemu > $@ || (rm -f $@; exit 1)

fs-efiemu_mod-efiemu_loadcore_common.lst: efiemu/loadcore_common.c $(efiemu/loadcore_common.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh efiemu > $@ || (rm -f $@; exit 1)

parttool-efiemu_mod-efiemu_loadcore_common.lst: efiemu/loadcore_common.c $(efiemu/loadcore_common.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh efiemu > $@ || (rm -f $@; exit 1)

partmap-efiemu_mod-efiemu_loadcore_common.lst: efiemu/loadcore_common.c $(efiemu/loadcore_common.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh efiemu > $@ || (rm -f $@; exit 1)

handler-efiemu_mod-efiemu_loadcore_common.lst: efiemu/loadcore_common.c $(efiemu/loadcore_common.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh efiemu > $@ || (rm -f $@; exit 1)

terminal-efiemu_mod-efiemu_loadcore_common.lst: efiemu/loadcore_common.c $(efiemu/loadcore_common.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh efiemu > $@ || (rm -f $@; exit 1)

video-efiemu_mod-efiemu_loadcore_common.lst: efiemu/loadcore_common.c $(efiemu/loadcore_common.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh efiemu > $@ || (rm -f $@; exit 1)

efiemu_mod-efiemu_symbols.o: efiemu/symbols.c $(efiemu/symbols.c_DEPENDENCIES)
	$(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -DGRUB_FILE=\"efiemu/symbols.c\" -MD -c -o $@ $<
-include efiemu_mod-efiemu_symbols.d

clean-module-efiemu_mod-efiemu_symbols-extra.1:
	rm -f cmd-efiemu_mod-efiemu_symbols.lst fs-efiemu_mod-efiemu_symbols.lst partmap-efiemu_mod-efiemu_symbols.lst handler-efiemu_mod-efiemu_symbols.lst parttool-efiemu_mod-efiemu_symbols.lst video-efiemu_mod-efiemu_symbols.lst terminal-efiemu_mod-efiemu_symbols.lst

CLEAN_MODULE_TARGETS += clean-module-efiemu_mod-efiemu_symbols-extra.1

COMMANDFILES += cmd-efiemu_mod-efiemu_symbols.lst
FSFILES += fs-efiemu_mod-efiemu_symbols.lst
PARTTOOLFILES += parttool-efiemu_mod-efiemu_symbols.lst
PARTMAPFILES += partmap-efiemu_mod-efiemu_symbols.lst
HANDLERFILES += handler-efiemu_mod-efiemu_symbols.lst
TERMINALFILES += terminal-efiemu_mod-efiemu_symbols.lst
VIDEOFILES += video-efiemu_mod-efiemu_symbols.lst

cmd-efiemu_mod-efiemu_symbols.lst: efiemu/symbols.c $(efiemu/symbols.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh efiemu > $@ || (rm -f $@; exit 1)

fs-efiemu_mod-efiemu_symbols.lst: efiemu/symbols.c $(efiemu/symbols.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh efiemu > $@ || (rm -f $@; exit 1)

parttool-efiemu_mod-efiemu_symbols.lst: efiemu/symbols.c $(efiemu/symbols.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh efiemu > $@ || (rm -f $@; exit 1)

partmap-efiemu_mod-efiemu_symbols.lst: efiemu/symbols.c $(efiemu/symbols.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh efiemu > $@ || (rm -f $@; exit 1)

handler-efiemu_mod-efiemu_symbols.lst: efiemu/symbols.c $(efiemu/symbols.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh efiemu > $@ || (rm -f $@; exit 1)

terminal-efiemu_mod-efiemu_symbols.lst: efiemu/symbols.c $(efiemu/symbols.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh efiemu > $@ || (rm -f $@; exit 1)

video-efiemu_mod-efiemu_symbols.lst: efiemu/symbols.c $(efiemu/symbols.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh efiemu > $@ || (rm -f $@; exit 1)

efiemu_mod-efiemu_loadcore32.o: efiemu/loadcore32.c $(efiemu/loadcore32.c_DEPENDENCIES)
	$(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -DGRUB_FILE=\"efiemu/loadcore32.c\" -MD -c -o $@ $<
-include efiemu_mod-efiemu_loadcore32.d

clean-module-efiemu_mod-efiemu_loadcore32-extra.1:
	rm -f cmd-efiemu_mod-efiemu_loadcore32.lst fs-efiemu_mod-efiemu_loadcore32.lst partmap-efiemu_mod-efiemu_loadcore32.lst handler-efiemu_mod-efiemu_loadcore32.lst parttool-efiemu_mod-efiemu_loadcore32.lst video-efiemu_mod-efiemu_loadcore32.lst terminal-efiemu_mod-efiemu_loadcore32.lst

CLEAN_MODULE_TARGETS += clean-module-efiemu_mod-efiemu_loadcore32-extra.1

COMMANDFILES += cmd-efiemu_mod-efiemu_loadcore32.lst
FSFILES += fs-efiemu_mod-efiemu_loadcore32.lst
PARTTOOLFILES += parttool-efiemu_mod-efiemu_loadcore32.lst
PARTMAPFILES += partmap-efiemu_mod-efiemu_loadcore32.lst
HANDLERFILES += handler-efiemu_mod-efiemu_loadcore32.lst
TERMINALFILES += terminal-efiemu_mod-efiemu_loadcore32.lst
VIDEOFILES += video-efiemu_mod-efiemu_loadcore32.lst

cmd-efiemu_mod-efiemu_loadcore32.lst: efiemu/loadcore32.c $(efiemu/loadcore32.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh efiemu > $@ || (rm -f $@; exit 1)

fs-efiemu_mod-efiemu_loadcore32.lst: efiemu/loadcore32.c $(efiemu/loadcore32.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh efiemu > $@ || (rm -f $@; exit 1)

parttool-efiemu_mod-efiemu_loadcore32.lst: efiemu/loadcore32.c $(efiemu/loadcore32.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh efiemu > $@ || (rm -f $@; exit 1)

partmap-efiemu_mod-efiemu_loadcore32.lst: efiemu/loadcore32.c $(efiemu/loadcore32.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh efiemu > $@ || (rm -f $@; exit 1)

handler-efiemu_mod-efiemu_loadcore32.lst: efiemu/loadcore32.c $(efiemu/loadcore32.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh efiemu > $@ || (rm -f $@; exit 1)

terminal-efiemu_mod-efiemu_loadcore32.lst: efiemu/loadcore32.c $(efiemu/loadcore32.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh efiemu > $@ || (rm -f $@; exit 1)

video-efiemu_mod-efiemu_loadcore32.lst: efiemu/loadcore32.c $(efiemu/loadcore32.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh efiemu > $@ || (rm -f $@; exit 1)

efiemu_mod-efiemu_loadcore64.o: efiemu/loadcore64.c $(efiemu/loadcore64.c_DEPENDENCIES)
	$(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -DGRUB_FILE=\"efiemu/loadcore64.c\" -MD -c -o $@ $<
-include efiemu_mod-efiemu_loadcore64.d

clean-module-efiemu_mod-efiemu_loadcore64-extra.1:
	rm -f cmd-efiemu_mod-efiemu_loadcore64.lst fs-efiemu_mod-efiemu_loadcore64.lst partmap-efiemu_mod-efiemu_loadcore64.lst handler-efiemu_mod-efiemu_loadcore64.lst parttool-efiemu_mod-efiemu_loadcore64.lst video-efiemu_mod-efiemu_loadcore64.lst terminal-efiemu_mod-efiemu_loadcore64.lst

CLEAN_MODULE_TARGETS += clean-module-efiemu_mod-efiemu_loadcore64-extra.1

COMMANDFILES += cmd-efiemu_mod-efiemu_loadcore64.lst
FSFILES += fs-efiemu_mod-efiemu_loadcore64.lst
PARTTOOLFILES += parttool-efiemu_mod-efiemu_loadcore64.lst
PARTMAPFILES += partmap-efiemu_mod-efiemu_loadcore64.lst
HANDLERFILES += handler-efiemu_mod-efiemu_loadcore64.lst
TERMINALFILES += terminal-efiemu_mod-efiemu_loadcore64.lst
VIDEOFILES += video-efiemu_mod-efiemu_loadcore64.lst

cmd-efiemu_mod-efiemu_loadcore64.lst: efiemu/loadcore64.c $(efiemu/loadcore64.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh efiemu > $@ || (rm -f $@; exit 1)

fs-efiemu_mod-efiemu_loadcore64.lst: efiemu/loadcore64.c $(efiemu/loadcore64.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh efiemu > $@ || (rm -f $@; exit 1)

parttool-efiemu_mod-efiemu_loadcore64.lst: efiemu/loadcore64.c $(efiemu/loadcore64.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh efiemu > $@ || (rm -f $@; exit 1)

partmap-efiemu_mod-efiemu_loadcore64.lst: efiemu/loadcore64.c $(efiemu/loadcore64.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh efiemu > $@ || (rm -f $@; exit 1)

handler-efiemu_mod-efiemu_loadcore64.lst: efiemu/loadcore64.c $(efiemu/loadcore64.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh efiemu > $@ || (rm -f $@; exit 1)

terminal-efiemu_mod-efiemu_loadcore64.lst: efiemu/loadcore64.c $(efiemu/loadcore64.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh efiemu > $@ || (rm -f $@; exit 1)

video-efiemu_mod-efiemu_loadcore64.lst: efiemu/loadcore64.c $(efiemu/loadcore64.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh efiemu > $@ || (rm -f $@; exit 1)

efiemu_mod-efiemu_prepare32.o: efiemu/prepare32.c $(efiemu/prepare32.c_DEPENDENCIES)
	$(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -DGRUB_FILE=\"efiemu/prepare32.c\" -MD -c -o $@ $<
-include efiemu_mod-efiemu_prepare32.d

clean-module-efiemu_mod-efiemu_prepare32-extra.1:
	rm -f cmd-efiemu_mod-efiemu_prepare32.lst fs-efiemu_mod-efiemu_prepare32.lst partmap-efiemu_mod-efiemu_prepare32.lst handler-efiemu_mod-efiemu_prepare32.lst parttool-efiemu_mod-efiemu_prepare32.lst video-efiemu_mod-efiemu_prepare32.lst terminal-efiemu_mod-efiemu_prepare32.lst

CLEAN_MODULE_TARGETS += clean-module-efiemu_mod-efiemu_prepare32-extra.1

COMMANDFILES += cmd-efiemu_mod-efiemu_prepare32.lst
FSFILES += fs-efiemu_mod-efiemu_prepare32.lst
PARTTOOLFILES += parttool-efiemu_mod-efiemu_prepare32.lst
PARTMAPFILES += partmap-efiemu_mod-efiemu_prepare32.lst
HANDLERFILES += handler-efiemu_mod-efiemu_prepare32.lst
TERMINALFILES += terminal-efiemu_mod-efiemu_prepare32.lst
VIDEOFILES += video-efiemu_mod-efiemu_prepare32.lst

cmd-efiemu_mod-efiemu_prepare32.lst: efiemu/prepare32.c $(efiemu/prepare32.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh efiemu > $@ || (rm -f $@; exit 1)

fs-efiemu_mod-efiemu_prepare32.lst: efiemu/prepare32.c $(efiemu/prepare32.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh efiemu > $@ || (rm -f $@; exit 1)

parttool-efiemu_mod-efiemu_prepare32.lst: efiemu/prepare32.c $(efiemu/prepare32.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh efiemu > $@ || (rm -f $@; exit 1)

partmap-efiemu_mod-efiemu_prepare32.lst: efiemu/prepare32.c $(efiemu/prepare32.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh efiemu > $@ || (rm -f $@; exit 1)

handler-efiemu_mod-efiemu_prepare32.lst: efiemu/prepare32.c $(efiemu/prepare32.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh efiemu > $@ || (rm -f $@; exit 1)

terminal-efiemu_mod-efiemu_prepare32.lst: efiemu/prepare32.c $(efiemu/prepare32.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh efiemu > $@ || (rm -f $@; exit 1)

video-efiemu_mod-efiemu_prepare32.lst: efiemu/prepare32.c $(efiemu/prepare32.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh efiemu > $@ || (rm -f $@; exit 1)

efiemu_mod-efiemu_prepare64.o: efiemu/prepare64.c $(efiemu/prepare64.c_DEPENDENCIES)
	$(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -DGRUB_FILE=\"efiemu/prepare64.c\" -MD -c -o $@ $<
-include efiemu_mod-efiemu_prepare64.d

clean-module-efiemu_mod-efiemu_prepare64-extra.1:
	rm -f cmd-efiemu_mod-efiemu_prepare64.lst fs-efiemu_mod-efiemu_prepare64.lst partmap-efiemu_mod-efiemu_prepare64.lst handler-efiemu_mod-efiemu_prepare64.lst parttool-efiemu_mod-efiemu_prepare64.lst video-efiemu_mod-efiemu_prepare64.lst terminal-efiemu_mod-efiemu_prepare64.lst

CLEAN_MODULE_TARGETS += clean-module-efiemu_mod-efiemu_prepare64-extra.1

COMMANDFILES += cmd-efiemu_mod-efiemu_prepare64.lst
FSFILES += fs-efiemu_mod-efiemu_prepare64.lst
PARTTOOLFILES += parttool-efiemu_mod-efiemu_prepare64.lst
PARTMAPFILES += partmap-efiemu_mod-efiemu_prepare64.lst
HANDLERFILES += handler-efiemu_mod-efiemu_prepare64.lst
TERMINALFILES += terminal-efiemu_mod-efiemu_prepare64.lst
VIDEOFILES += video-efiemu_mod-efiemu_prepare64.lst

cmd-efiemu_mod-efiemu_prepare64.lst: efiemu/prepare64.c $(efiemu/prepare64.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh efiemu > $@ || (rm -f $@; exit 1)

fs-efiemu_mod-efiemu_prepare64.lst: efiemu/prepare64.c $(efiemu/prepare64.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh efiemu > $@ || (rm -f $@; exit 1)

parttool-efiemu_mod-efiemu_prepare64.lst: efiemu/prepare64.c $(efiemu/prepare64.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh efiemu > $@ || (rm -f $@; exit 1)

partmap-efiemu_mod-efiemu_prepare64.lst: efiemu/prepare64.c $(efiemu/prepare64.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh efiemu > $@ || (rm -f $@; exit 1)

handler-efiemu_mod-efiemu_prepare64.lst: efiemu/prepare64.c $(efiemu/prepare64.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh efiemu > $@ || (rm -f $@; exit 1)

terminal-efiemu_mod-efiemu_prepare64.lst: efiemu/prepare64.c $(efiemu/prepare64.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh efiemu > $@ || (rm -f $@; exit 1)

video-efiemu_mod-efiemu_prepare64.lst: efiemu/prepare64.c $(efiemu/prepare64.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh efiemu > $@ || (rm -f $@; exit 1)

efiemu_mod-efiemu_pnvram.o: efiemu/pnvram.c $(efiemu/pnvram.c_DEPENDENCIES)
	$(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -DGRUB_FILE=\"efiemu/pnvram.c\" -MD -c -o $@ $<
-include efiemu_mod-efiemu_pnvram.d

clean-module-efiemu_mod-efiemu_pnvram-extra.1:
	rm -f cmd-efiemu_mod-efiemu_pnvram.lst fs-efiemu_mod-efiemu_pnvram.lst partmap-efiemu_mod-efiemu_pnvram.lst handler-efiemu_mod-efiemu_pnvram.lst parttool-efiemu_mod-efiemu_pnvram.lst video-efiemu_mod-efiemu_pnvram.lst terminal-efiemu_mod-efiemu_pnvram.lst

CLEAN_MODULE_TARGETS += clean-module-efiemu_mod-efiemu_pnvram-extra.1

COMMANDFILES += cmd-efiemu_mod-efiemu_pnvram.lst
FSFILES += fs-efiemu_mod-efiemu_pnvram.lst
PARTTOOLFILES += parttool-efiemu_mod-efiemu_pnvram.lst
PARTMAPFILES += partmap-efiemu_mod-efiemu_pnvram.lst
HANDLERFILES += handler-efiemu_mod-efiemu_pnvram.lst
TERMINALFILES += terminal-efiemu_mod-efiemu_pnvram.lst
VIDEOFILES += video-efiemu_mod-efiemu_pnvram.lst

cmd-efiemu_mod-efiemu_pnvram.lst: efiemu/pnvram.c $(efiemu/pnvram.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh efiemu > $@ || (rm -f $@; exit 1)

fs-efiemu_mod-efiemu_pnvram.lst: efiemu/pnvram.c $(efiemu/pnvram.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh efiemu > $@ || (rm -f $@; exit 1)

parttool-efiemu_mod-efiemu_pnvram.lst: efiemu/pnvram.c $(efiemu/pnvram.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh efiemu > $@ || (rm -f $@; exit 1)

partmap-efiemu_mod-efiemu_pnvram.lst: efiemu/pnvram.c $(efiemu/pnvram.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh efiemu > $@ || (rm -f $@; exit 1)

handler-efiemu_mod-efiemu_pnvram.lst: efiemu/pnvram.c $(efiemu/pnvram.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh efiemu > $@ || (rm -f $@; exit 1)

terminal-efiemu_mod-efiemu_pnvram.lst: efiemu/pnvram.c $(efiemu/pnvram.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh efiemu > $@ || (rm -f $@; exit 1)

video-efiemu_mod-efiemu_pnvram.lst: efiemu/pnvram.c $(efiemu/pnvram.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu -I$(srcdir)/efiemu $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh efiemu > $@ || (rm -f $@; exit 1)

efiemu_mod-efiemu_i386_coredetect.o: efiemu/i386/coredetect.c $(efiemu/i386/coredetect.c_DEPENDENCIES)
	$(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -DGRUB_FILE=\"efiemu/i386/coredetect.c\" -MD -c -o $@ $<
-include efiemu_mod-efiemu_i386_coredetect.d

clean-module-efiemu_mod-efiemu_i386_coredetect-extra.1:
	rm -f cmd-efiemu_mod-efiemu_i386_coredetect.lst fs-efiemu_mod-efiemu_i386_coredetect.lst partmap-efiemu_mod-efiemu_i386_coredetect.lst handler-efiemu_mod-efiemu_i386_coredetect.lst parttool-efiemu_mod-efiemu_i386_coredetect.lst video-efiemu_mod-efiemu_i386_coredetect.lst terminal-efiemu_mod-efiemu_i386_coredetect.lst

CLEAN_MODULE_TARGETS += clean-module-efiemu_mod-efiemu_i386_coredetect-extra.1

COMMANDFILES += cmd-efiemu_mod-efiemu_i386_coredetect.lst
FSFILES += fs-efiemu_mod-efiemu_i386_coredetect.lst
PARTTOOLFILES += parttool-efiemu_mod-efiemu_i386_coredetect.lst
PARTMAPFILES += partmap-efiemu_mod-efiemu_i386_coredetect.lst
HANDLERFILES += handler-efiemu_mod-efiemu_i386_coredetect.lst
TERMINALFILES += terminal-efiemu_mod-efiemu_i386_coredetect.lst
VIDEOFILES += video-efiemu_mod-efiemu_i386_coredetect.lst

cmd-efiemu_mod-efiemu_i386_coredetect.lst: efiemu/i386/coredetect.c $(efiemu/i386/coredetect.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh efiemu > $@ || (rm -f $@; exit 1)

fs-efiemu_mod-efiemu_i386_coredetect.lst: efiemu/i386/coredetect.c $(efiemu/i386/coredetect.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh efiemu > $@ || (rm -f $@; exit 1)

parttool-efiemu_mod-efiemu_i386_coredetect.lst: efiemu/i386/coredetect.c $(efiemu/i386/coredetect.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh efiemu > $@ || (rm -f $@; exit 1)

partmap-efiemu_mod-efiemu_i386_coredetect.lst: efiemu/i386/coredetect.c $(efiemu/i386/coredetect.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh efiemu > $@ || (rm -f $@; exit 1)

handler-efiemu_mod-efiemu_i386_coredetect.lst: efiemu/i386/coredetect.c $(efiemu/i386/coredetect.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh efiemu > $@ || (rm -f $@; exit 1)

terminal-efiemu_mod-efiemu_i386_coredetect.lst: efiemu/i386/coredetect.c $(efiemu/i386/coredetect.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh efiemu > $@ || (rm -f $@; exit 1)

video-efiemu_mod-efiemu_i386_coredetect.lst: efiemu/i386/coredetect.c $(efiemu/i386/coredetect.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iefiemu/i386 -I$(srcdir)/efiemu/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(efiemu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh efiemu > $@ || (rm -f $@; exit 1)

efiemu_mod_CFLAGS = $(COMMON_CFLAGS)
efiemu_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For acpi.mod.
acpi_mod_SOURCES = commands/acpi.c commands/i386/pc/acpi.c

clean-module-acpi.mod.1:
	rm -f acpi.mod mod-acpi.o mod-acpi.c pre-acpi.o acpi_mod-commands_acpi.o acpi_mod-commands_i386_pc_acpi.o und-acpi.lst

CLEAN_MODULE_TARGETS += clean-module-acpi.mod.1

clean-module-acpi.mod-symbol.1:
	rm -f def-acpi.lst

CLEAN_MODULE_TARGETS += clean-module-acpi.mod-symbol.1
DEFSYMFILES += def-acpi.lst
mostlyclean-module-acpi.mod.1:
	rm -f acpi_mod-commands_acpi.d acpi_mod-commands_i386_pc_acpi.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-acpi.mod.1
UNDSYMFILES += und-acpi.lst

ifeq ($(TARGET_NO_MODULES), yes)
acpi.mod: pre-acpi.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(acpi_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-acpi.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
acpi.mod: pre-acpi.o mod-acpi.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(acpi_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-acpi.o mod-acpi.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
acpi.mod: pre-acpi.o mod-acpi.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(acpi_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-acpi.o mod-acpi.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-acpi.o: $(acpi_mod_DEPENDENCIES) acpi_mod-commands_acpi.o acpi_mod-commands_i386_pc_acpi.o
	-rm -f $@
	$(TARGET_CC) $(acpi_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ acpi_mod-commands_acpi.o acpi_mod-commands_i386_pc_acpi.o

mod-acpi.o: mod-acpi.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(acpi_mod_CFLAGS) -DGRUB_FILE=\"mod-acpi.c\" -c -o $@ $<

mod-acpi.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'acpi' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-acpi.lst: pre-acpi.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 acpi/' > $@
else
def-acpi.lst: pre-acpi.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 acpi/' > $@
endif

und-acpi.lst: pre-acpi.o
	echo 'acpi' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

acpi_mod-commands_acpi.o: commands/acpi.c $(commands/acpi.c_DEPENDENCIES)
	$(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(acpi_mod_CFLAGS) -DGRUB_FILE=\"commands/acpi.c\" -MD -c -o $@ $<
-include acpi_mod-commands_acpi.d

clean-module-acpi_mod-commands_acpi-extra.1:
	rm -f cmd-acpi_mod-commands_acpi.lst fs-acpi_mod-commands_acpi.lst partmap-acpi_mod-commands_acpi.lst handler-acpi_mod-commands_acpi.lst parttool-acpi_mod-commands_acpi.lst video-acpi_mod-commands_acpi.lst terminal-acpi_mod-commands_acpi.lst

CLEAN_MODULE_TARGETS += clean-module-acpi_mod-commands_acpi-extra.1

COMMANDFILES += cmd-acpi_mod-commands_acpi.lst
FSFILES += fs-acpi_mod-commands_acpi.lst
PARTTOOLFILES += parttool-acpi_mod-commands_acpi.lst
PARTMAPFILES += partmap-acpi_mod-commands_acpi.lst
HANDLERFILES += handler-acpi_mod-commands_acpi.lst
TERMINALFILES += terminal-acpi_mod-commands_acpi.lst
VIDEOFILES += video-acpi_mod-commands_acpi.lst

cmd-acpi_mod-commands_acpi.lst: commands/acpi.c $(commands/acpi.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(acpi_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh acpi > $@ || (rm -f $@; exit 1)

fs-acpi_mod-commands_acpi.lst: commands/acpi.c $(commands/acpi.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(acpi_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh acpi > $@ || (rm -f $@; exit 1)

parttool-acpi_mod-commands_acpi.lst: commands/acpi.c $(commands/acpi.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(acpi_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh acpi > $@ || (rm -f $@; exit 1)

partmap-acpi_mod-commands_acpi.lst: commands/acpi.c $(commands/acpi.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(acpi_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh acpi > $@ || (rm -f $@; exit 1)

handler-acpi_mod-commands_acpi.lst: commands/acpi.c $(commands/acpi.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(acpi_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh acpi > $@ || (rm -f $@; exit 1)

terminal-acpi_mod-commands_acpi.lst: commands/acpi.c $(commands/acpi.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(acpi_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh acpi > $@ || (rm -f $@; exit 1)

video-acpi_mod-commands_acpi.lst: commands/acpi.c $(commands/acpi.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(acpi_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh acpi > $@ || (rm -f $@; exit 1)

acpi_mod-commands_i386_pc_acpi.o: commands/i386/pc/acpi.c $(commands/i386/pc/acpi.c_DEPENDENCIES)
	$(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(acpi_mod_CFLAGS) -DGRUB_FILE=\"commands/i386/pc/acpi.c\" -MD -c -o $@ $<
-include acpi_mod-commands_i386_pc_acpi.d

clean-module-acpi_mod-commands_i386_pc_acpi-extra.1:
	rm -f cmd-acpi_mod-commands_i386_pc_acpi.lst fs-acpi_mod-commands_i386_pc_acpi.lst partmap-acpi_mod-commands_i386_pc_acpi.lst handler-acpi_mod-commands_i386_pc_acpi.lst parttool-acpi_mod-commands_i386_pc_acpi.lst video-acpi_mod-commands_i386_pc_acpi.lst terminal-acpi_mod-commands_i386_pc_acpi.lst

CLEAN_MODULE_TARGETS += clean-module-acpi_mod-commands_i386_pc_acpi-extra.1

COMMANDFILES += cmd-acpi_mod-commands_i386_pc_acpi.lst
FSFILES += fs-acpi_mod-commands_i386_pc_acpi.lst
PARTTOOLFILES += parttool-acpi_mod-commands_i386_pc_acpi.lst
PARTMAPFILES += partmap-acpi_mod-commands_i386_pc_acpi.lst
HANDLERFILES += handler-acpi_mod-commands_i386_pc_acpi.lst
TERMINALFILES += terminal-acpi_mod-commands_i386_pc_acpi.lst
VIDEOFILES += video-acpi_mod-commands_i386_pc_acpi.lst

cmd-acpi_mod-commands_i386_pc_acpi.lst: commands/i386/pc/acpi.c $(commands/i386/pc/acpi.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(acpi_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh acpi > $@ || (rm -f $@; exit 1)

fs-acpi_mod-commands_i386_pc_acpi.lst: commands/i386/pc/acpi.c $(commands/i386/pc/acpi.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(acpi_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh acpi > $@ || (rm -f $@; exit 1)

parttool-acpi_mod-commands_i386_pc_acpi.lst: commands/i386/pc/acpi.c $(commands/i386/pc/acpi.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(acpi_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh acpi > $@ || (rm -f $@; exit 1)

partmap-acpi_mod-commands_i386_pc_acpi.lst: commands/i386/pc/acpi.c $(commands/i386/pc/acpi.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(acpi_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh acpi > $@ || (rm -f $@; exit 1)

handler-acpi_mod-commands_i386_pc_acpi.lst: commands/i386/pc/acpi.c $(commands/i386/pc/acpi.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(acpi_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh acpi > $@ || (rm -f $@; exit 1)

terminal-acpi_mod-commands_i386_pc_acpi.lst: commands/i386/pc/acpi.c $(commands/i386/pc/acpi.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(acpi_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh acpi > $@ || (rm -f $@; exit 1)

video-acpi_mod-commands_i386_pc_acpi.lst: commands/i386/pc/acpi.c $(commands/i386/pc/acpi.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(acpi_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh acpi > $@ || (rm -f $@; exit 1)

acpi_mod_CFLAGS = $(COMMON_CFLAGS)
acpi_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For mmap.mod.
mmap_mod_SOURCES = mmap/mmap.c mmap/i386/uppermem.c mmap/i386/mmap.c \
		   mmap/i386/pc/mmap.c mmap/i386/pc/mmap_helper.S

clean-module-mmap.mod.1:
	rm -f mmap.mod mod-mmap.o mod-mmap.c pre-mmap.o mmap_mod-mmap_mmap.o mmap_mod-mmap_i386_uppermem.o mmap_mod-mmap_i386_mmap.o mmap_mod-mmap_i386_pc_mmap.o mmap_mod-mmap_i386_pc_mmap_helper.o und-mmap.lst

CLEAN_MODULE_TARGETS += clean-module-mmap.mod.1

clean-module-mmap.mod-symbol.1:
	rm -f def-mmap.lst

CLEAN_MODULE_TARGETS += clean-module-mmap.mod-symbol.1
DEFSYMFILES += def-mmap.lst
mostlyclean-module-mmap.mod.1:
	rm -f mmap_mod-mmap_mmap.d mmap_mod-mmap_i386_uppermem.d mmap_mod-mmap_i386_mmap.d mmap_mod-mmap_i386_pc_mmap.d mmap_mod-mmap_i386_pc_mmap_helper.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-mmap.mod.1
UNDSYMFILES += und-mmap.lst

ifeq ($(TARGET_NO_MODULES), yes)
mmap.mod: pre-mmap.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(mmap_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-mmap.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
mmap.mod: pre-mmap.o mod-mmap.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(mmap_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-mmap.o mod-mmap.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
mmap.mod: pre-mmap.o mod-mmap.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(mmap_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-mmap.o mod-mmap.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-mmap.o: $(mmap_mod_DEPENDENCIES) mmap_mod-mmap_mmap.o mmap_mod-mmap_i386_uppermem.o mmap_mod-mmap_i386_mmap.o mmap_mod-mmap_i386_pc_mmap.o mmap_mod-mmap_i386_pc_mmap_helper.o
	-rm -f $@
	$(TARGET_CC) $(mmap_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ mmap_mod-mmap_mmap.o mmap_mod-mmap_i386_uppermem.o mmap_mod-mmap_i386_mmap.o mmap_mod-mmap_i386_pc_mmap.o mmap_mod-mmap_i386_pc_mmap_helper.o

mod-mmap.o: mod-mmap.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -DGRUB_FILE=\"mod-mmap.c\" -c -o $@ $<

mod-mmap.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'mmap' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-mmap.lst: pre-mmap.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 mmap/' > $@
else
def-mmap.lst: pre-mmap.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 mmap/' > $@
endif

und-mmap.lst: pre-mmap.o
	echo 'mmap' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

mmap_mod-mmap_mmap.o: mmap/mmap.c $(mmap/mmap.c_DEPENDENCIES)
	$(TARGET_CC) -Immap -I$(srcdir)/mmap $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -DGRUB_FILE=\"mmap/mmap.c\" -MD -c -o $@ $<
-include mmap_mod-mmap_mmap.d

clean-module-mmap_mod-mmap_mmap-extra.1:
	rm -f cmd-mmap_mod-mmap_mmap.lst fs-mmap_mod-mmap_mmap.lst partmap-mmap_mod-mmap_mmap.lst handler-mmap_mod-mmap_mmap.lst parttool-mmap_mod-mmap_mmap.lst video-mmap_mod-mmap_mmap.lst terminal-mmap_mod-mmap_mmap.lst

CLEAN_MODULE_TARGETS += clean-module-mmap_mod-mmap_mmap-extra.1

COMMANDFILES += cmd-mmap_mod-mmap_mmap.lst
FSFILES += fs-mmap_mod-mmap_mmap.lst
PARTTOOLFILES += parttool-mmap_mod-mmap_mmap.lst
PARTMAPFILES += partmap-mmap_mod-mmap_mmap.lst
HANDLERFILES += handler-mmap_mod-mmap_mmap.lst
TERMINALFILES += terminal-mmap_mod-mmap_mmap.lst
VIDEOFILES += video-mmap_mod-mmap_mmap.lst

cmd-mmap_mod-mmap_mmap.lst: mmap/mmap.c $(mmap/mmap.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Immap -I$(srcdir)/mmap $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh mmap > $@ || (rm -f $@; exit 1)

fs-mmap_mod-mmap_mmap.lst: mmap/mmap.c $(mmap/mmap.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Immap -I$(srcdir)/mmap $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh mmap > $@ || (rm -f $@; exit 1)

parttool-mmap_mod-mmap_mmap.lst: mmap/mmap.c $(mmap/mmap.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Immap -I$(srcdir)/mmap $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh mmap > $@ || (rm -f $@; exit 1)

partmap-mmap_mod-mmap_mmap.lst: mmap/mmap.c $(mmap/mmap.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Immap -I$(srcdir)/mmap $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh mmap > $@ || (rm -f $@; exit 1)

handler-mmap_mod-mmap_mmap.lst: mmap/mmap.c $(mmap/mmap.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Immap -I$(srcdir)/mmap $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh mmap > $@ || (rm -f $@; exit 1)

terminal-mmap_mod-mmap_mmap.lst: mmap/mmap.c $(mmap/mmap.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Immap -I$(srcdir)/mmap $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh mmap > $@ || (rm -f $@; exit 1)

video-mmap_mod-mmap_mmap.lst: mmap/mmap.c $(mmap/mmap.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Immap -I$(srcdir)/mmap $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh mmap > $@ || (rm -f $@; exit 1)

mmap_mod-mmap_i386_uppermem.o: mmap/i386/uppermem.c $(mmap/i386/uppermem.c_DEPENDENCIES)
	$(TARGET_CC) -Immap/i386 -I$(srcdir)/mmap/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -DGRUB_FILE=\"mmap/i386/uppermem.c\" -MD -c -o $@ $<
-include mmap_mod-mmap_i386_uppermem.d

clean-module-mmap_mod-mmap_i386_uppermem-extra.1:
	rm -f cmd-mmap_mod-mmap_i386_uppermem.lst fs-mmap_mod-mmap_i386_uppermem.lst partmap-mmap_mod-mmap_i386_uppermem.lst handler-mmap_mod-mmap_i386_uppermem.lst parttool-mmap_mod-mmap_i386_uppermem.lst video-mmap_mod-mmap_i386_uppermem.lst terminal-mmap_mod-mmap_i386_uppermem.lst

CLEAN_MODULE_TARGETS += clean-module-mmap_mod-mmap_i386_uppermem-extra.1

COMMANDFILES += cmd-mmap_mod-mmap_i386_uppermem.lst
FSFILES += fs-mmap_mod-mmap_i386_uppermem.lst
PARTTOOLFILES += parttool-mmap_mod-mmap_i386_uppermem.lst
PARTMAPFILES += partmap-mmap_mod-mmap_i386_uppermem.lst
HANDLERFILES += handler-mmap_mod-mmap_i386_uppermem.lst
TERMINALFILES += terminal-mmap_mod-mmap_i386_uppermem.lst
VIDEOFILES += video-mmap_mod-mmap_i386_uppermem.lst

cmd-mmap_mod-mmap_i386_uppermem.lst: mmap/i386/uppermem.c $(mmap/i386/uppermem.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386 -I$(srcdir)/mmap/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh mmap > $@ || (rm -f $@; exit 1)

fs-mmap_mod-mmap_i386_uppermem.lst: mmap/i386/uppermem.c $(mmap/i386/uppermem.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386 -I$(srcdir)/mmap/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh mmap > $@ || (rm -f $@; exit 1)

parttool-mmap_mod-mmap_i386_uppermem.lst: mmap/i386/uppermem.c $(mmap/i386/uppermem.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386 -I$(srcdir)/mmap/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh mmap > $@ || (rm -f $@; exit 1)

partmap-mmap_mod-mmap_i386_uppermem.lst: mmap/i386/uppermem.c $(mmap/i386/uppermem.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386 -I$(srcdir)/mmap/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh mmap > $@ || (rm -f $@; exit 1)

handler-mmap_mod-mmap_i386_uppermem.lst: mmap/i386/uppermem.c $(mmap/i386/uppermem.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386 -I$(srcdir)/mmap/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh mmap > $@ || (rm -f $@; exit 1)

terminal-mmap_mod-mmap_i386_uppermem.lst: mmap/i386/uppermem.c $(mmap/i386/uppermem.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386 -I$(srcdir)/mmap/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh mmap > $@ || (rm -f $@; exit 1)

video-mmap_mod-mmap_i386_uppermem.lst: mmap/i386/uppermem.c $(mmap/i386/uppermem.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386 -I$(srcdir)/mmap/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh mmap > $@ || (rm -f $@; exit 1)

mmap_mod-mmap_i386_mmap.o: mmap/i386/mmap.c $(mmap/i386/mmap.c_DEPENDENCIES)
	$(TARGET_CC) -Immap/i386 -I$(srcdir)/mmap/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -DGRUB_FILE=\"mmap/i386/mmap.c\" -MD -c -o $@ $<
-include mmap_mod-mmap_i386_mmap.d

clean-module-mmap_mod-mmap_i386_mmap-extra.1:
	rm -f cmd-mmap_mod-mmap_i386_mmap.lst fs-mmap_mod-mmap_i386_mmap.lst partmap-mmap_mod-mmap_i386_mmap.lst handler-mmap_mod-mmap_i386_mmap.lst parttool-mmap_mod-mmap_i386_mmap.lst video-mmap_mod-mmap_i386_mmap.lst terminal-mmap_mod-mmap_i386_mmap.lst

CLEAN_MODULE_TARGETS += clean-module-mmap_mod-mmap_i386_mmap-extra.1

COMMANDFILES += cmd-mmap_mod-mmap_i386_mmap.lst
FSFILES += fs-mmap_mod-mmap_i386_mmap.lst
PARTTOOLFILES += parttool-mmap_mod-mmap_i386_mmap.lst
PARTMAPFILES += partmap-mmap_mod-mmap_i386_mmap.lst
HANDLERFILES += handler-mmap_mod-mmap_i386_mmap.lst
TERMINALFILES += terminal-mmap_mod-mmap_i386_mmap.lst
VIDEOFILES += video-mmap_mod-mmap_i386_mmap.lst

cmd-mmap_mod-mmap_i386_mmap.lst: mmap/i386/mmap.c $(mmap/i386/mmap.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386 -I$(srcdir)/mmap/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh mmap > $@ || (rm -f $@; exit 1)

fs-mmap_mod-mmap_i386_mmap.lst: mmap/i386/mmap.c $(mmap/i386/mmap.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386 -I$(srcdir)/mmap/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh mmap > $@ || (rm -f $@; exit 1)

parttool-mmap_mod-mmap_i386_mmap.lst: mmap/i386/mmap.c $(mmap/i386/mmap.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386 -I$(srcdir)/mmap/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh mmap > $@ || (rm -f $@; exit 1)

partmap-mmap_mod-mmap_i386_mmap.lst: mmap/i386/mmap.c $(mmap/i386/mmap.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386 -I$(srcdir)/mmap/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh mmap > $@ || (rm -f $@; exit 1)

handler-mmap_mod-mmap_i386_mmap.lst: mmap/i386/mmap.c $(mmap/i386/mmap.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386 -I$(srcdir)/mmap/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh mmap > $@ || (rm -f $@; exit 1)

terminal-mmap_mod-mmap_i386_mmap.lst: mmap/i386/mmap.c $(mmap/i386/mmap.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386 -I$(srcdir)/mmap/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh mmap > $@ || (rm -f $@; exit 1)

video-mmap_mod-mmap_i386_mmap.lst: mmap/i386/mmap.c $(mmap/i386/mmap.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386 -I$(srcdir)/mmap/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh mmap > $@ || (rm -f $@; exit 1)

mmap_mod-mmap_i386_pc_mmap.o: mmap/i386/pc/mmap.c $(mmap/i386/pc/mmap.c_DEPENDENCIES)
	$(TARGET_CC) -Immap/i386/pc -I$(srcdir)/mmap/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -DGRUB_FILE=\"mmap/i386/pc/mmap.c\" -MD -c -o $@ $<
-include mmap_mod-mmap_i386_pc_mmap.d

clean-module-mmap_mod-mmap_i386_pc_mmap-extra.1:
	rm -f cmd-mmap_mod-mmap_i386_pc_mmap.lst fs-mmap_mod-mmap_i386_pc_mmap.lst partmap-mmap_mod-mmap_i386_pc_mmap.lst handler-mmap_mod-mmap_i386_pc_mmap.lst parttool-mmap_mod-mmap_i386_pc_mmap.lst video-mmap_mod-mmap_i386_pc_mmap.lst terminal-mmap_mod-mmap_i386_pc_mmap.lst

CLEAN_MODULE_TARGETS += clean-module-mmap_mod-mmap_i386_pc_mmap-extra.1

COMMANDFILES += cmd-mmap_mod-mmap_i386_pc_mmap.lst
FSFILES += fs-mmap_mod-mmap_i386_pc_mmap.lst
PARTTOOLFILES += parttool-mmap_mod-mmap_i386_pc_mmap.lst
PARTMAPFILES += partmap-mmap_mod-mmap_i386_pc_mmap.lst
HANDLERFILES += handler-mmap_mod-mmap_i386_pc_mmap.lst
TERMINALFILES += terminal-mmap_mod-mmap_i386_pc_mmap.lst
VIDEOFILES += video-mmap_mod-mmap_i386_pc_mmap.lst

cmd-mmap_mod-mmap_i386_pc_mmap.lst: mmap/i386/pc/mmap.c $(mmap/i386/pc/mmap.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386/pc -I$(srcdir)/mmap/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh mmap > $@ || (rm -f $@; exit 1)

fs-mmap_mod-mmap_i386_pc_mmap.lst: mmap/i386/pc/mmap.c $(mmap/i386/pc/mmap.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386/pc -I$(srcdir)/mmap/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh mmap > $@ || (rm -f $@; exit 1)

parttool-mmap_mod-mmap_i386_pc_mmap.lst: mmap/i386/pc/mmap.c $(mmap/i386/pc/mmap.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386/pc -I$(srcdir)/mmap/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh mmap > $@ || (rm -f $@; exit 1)

partmap-mmap_mod-mmap_i386_pc_mmap.lst: mmap/i386/pc/mmap.c $(mmap/i386/pc/mmap.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386/pc -I$(srcdir)/mmap/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh mmap > $@ || (rm -f $@; exit 1)

handler-mmap_mod-mmap_i386_pc_mmap.lst: mmap/i386/pc/mmap.c $(mmap/i386/pc/mmap.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386/pc -I$(srcdir)/mmap/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh mmap > $@ || (rm -f $@; exit 1)

terminal-mmap_mod-mmap_i386_pc_mmap.lst: mmap/i386/pc/mmap.c $(mmap/i386/pc/mmap.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386/pc -I$(srcdir)/mmap/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh mmap > $@ || (rm -f $@; exit 1)

video-mmap_mod-mmap_i386_pc_mmap.lst: mmap/i386/pc/mmap.c $(mmap/i386/pc/mmap.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386/pc -I$(srcdir)/mmap/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(mmap_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh mmap > $@ || (rm -f $@; exit 1)

mmap_mod-mmap_i386_pc_mmap_helper.o: mmap/i386/pc/mmap_helper.S $(mmap/i386/pc/mmap_helper.S_DEPENDENCIES)
	$(TARGET_CC) -Immap/i386/pc -I$(srcdir)/mmap/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(mmap_mod_ASFLAGS) -DGRUB_FILE=\"mmap/i386/pc/mmap_helper.S\" -MD -c -o $@ $<
-include mmap_mod-mmap_i386_pc_mmap_helper.d

clean-module-mmap_mod-mmap_i386_pc_mmap_helper-extra.1:
	rm -f cmd-mmap_mod-mmap_i386_pc_mmap_helper.lst fs-mmap_mod-mmap_i386_pc_mmap_helper.lst partmap-mmap_mod-mmap_i386_pc_mmap_helper.lst handler-mmap_mod-mmap_i386_pc_mmap_helper.lst parttool-mmap_mod-mmap_i386_pc_mmap_helper.lst video-mmap_mod-mmap_i386_pc_mmap_helper.lst terminal-mmap_mod-mmap_i386_pc_mmap_helper.lst

CLEAN_MODULE_TARGETS += clean-module-mmap_mod-mmap_i386_pc_mmap_helper-extra.1

COMMANDFILES += cmd-mmap_mod-mmap_i386_pc_mmap_helper.lst
FSFILES += fs-mmap_mod-mmap_i386_pc_mmap_helper.lst
PARTTOOLFILES += parttool-mmap_mod-mmap_i386_pc_mmap_helper.lst
PARTMAPFILES += partmap-mmap_mod-mmap_i386_pc_mmap_helper.lst
HANDLERFILES += handler-mmap_mod-mmap_i386_pc_mmap_helper.lst
TERMINALFILES += terminal-mmap_mod-mmap_i386_pc_mmap_helper.lst
VIDEOFILES += video-mmap_mod-mmap_i386_pc_mmap_helper.lst

cmd-mmap_mod-mmap_i386_pc_mmap_helper.lst: mmap/i386/pc/mmap_helper.S $(mmap/i386/pc/mmap_helper.S_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386/pc -I$(srcdir)/mmap/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(mmap_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh mmap > $@ || (rm -f $@; exit 1)

fs-mmap_mod-mmap_i386_pc_mmap_helper.lst: mmap/i386/pc/mmap_helper.S $(mmap/i386/pc/mmap_helper.S_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386/pc -I$(srcdir)/mmap/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 -DGRUB_LST_GENERATOR $(TARGET_ASFLAGS) $(mmap_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh mmap > $@ || (rm -f $@; exit 1)

parttool-mmap_mod-mmap_i386_pc_mmap_helper.lst: mmap/i386/pc/mmap_helper.S $(mmap/i386/pc/mmap_helper.S_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386/pc -I$(srcdir)/mmap/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(mmap_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh mmap > $@ || (rm -f $@; exit 1)

partmap-mmap_mod-mmap_i386_pc_mmap_helper.lst: mmap/i386/pc/mmap_helper.S $(mmap/i386/pc/mmap_helper.S_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386/pc -I$(srcdir)/mmap/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 -DGRUB_LST_GENERATOR $(TARGET_ASFLAGS) $(mmap_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh mmap > $@ || (rm -f $@; exit 1)

handler-mmap_mod-mmap_i386_pc_mmap_helper.lst: mmap/i386/pc/mmap_helper.S $(mmap/i386/pc/mmap_helper.S_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386/pc -I$(srcdir)/mmap/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(mmap_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh mmap > $@ || (rm -f $@; exit 1)

terminal-mmap_mod-mmap_i386_pc_mmap_helper.lst: mmap/i386/pc/mmap_helper.S $(mmap/i386/pc/mmap_helper.S_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386/pc -I$(srcdir)/mmap/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(mmap_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh mmap > $@ || (rm -f $@; exit 1)

video-mmap_mod-mmap_i386_pc_mmap_helper.lst: mmap/i386/pc/mmap_helper.S $(mmap/i386/pc/mmap_helper.S_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Immap/i386/pc -I$(srcdir)/mmap/i386/pc $(TARGET_CPPFLAGS) -DASM_FILE=1 -DGRUB_LST_GENERATOR $(TARGET_ASFLAGS) $(mmap_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh mmap > $@ || (rm -f $@; exit 1)

mmap_mod_CFLAGS = $(COMMON_CFLAGS)
mmap_mod_LDFLAGS = $(COMMON_LDFLAGS)
mmap_mod_ASFLAGS = $(COMMON_ASFLAGS)

# For biosdisk.mod.
biosdisk_mod_SOURCES = disk/i386/pc/biosdisk.c

clean-module-biosdisk.mod.1:
	rm -f biosdisk.mod mod-biosdisk.o mod-biosdisk.c pre-biosdisk.o biosdisk_mod-disk_i386_pc_biosdisk.o und-biosdisk.lst

CLEAN_MODULE_TARGETS += clean-module-biosdisk.mod.1

clean-module-biosdisk.mod-symbol.1:
	rm -f def-biosdisk.lst

CLEAN_MODULE_TARGETS += clean-module-biosdisk.mod-symbol.1
DEFSYMFILES += def-biosdisk.lst
mostlyclean-module-biosdisk.mod.1:
	rm -f biosdisk_mod-disk_i386_pc_biosdisk.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-biosdisk.mod.1
UNDSYMFILES += und-biosdisk.lst

ifeq ($(TARGET_NO_MODULES), yes)
biosdisk.mod: pre-biosdisk.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(biosdisk_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-biosdisk.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
biosdisk.mod: pre-biosdisk.o mod-biosdisk.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(biosdisk_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-biosdisk.o mod-biosdisk.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
biosdisk.mod: pre-biosdisk.o mod-biosdisk.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(biosdisk_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-biosdisk.o mod-biosdisk.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-biosdisk.o: $(biosdisk_mod_DEPENDENCIES) biosdisk_mod-disk_i386_pc_biosdisk.o
	-rm -f $@
	$(TARGET_CC) $(biosdisk_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ biosdisk_mod-disk_i386_pc_biosdisk.o

mod-biosdisk.o: mod-biosdisk.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(biosdisk_mod_CFLAGS) -DGRUB_FILE=\"mod-biosdisk.c\" -c -o $@ $<

mod-biosdisk.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'biosdisk' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-biosdisk.lst: pre-biosdisk.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 biosdisk/' > $@
else
def-biosdisk.lst: pre-biosdisk.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 biosdisk/' > $@
endif

und-biosdisk.lst: pre-biosdisk.o
	echo 'biosdisk' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

biosdisk_mod-disk_i386_pc_biosdisk.o: disk/i386/pc/biosdisk.c $(disk/i386/pc/biosdisk.c_DEPENDENCIES)
	$(TARGET_CC) -Idisk/i386/pc -I$(srcdir)/disk/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(biosdisk_mod_CFLAGS) -DGRUB_FILE=\"disk/i386/pc/biosdisk.c\" -MD -c -o $@ $<
-include biosdisk_mod-disk_i386_pc_biosdisk.d

clean-module-biosdisk_mod-disk_i386_pc_biosdisk-extra.1:
	rm -f cmd-biosdisk_mod-disk_i386_pc_biosdisk.lst fs-biosdisk_mod-disk_i386_pc_biosdisk.lst partmap-biosdisk_mod-disk_i386_pc_biosdisk.lst handler-biosdisk_mod-disk_i386_pc_biosdisk.lst parttool-biosdisk_mod-disk_i386_pc_biosdisk.lst video-biosdisk_mod-disk_i386_pc_biosdisk.lst terminal-biosdisk_mod-disk_i386_pc_biosdisk.lst

CLEAN_MODULE_TARGETS += clean-module-biosdisk_mod-disk_i386_pc_biosdisk-extra.1

COMMANDFILES += cmd-biosdisk_mod-disk_i386_pc_biosdisk.lst
FSFILES += fs-biosdisk_mod-disk_i386_pc_biosdisk.lst
PARTTOOLFILES += parttool-biosdisk_mod-disk_i386_pc_biosdisk.lst
PARTMAPFILES += partmap-biosdisk_mod-disk_i386_pc_biosdisk.lst
HANDLERFILES += handler-biosdisk_mod-disk_i386_pc_biosdisk.lst
TERMINALFILES += terminal-biosdisk_mod-disk_i386_pc_biosdisk.lst
VIDEOFILES += video-biosdisk_mod-disk_i386_pc_biosdisk.lst

cmd-biosdisk_mod-disk_i386_pc_biosdisk.lst: disk/i386/pc/biosdisk.c $(disk/i386/pc/biosdisk.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Idisk/i386/pc -I$(srcdir)/disk/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(biosdisk_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh biosdisk > $@ || (rm -f $@; exit 1)

fs-biosdisk_mod-disk_i386_pc_biosdisk.lst: disk/i386/pc/biosdisk.c $(disk/i386/pc/biosdisk.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Idisk/i386/pc -I$(srcdir)/disk/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(biosdisk_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh biosdisk > $@ || (rm -f $@; exit 1)

parttool-biosdisk_mod-disk_i386_pc_biosdisk.lst: disk/i386/pc/biosdisk.c $(disk/i386/pc/biosdisk.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Idisk/i386/pc -I$(srcdir)/disk/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(biosdisk_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh biosdisk > $@ || (rm -f $@; exit 1)

partmap-biosdisk_mod-disk_i386_pc_biosdisk.lst: disk/i386/pc/biosdisk.c $(disk/i386/pc/biosdisk.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Idisk/i386/pc -I$(srcdir)/disk/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(biosdisk_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh biosdisk > $@ || (rm -f $@; exit 1)

handler-biosdisk_mod-disk_i386_pc_biosdisk.lst: disk/i386/pc/biosdisk.c $(disk/i386/pc/biosdisk.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Idisk/i386/pc -I$(srcdir)/disk/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(biosdisk_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh biosdisk > $@ || (rm -f $@; exit 1)

terminal-biosdisk_mod-disk_i386_pc_biosdisk.lst: disk/i386/pc/biosdisk.c $(disk/i386/pc/biosdisk.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Idisk/i386/pc -I$(srcdir)/disk/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(biosdisk_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh biosdisk > $@ || (rm -f $@; exit 1)

video-biosdisk_mod-disk_i386_pc_biosdisk.lst: disk/i386/pc/biosdisk.c $(disk/i386/pc/biosdisk.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Idisk/i386/pc -I$(srcdir)/disk/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(biosdisk_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh biosdisk > $@ || (rm -f $@; exit 1)

biosdisk_mod_CFLAGS = $(COMMON_CFLAGS)
biosdisk_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For chain.mod.
chain_mod_SOURCES = loader/i386/pc/chainloader.c

clean-module-chain.mod.1:
	rm -f chain.mod mod-chain.o mod-chain.c pre-chain.o chain_mod-loader_i386_pc_chainloader.o und-chain.lst

CLEAN_MODULE_TARGETS += clean-module-chain.mod.1

clean-module-chain.mod-symbol.1:
	rm -f def-chain.lst

CLEAN_MODULE_TARGETS += clean-module-chain.mod-symbol.1
DEFSYMFILES += def-chain.lst
mostlyclean-module-chain.mod.1:
	rm -f chain_mod-loader_i386_pc_chainloader.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-chain.mod.1
UNDSYMFILES += und-chain.lst

ifeq ($(TARGET_NO_MODULES), yes)
chain.mod: pre-chain.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(chain_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-chain.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
chain.mod: pre-chain.o mod-chain.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(chain_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-chain.o mod-chain.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
chain.mod: pre-chain.o mod-chain.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(chain_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-chain.o mod-chain.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-chain.o: $(chain_mod_DEPENDENCIES) chain_mod-loader_i386_pc_chainloader.o
	-rm -f $@
	$(TARGET_CC) $(chain_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ chain_mod-loader_i386_pc_chainloader.o

mod-chain.o: mod-chain.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(chain_mod_CFLAGS) -DGRUB_FILE=\"mod-chain.c\" -c -o $@ $<

mod-chain.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'chain' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-chain.lst: pre-chain.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 chain/' > $@
else
def-chain.lst: pre-chain.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 chain/' > $@
endif

und-chain.lst: pre-chain.o
	echo 'chain' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

chain_mod-loader_i386_pc_chainloader.o: loader/i386/pc/chainloader.c $(loader/i386/pc/chainloader.c_DEPENDENCIES)
	$(TARGET_CC) -Iloader/i386/pc -I$(srcdir)/loader/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(chain_mod_CFLAGS) -DGRUB_FILE=\"loader/i386/pc/chainloader.c\" -MD -c -o $@ $<
-include chain_mod-loader_i386_pc_chainloader.d

clean-module-chain_mod-loader_i386_pc_chainloader-extra.1:
	rm -f cmd-chain_mod-loader_i386_pc_chainloader.lst fs-chain_mod-loader_i386_pc_chainloader.lst partmap-chain_mod-loader_i386_pc_chainloader.lst handler-chain_mod-loader_i386_pc_chainloader.lst parttool-chain_mod-loader_i386_pc_chainloader.lst video-chain_mod-loader_i386_pc_chainloader.lst terminal-chain_mod-loader_i386_pc_chainloader.lst

CLEAN_MODULE_TARGETS += clean-module-chain_mod-loader_i386_pc_chainloader-extra.1

COMMANDFILES += cmd-chain_mod-loader_i386_pc_chainloader.lst
FSFILES += fs-chain_mod-loader_i386_pc_chainloader.lst
PARTTOOLFILES += parttool-chain_mod-loader_i386_pc_chainloader.lst
PARTMAPFILES += partmap-chain_mod-loader_i386_pc_chainloader.lst
HANDLERFILES += handler-chain_mod-loader_i386_pc_chainloader.lst
TERMINALFILES += terminal-chain_mod-loader_i386_pc_chainloader.lst
VIDEOFILES += video-chain_mod-loader_i386_pc_chainloader.lst

cmd-chain_mod-loader_i386_pc_chainloader.lst: loader/i386/pc/chainloader.c $(loader/i386/pc/chainloader.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386/pc -I$(srcdir)/loader/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(chain_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh chain > $@ || (rm -f $@; exit 1)

fs-chain_mod-loader_i386_pc_chainloader.lst: loader/i386/pc/chainloader.c $(loader/i386/pc/chainloader.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386/pc -I$(srcdir)/loader/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(chain_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh chain > $@ || (rm -f $@; exit 1)

parttool-chain_mod-loader_i386_pc_chainloader.lst: loader/i386/pc/chainloader.c $(loader/i386/pc/chainloader.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386/pc -I$(srcdir)/loader/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(chain_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh chain > $@ || (rm -f $@; exit 1)

partmap-chain_mod-loader_i386_pc_chainloader.lst: loader/i386/pc/chainloader.c $(loader/i386/pc/chainloader.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386/pc -I$(srcdir)/loader/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(chain_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh chain > $@ || (rm -f $@; exit 1)

handler-chain_mod-loader_i386_pc_chainloader.lst: loader/i386/pc/chainloader.c $(loader/i386/pc/chainloader.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386/pc -I$(srcdir)/loader/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(chain_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh chain > $@ || (rm -f $@; exit 1)

terminal-chain_mod-loader_i386_pc_chainloader.lst: loader/i386/pc/chainloader.c $(loader/i386/pc/chainloader.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386/pc -I$(srcdir)/loader/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(chain_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh chain > $@ || (rm -f $@; exit 1)

video-chain_mod-loader_i386_pc_chainloader.lst: loader/i386/pc/chainloader.c $(loader/i386/pc/chainloader.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386/pc -I$(srcdir)/loader/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(chain_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh chain > $@ || (rm -f $@; exit 1)

chain_mod_CFLAGS = $(COMMON_CFLAGS)
chain_mod_LDFLAGS = $(COMMON_LDFLAGS)

pkglib_MODULES += linux16.mod
linux16_mod_SOURCES = loader/i386/pc/linux.c

clean-module-linux16.mod.1:
	rm -f linux16.mod mod-linux16.o mod-linux16.c pre-linux16.o linux16_mod-loader_i386_pc_linux.o und-linux16.lst

CLEAN_MODULE_TARGETS += clean-module-linux16.mod.1

clean-module-linux16.mod-symbol.1:
	rm -f def-linux16.lst

CLEAN_MODULE_TARGETS += clean-module-linux16.mod-symbol.1
DEFSYMFILES += def-linux16.lst
mostlyclean-module-linux16.mod.1:
	rm -f linux16_mod-loader_i386_pc_linux.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-linux16.mod.1
UNDSYMFILES += und-linux16.lst

ifeq ($(TARGET_NO_MODULES), yes)
linux16.mod: pre-linux16.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(linux16_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-linux16.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
linux16.mod: pre-linux16.o mod-linux16.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(linux16_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-linux16.o mod-linux16.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
linux16.mod: pre-linux16.o mod-linux16.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(linux16_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-linux16.o mod-linux16.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-linux16.o: $(linux16_mod_DEPENDENCIES) linux16_mod-loader_i386_pc_linux.o
	-rm -f $@
	$(TARGET_CC) $(linux16_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ linux16_mod-loader_i386_pc_linux.o

mod-linux16.o: mod-linux16.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(linux16_mod_CFLAGS) -DGRUB_FILE=\"mod-linux16.c\" -c -o $@ $<

mod-linux16.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'linux16' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-linux16.lst: pre-linux16.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 linux16/' > $@
else
def-linux16.lst: pre-linux16.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 linux16/' > $@
endif

und-linux16.lst: pre-linux16.o
	echo 'linux16' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

linux16_mod-loader_i386_pc_linux.o: loader/i386/pc/linux.c $(loader/i386/pc/linux.c_DEPENDENCIES)
	$(TARGET_CC) -Iloader/i386/pc -I$(srcdir)/loader/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(linux16_mod_CFLAGS) -DGRUB_FILE=\"loader/i386/pc/linux.c\" -MD -c -o $@ $<
-include linux16_mod-loader_i386_pc_linux.d

clean-module-linux16_mod-loader_i386_pc_linux-extra.1:
	rm -f cmd-linux16_mod-loader_i386_pc_linux.lst fs-linux16_mod-loader_i386_pc_linux.lst partmap-linux16_mod-loader_i386_pc_linux.lst handler-linux16_mod-loader_i386_pc_linux.lst parttool-linux16_mod-loader_i386_pc_linux.lst video-linux16_mod-loader_i386_pc_linux.lst terminal-linux16_mod-loader_i386_pc_linux.lst

CLEAN_MODULE_TARGETS += clean-module-linux16_mod-loader_i386_pc_linux-extra.1

COMMANDFILES += cmd-linux16_mod-loader_i386_pc_linux.lst
FSFILES += fs-linux16_mod-loader_i386_pc_linux.lst
PARTTOOLFILES += parttool-linux16_mod-loader_i386_pc_linux.lst
PARTMAPFILES += partmap-linux16_mod-loader_i386_pc_linux.lst
HANDLERFILES += handler-linux16_mod-loader_i386_pc_linux.lst
TERMINALFILES += terminal-linux16_mod-loader_i386_pc_linux.lst
VIDEOFILES += video-linux16_mod-loader_i386_pc_linux.lst

cmd-linux16_mod-loader_i386_pc_linux.lst: loader/i386/pc/linux.c $(loader/i386/pc/linux.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386/pc -I$(srcdir)/loader/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(linux16_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh linux16 > $@ || (rm -f $@; exit 1)

fs-linux16_mod-loader_i386_pc_linux.lst: loader/i386/pc/linux.c $(loader/i386/pc/linux.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386/pc -I$(srcdir)/loader/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(linux16_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh linux16 > $@ || (rm -f $@; exit 1)

parttool-linux16_mod-loader_i386_pc_linux.lst: loader/i386/pc/linux.c $(loader/i386/pc/linux.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386/pc -I$(srcdir)/loader/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(linux16_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh linux16 > $@ || (rm -f $@; exit 1)

partmap-linux16_mod-loader_i386_pc_linux.lst: loader/i386/pc/linux.c $(loader/i386/pc/linux.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386/pc -I$(srcdir)/loader/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(linux16_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh linux16 > $@ || (rm -f $@; exit 1)

handler-linux16_mod-loader_i386_pc_linux.lst: loader/i386/pc/linux.c $(loader/i386/pc/linux.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386/pc -I$(srcdir)/loader/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(linux16_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh linux16 > $@ || (rm -f $@; exit 1)

terminal-linux16_mod-loader_i386_pc_linux.lst: loader/i386/pc/linux.c $(loader/i386/pc/linux.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386/pc -I$(srcdir)/loader/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(linux16_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh linux16 > $@ || (rm -f $@; exit 1)

video-linux16_mod-loader_i386_pc_linux.lst: loader/i386/pc/linux.c $(loader/i386/pc/linux.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386/pc -I$(srcdir)/loader/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(linux16_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh linux16 > $@ || (rm -f $@; exit 1)

linux16_mod_CFLAGS = $(COMMON_CFLAGS)
linux16_mod_LDFLAGS = $(COMMON_LDFLAGS)

pkglib_MODULES += linux.mod
linux_mod_SOURCES = loader/i386/linux.c

clean-module-linux.mod.1:
	rm -f linux.mod mod-linux.o mod-linux.c pre-linux.o linux_mod-loader_i386_linux.o und-linux.lst

CLEAN_MODULE_TARGETS += clean-module-linux.mod.1

clean-module-linux.mod-symbol.1:
	rm -f def-linux.lst

CLEAN_MODULE_TARGETS += clean-module-linux.mod-symbol.1
DEFSYMFILES += def-linux.lst
mostlyclean-module-linux.mod.1:
	rm -f linux_mod-loader_i386_linux.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-linux.mod.1
UNDSYMFILES += und-linux.lst

ifeq ($(TARGET_NO_MODULES), yes)
linux.mod: pre-linux.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(linux_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-linux.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
linux.mod: pre-linux.o mod-linux.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(linux_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-linux.o mod-linux.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
linux.mod: pre-linux.o mod-linux.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(linux_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-linux.o mod-linux.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-linux.o: $(linux_mod_DEPENDENCIES) linux_mod-loader_i386_linux.o
	-rm -f $@
	$(TARGET_CC) $(linux_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ linux_mod-loader_i386_linux.o

mod-linux.o: mod-linux.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(linux_mod_CFLAGS) -DGRUB_FILE=\"mod-linux.c\" -c -o $@ $<

mod-linux.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'linux' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-linux.lst: pre-linux.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 linux/' > $@
else
def-linux.lst: pre-linux.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 linux/' > $@
endif

und-linux.lst: pre-linux.o
	echo 'linux' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

linux_mod-loader_i386_linux.o: loader/i386/linux.c $(loader/i386/linux.c_DEPENDENCIES)
	$(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(linux_mod_CFLAGS) -DGRUB_FILE=\"loader/i386/linux.c\" -MD -c -o $@ $<
-include linux_mod-loader_i386_linux.d

clean-module-linux_mod-loader_i386_linux-extra.1:
	rm -f cmd-linux_mod-loader_i386_linux.lst fs-linux_mod-loader_i386_linux.lst partmap-linux_mod-loader_i386_linux.lst handler-linux_mod-loader_i386_linux.lst parttool-linux_mod-loader_i386_linux.lst video-linux_mod-loader_i386_linux.lst terminal-linux_mod-loader_i386_linux.lst

CLEAN_MODULE_TARGETS += clean-module-linux_mod-loader_i386_linux-extra.1

COMMANDFILES += cmd-linux_mod-loader_i386_linux.lst
FSFILES += fs-linux_mod-loader_i386_linux.lst
PARTTOOLFILES += parttool-linux_mod-loader_i386_linux.lst
PARTMAPFILES += partmap-linux_mod-loader_i386_linux.lst
HANDLERFILES += handler-linux_mod-loader_i386_linux.lst
TERMINALFILES += terminal-linux_mod-loader_i386_linux.lst
VIDEOFILES += video-linux_mod-loader_i386_linux.lst

cmd-linux_mod-loader_i386_linux.lst: loader/i386/linux.c $(loader/i386/linux.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(linux_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh linux > $@ || (rm -f $@; exit 1)

fs-linux_mod-loader_i386_linux.lst: loader/i386/linux.c $(loader/i386/linux.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(linux_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh linux > $@ || (rm -f $@; exit 1)

parttool-linux_mod-loader_i386_linux.lst: loader/i386/linux.c $(loader/i386/linux.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(linux_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh linux > $@ || (rm -f $@; exit 1)

partmap-linux_mod-loader_i386_linux.lst: loader/i386/linux.c $(loader/i386/linux.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(linux_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh linux > $@ || (rm -f $@; exit 1)

handler-linux_mod-loader_i386_linux.lst: loader/i386/linux.c $(loader/i386/linux.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(linux_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh linux > $@ || (rm -f $@; exit 1)

terminal-linux_mod-loader_i386_linux.lst: loader/i386/linux.c $(loader/i386/linux.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(linux_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh linux > $@ || (rm -f $@; exit 1)

video-linux_mod-loader_i386_linux.lst: loader/i386/linux.c $(loader/i386/linux.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(linux_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh linux > $@ || (rm -f $@; exit 1)

linux_mod_CFLAGS = $(COMMON_CFLAGS)
linux_mod_LDFLAGS = $(COMMON_LDFLAGS)

pkglib_MODULES += xnu.mod
xnu_mod_SOURCES = loader/xnu_resume.c loader/i386/xnu.c \
	 loader/macho32.c loader/macho64.c loader/macho.c loader/xnu.c

clean-module-xnu.mod.1:
	rm -f xnu.mod mod-xnu.o mod-xnu.c pre-xnu.o xnu_mod-loader_xnu_resume.o xnu_mod-loader_i386_xnu.o xnu_mod-loader_macho32.o xnu_mod-loader_macho64.o xnu_mod-loader_macho.o xnu_mod-loader_xnu.o und-xnu.lst

CLEAN_MODULE_TARGETS += clean-module-xnu.mod.1

clean-module-xnu.mod-symbol.1:
	rm -f def-xnu.lst

CLEAN_MODULE_TARGETS += clean-module-xnu.mod-symbol.1
DEFSYMFILES += def-xnu.lst
mostlyclean-module-xnu.mod.1:
	rm -f xnu_mod-loader_xnu_resume.d xnu_mod-loader_i386_xnu.d xnu_mod-loader_macho32.d xnu_mod-loader_macho64.d xnu_mod-loader_macho.d xnu_mod-loader_xnu.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-xnu.mod.1
UNDSYMFILES += und-xnu.lst

ifeq ($(TARGET_NO_MODULES), yes)
xnu.mod: pre-xnu.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(xnu_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-xnu.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
xnu.mod: pre-xnu.o mod-xnu.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(xnu_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-xnu.o mod-xnu.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
xnu.mod: pre-xnu.o mod-xnu.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(xnu_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-xnu.o mod-xnu.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-xnu.o: $(xnu_mod_DEPENDENCIES) xnu_mod-loader_xnu_resume.o xnu_mod-loader_i386_xnu.o xnu_mod-loader_macho32.o xnu_mod-loader_macho64.o xnu_mod-loader_macho.o xnu_mod-loader_xnu.o
	-rm -f $@
	$(TARGET_CC) $(xnu_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ xnu_mod-loader_xnu_resume.o xnu_mod-loader_i386_xnu.o xnu_mod-loader_macho32.o xnu_mod-loader_macho64.o xnu_mod-loader_macho.o xnu_mod-loader_xnu.o

mod-xnu.o: mod-xnu.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -DGRUB_FILE=\"mod-xnu.c\" -c -o $@ $<

mod-xnu.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'xnu' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-xnu.lst: pre-xnu.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 xnu/' > $@
else
def-xnu.lst: pre-xnu.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 xnu/' > $@
endif

und-xnu.lst: pre-xnu.o
	echo 'xnu' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

xnu_mod-loader_xnu_resume.o: loader/xnu_resume.c $(loader/xnu_resume.c_DEPENDENCIES)
	$(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -DGRUB_FILE=\"loader/xnu_resume.c\" -MD -c -o $@ $<
-include xnu_mod-loader_xnu_resume.d

clean-module-xnu_mod-loader_xnu_resume-extra.1:
	rm -f cmd-xnu_mod-loader_xnu_resume.lst fs-xnu_mod-loader_xnu_resume.lst partmap-xnu_mod-loader_xnu_resume.lst handler-xnu_mod-loader_xnu_resume.lst parttool-xnu_mod-loader_xnu_resume.lst video-xnu_mod-loader_xnu_resume.lst terminal-xnu_mod-loader_xnu_resume.lst

CLEAN_MODULE_TARGETS += clean-module-xnu_mod-loader_xnu_resume-extra.1

COMMANDFILES += cmd-xnu_mod-loader_xnu_resume.lst
FSFILES += fs-xnu_mod-loader_xnu_resume.lst
PARTTOOLFILES += parttool-xnu_mod-loader_xnu_resume.lst
PARTMAPFILES += partmap-xnu_mod-loader_xnu_resume.lst
HANDLERFILES += handler-xnu_mod-loader_xnu_resume.lst
TERMINALFILES += terminal-xnu_mod-loader_xnu_resume.lst
VIDEOFILES += video-xnu_mod-loader_xnu_resume.lst

cmd-xnu_mod-loader_xnu_resume.lst: loader/xnu_resume.c $(loader/xnu_resume.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh xnu > $@ || (rm -f $@; exit 1)

fs-xnu_mod-loader_xnu_resume.lst: loader/xnu_resume.c $(loader/xnu_resume.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh xnu > $@ || (rm -f $@; exit 1)

parttool-xnu_mod-loader_xnu_resume.lst: loader/xnu_resume.c $(loader/xnu_resume.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh xnu > $@ || (rm -f $@; exit 1)

partmap-xnu_mod-loader_xnu_resume.lst: loader/xnu_resume.c $(loader/xnu_resume.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh xnu > $@ || (rm -f $@; exit 1)

handler-xnu_mod-loader_xnu_resume.lst: loader/xnu_resume.c $(loader/xnu_resume.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh xnu > $@ || (rm -f $@; exit 1)

terminal-xnu_mod-loader_xnu_resume.lst: loader/xnu_resume.c $(loader/xnu_resume.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh xnu > $@ || (rm -f $@; exit 1)

video-xnu_mod-loader_xnu_resume.lst: loader/xnu_resume.c $(loader/xnu_resume.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh xnu > $@ || (rm -f $@; exit 1)

xnu_mod-loader_i386_xnu.o: loader/i386/xnu.c $(loader/i386/xnu.c_DEPENDENCIES)
	$(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -DGRUB_FILE=\"loader/i386/xnu.c\" -MD -c -o $@ $<
-include xnu_mod-loader_i386_xnu.d

clean-module-xnu_mod-loader_i386_xnu-extra.1:
	rm -f cmd-xnu_mod-loader_i386_xnu.lst fs-xnu_mod-loader_i386_xnu.lst partmap-xnu_mod-loader_i386_xnu.lst handler-xnu_mod-loader_i386_xnu.lst parttool-xnu_mod-loader_i386_xnu.lst video-xnu_mod-loader_i386_xnu.lst terminal-xnu_mod-loader_i386_xnu.lst

CLEAN_MODULE_TARGETS += clean-module-xnu_mod-loader_i386_xnu-extra.1

COMMANDFILES += cmd-xnu_mod-loader_i386_xnu.lst
FSFILES += fs-xnu_mod-loader_i386_xnu.lst
PARTTOOLFILES += parttool-xnu_mod-loader_i386_xnu.lst
PARTMAPFILES += partmap-xnu_mod-loader_i386_xnu.lst
HANDLERFILES += handler-xnu_mod-loader_i386_xnu.lst
TERMINALFILES += terminal-xnu_mod-loader_i386_xnu.lst
VIDEOFILES += video-xnu_mod-loader_i386_xnu.lst

cmd-xnu_mod-loader_i386_xnu.lst: loader/i386/xnu.c $(loader/i386/xnu.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh xnu > $@ || (rm -f $@; exit 1)

fs-xnu_mod-loader_i386_xnu.lst: loader/i386/xnu.c $(loader/i386/xnu.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh xnu > $@ || (rm -f $@; exit 1)

parttool-xnu_mod-loader_i386_xnu.lst: loader/i386/xnu.c $(loader/i386/xnu.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh xnu > $@ || (rm -f $@; exit 1)

partmap-xnu_mod-loader_i386_xnu.lst: loader/i386/xnu.c $(loader/i386/xnu.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh xnu > $@ || (rm -f $@; exit 1)

handler-xnu_mod-loader_i386_xnu.lst: loader/i386/xnu.c $(loader/i386/xnu.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh xnu > $@ || (rm -f $@; exit 1)

terminal-xnu_mod-loader_i386_xnu.lst: loader/i386/xnu.c $(loader/i386/xnu.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh xnu > $@ || (rm -f $@; exit 1)

video-xnu_mod-loader_i386_xnu.lst: loader/i386/xnu.c $(loader/i386/xnu.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh xnu > $@ || (rm -f $@; exit 1)

xnu_mod-loader_macho32.o: loader/macho32.c $(loader/macho32.c_DEPENDENCIES)
	$(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -DGRUB_FILE=\"loader/macho32.c\" -MD -c -o $@ $<
-include xnu_mod-loader_macho32.d

clean-module-xnu_mod-loader_macho32-extra.1:
	rm -f cmd-xnu_mod-loader_macho32.lst fs-xnu_mod-loader_macho32.lst partmap-xnu_mod-loader_macho32.lst handler-xnu_mod-loader_macho32.lst parttool-xnu_mod-loader_macho32.lst video-xnu_mod-loader_macho32.lst terminal-xnu_mod-loader_macho32.lst

CLEAN_MODULE_TARGETS += clean-module-xnu_mod-loader_macho32-extra.1

COMMANDFILES += cmd-xnu_mod-loader_macho32.lst
FSFILES += fs-xnu_mod-loader_macho32.lst
PARTTOOLFILES += parttool-xnu_mod-loader_macho32.lst
PARTMAPFILES += partmap-xnu_mod-loader_macho32.lst
HANDLERFILES += handler-xnu_mod-loader_macho32.lst
TERMINALFILES += terminal-xnu_mod-loader_macho32.lst
VIDEOFILES += video-xnu_mod-loader_macho32.lst

cmd-xnu_mod-loader_macho32.lst: loader/macho32.c $(loader/macho32.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh xnu > $@ || (rm -f $@; exit 1)

fs-xnu_mod-loader_macho32.lst: loader/macho32.c $(loader/macho32.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh xnu > $@ || (rm -f $@; exit 1)

parttool-xnu_mod-loader_macho32.lst: loader/macho32.c $(loader/macho32.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh xnu > $@ || (rm -f $@; exit 1)

partmap-xnu_mod-loader_macho32.lst: loader/macho32.c $(loader/macho32.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh xnu > $@ || (rm -f $@; exit 1)

handler-xnu_mod-loader_macho32.lst: loader/macho32.c $(loader/macho32.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh xnu > $@ || (rm -f $@; exit 1)

terminal-xnu_mod-loader_macho32.lst: loader/macho32.c $(loader/macho32.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh xnu > $@ || (rm -f $@; exit 1)

video-xnu_mod-loader_macho32.lst: loader/macho32.c $(loader/macho32.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh xnu > $@ || (rm -f $@; exit 1)

xnu_mod-loader_macho64.o: loader/macho64.c $(loader/macho64.c_DEPENDENCIES)
	$(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -DGRUB_FILE=\"loader/macho64.c\" -MD -c -o $@ $<
-include xnu_mod-loader_macho64.d

clean-module-xnu_mod-loader_macho64-extra.1:
	rm -f cmd-xnu_mod-loader_macho64.lst fs-xnu_mod-loader_macho64.lst partmap-xnu_mod-loader_macho64.lst handler-xnu_mod-loader_macho64.lst parttool-xnu_mod-loader_macho64.lst video-xnu_mod-loader_macho64.lst terminal-xnu_mod-loader_macho64.lst

CLEAN_MODULE_TARGETS += clean-module-xnu_mod-loader_macho64-extra.1

COMMANDFILES += cmd-xnu_mod-loader_macho64.lst
FSFILES += fs-xnu_mod-loader_macho64.lst
PARTTOOLFILES += parttool-xnu_mod-loader_macho64.lst
PARTMAPFILES += partmap-xnu_mod-loader_macho64.lst
HANDLERFILES += handler-xnu_mod-loader_macho64.lst
TERMINALFILES += terminal-xnu_mod-loader_macho64.lst
VIDEOFILES += video-xnu_mod-loader_macho64.lst

cmd-xnu_mod-loader_macho64.lst: loader/macho64.c $(loader/macho64.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh xnu > $@ || (rm -f $@; exit 1)

fs-xnu_mod-loader_macho64.lst: loader/macho64.c $(loader/macho64.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh xnu > $@ || (rm -f $@; exit 1)

parttool-xnu_mod-loader_macho64.lst: loader/macho64.c $(loader/macho64.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh xnu > $@ || (rm -f $@; exit 1)

partmap-xnu_mod-loader_macho64.lst: loader/macho64.c $(loader/macho64.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh xnu > $@ || (rm -f $@; exit 1)

handler-xnu_mod-loader_macho64.lst: loader/macho64.c $(loader/macho64.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh xnu > $@ || (rm -f $@; exit 1)

terminal-xnu_mod-loader_macho64.lst: loader/macho64.c $(loader/macho64.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh xnu > $@ || (rm -f $@; exit 1)

video-xnu_mod-loader_macho64.lst: loader/macho64.c $(loader/macho64.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh xnu > $@ || (rm -f $@; exit 1)

xnu_mod-loader_macho.o: loader/macho.c $(loader/macho.c_DEPENDENCIES)
	$(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -DGRUB_FILE=\"loader/macho.c\" -MD -c -o $@ $<
-include xnu_mod-loader_macho.d

clean-module-xnu_mod-loader_macho-extra.1:
	rm -f cmd-xnu_mod-loader_macho.lst fs-xnu_mod-loader_macho.lst partmap-xnu_mod-loader_macho.lst handler-xnu_mod-loader_macho.lst parttool-xnu_mod-loader_macho.lst video-xnu_mod-loader_macho.lst terminal-xnu_mod-loader_macho.lst

CLEAN_MODULE_TARGETS += clean-module-xnu_mod-loader_macho-extra.1

COMMANDFILES += cmd-xnu_mod-loader_macho.lst
FSFILES += fs-xnu_mod-loader_macho.lst
PARTTOOLFILES += parttool-xnu_mod-loader_macho.lst
PARTMAPFILES += partmap-xnu_mod-loader_macho.lst
HANDLERFILES += handler-xnu_mod-loader_macho.lst
TERMINALFILES += terminal-xnu_mod-loader_macho.lst
VIDEOFILES += video-xnu_mod-loader_macho.lst

cmd-xnu_mod-loader_macho.lst: loader/macho.c $(loader/macho.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh xnu > $@ || (rm -f $@; exit 1)

fs-xnu_mod-loader_macho.lst: loader/macho.c $(loader/macho.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh xnu > $@ || (rm -f $@; exit 1)

parttool-xnu_mod-loader_macho.lst: loader/macho.c $(loader/macho.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh xnu > $@ || (rm -f $@; exit 1)

partmap-xnu_mod-loader_macho.lst: loader/macho.c $(loader/macho.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh xnu > $@ || (rm -f $@; exit 1)

handler-xnu_mod-loader_macho.lst: loader/macho.c $(loader/macho.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh xnu > $@ || (rm -f $@; exit 1)

terminal-xnu_mod-loader_macho.lst: loader/macho.c $(loader/macho.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh xnu > $@ || (rm -f $@; exit 1)

video-xnu_mod-loader_macho.lst: loader/macho.c $(loader/macho.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh xnu > $@ || (rm -f $@; exit 1)

xnu_mod-loader_xnu.o: loader/xnu.c $(loader/xnu.c_DEPENDENCIES)
	$(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -DGRUB_FILE=\"loader/xnu.c\" -MD -c -o $@ $<
-include xnu_mod-loader_xnu.d

clean-module-xnu_mod-loader_xnu-extra.1:
	rm -f cmd-xnu_mod-loader_xnu.lst fs-xnu_mod-loader_xnu.lst partmap-xnu_mod-loader_xnu.lst handler-xnu_mod-loader_xnu.lst parttool-xnu_mod-loader_xnu.lst video-xnu_mod-loader_xnu.lst terminal-xnu_mod-loader_xnu.lst

CLEAN_MODULE_TARGETS += clean-module-xnu_mod-loader_xnu-extra.1

COMMANDFILES += cmd-xnu_mod-loader_xnu.lst
FSFILES += fs-xnu_mod-loader_xnu.lst
PARTTOOLFILES += parttool-xnu_mod-loader_xnu.lst
PARTMAPFILES += partmap-xnu_mod-loader_xnu.lst
HANDLERFILES += handler-xnu_mod-loader_xnu.lst
TERMINALFILES += terminal-xnu_mod-loader_xnu.lst
VIDEOFILES += video-xnu_mod-loader_xnu.lst

cmd-xnu_mod-loader_xnu.lst: loader/xnu.c $(loader/xnu.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh xnu > $@ || (rm -f $@; exit 1)

fs-xnu_mod-loader_xnu.lst: loader/xnu.c $(loader/xnu.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh xnu > $@ || (rm -f $@; exit 1)

parttool-xnu_mod-loader_xnu.lst: loader/xnu.c $(loader/xnu.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh xnu > $@ || (rm -f $@; exit 1)

partmap-xnu_mod-loader_xnu.lst: loader/xnu.c $(loader/xnu.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh xnu > $@ || (rm -f $@; exit 1)

handler-xnu_mod-loader_xnu.lst: loader/xnu.c $(loader/xnu.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh xnu > $@ || (rm -f $@; exit 1)

terminal-xnu_mod-loader_xnu.lst: loader/xnu.c $(loader/xnu.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh xnu > $@ || (rm -f $@; exit 1)

video-xnu_mod-loader_xnu.lst: loader/xnu.c $(loader/xnu.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(xnu_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh xnu > $@ || (rm -f $@; exit 1)

xnu_mod_CFLAGS = $(COMMON_CFLAGS)
xnu_mod_LDFLAGS = $(COMMON_LDFLAGS)
xnu_mod_ASFLAGS = $(COMMON_ASFLAGS)

# For halt.mod.
halt_mod_SOURCES = commands/i386/pc/halt.c

clean-module-halt.mod.1:
	rm -f halt.mod mod-halt.o mod-halt.c pre-halt.o halt_mod-commands_i386_pc_halt.o und-halt.lst

CLEAN_MODULE_TARGETS += clean-module-halt.mod.1

clean-module-halt.mod-symbol.1:
	rm -f def-halt.lst

CLEAN_MODULE_TARGETS += clean-module-halt.mod-symbol.1
DEFSYMFILES += def-halt.lst
mostlyclean-module-halt.mod.1:
	rm -f halt_mod-commands_i386_pc_halt.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-halt.mod.1
UNDSYMFILES += und-halt.lst

ifeq ($(TARGET_NO_MODULES), yes)
halt.mod: pre-halt.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(halt_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-halt.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
halt.mod: pre-halt.o mod-halt.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(halt_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-halt.o mod-halt.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
halt.mod: pre-halt.o mod-halt.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(halt_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-halt.o mod-halt.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-halt.o: $(halt_mod_DEPENDENCIES) halt_mod-commands_i386_pc_halt.o
	-rm -f $@
	$(TARGET_CC) $(halt_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ halt_mod-commands_i386_pc_halt.o

mod-halt.o: mod-halt.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(halt_mod_CFLAGS) -DGRUB_FILE=\"mod-halt.c\" -c -o $@ $<

mod-halt.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'halt' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-halt.lst: pre-halt.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 halt/' > $@
else
def-halt.lst: pre-halt.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 halt/' > $@
endif

und-halt.lst: pre-halt.o
	echo 'halt' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

halt_mod-commands_i386_pc_halt.o: commands/i386/pc/halt.c $(commands/i386/pc/halt.c_DEPENDENCIES)
	$(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(halt_mod_CFLAGS) -DGRUB_FILE=\"commands/i386/pc/halt.c\" -MD -c -o $@ $<
-include halt_mod-commands_i386_pc_halt.d

clean-module-halt_mod-commands_i386_pc_halt-extra.1:
	rm -f cmd-halt_mod-commands_i386_pc_halt.lst fs-halt_mod-commands_i386_pc_halt.lst partmap-halt_mod-commands_i386_pc_halt.lst handler-halt_mod-commands_i386_pc_halt.lst parttool-halt_mod-commands_i386_pc_halt.lst video-halt_mod-commands_i386_pc_halt.lst terminal-halt_mod-commands_i386_pc_halt.lst

CLEAN_MODULE_TARGETS += clean-module-halt_mod-commands_i386_pc_halt-extra.1

COMMANDFILES += cmd-halt_mod-commands_i386_pc_halt.lst
FSFILES += fs-halt_mod-commands_i386_pc_halt.lst
PARTTOOLFILES += parttool-halt_mod-commands_i386_pc_halt.lst
PARTMAPFILES += partmap-halt_mod-commands_i386_pc_halt.lst
HANDLERFILES += handler-halt_mod-commands_i386_pc_halt.lst
TERMINALFILES += terminal-halt_mod-commands_i386_pc_halt.lst
VIDEOFILES += video-halt_mod-commands_i386_pc_halt.lst

cmd-halt_mod-commands_i386_pc_halt.lst: commands/i386/pc/halt.c $(commands/i386/pc/halt.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(halt_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh halt > $@ || (rm -f $@; exit 1)

fs-halt_mod-commands_i386_pc_halt.lst: commands/i386/pc/halt.c $(commands/i386/pc/halt.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(halt_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh halt > $@ || (rm -f $@; exit 1)

parttool-halt_mod-commands_i386_pc_halt.lst: commands/i386/pc/halt.c $(commands/i386/pc/halt.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(halt_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh halt > $@ || (rm -f $@; exit 1)

partmap-halt_mod-commands_i386_pc_halt.lst: commands/i386/pc/halt.c $(commands/i386/pc/halt.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(halt_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh halt > $@ || (rm -f $@; exit 1)

handler-halt_mod-commands_i386_pc_halt.lst: commands/i386/pc/halt.c $(commands/i386/pc/halt.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(halt_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh halt > $@ || (rm -f $@; exit 1)

terminal-halt_mod-commands_i386_pc_halt.lst: commands/i386/pc/halt.c $(commands/i386/pc/halt.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(halt_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh halt > $@ || (rm -f $@; exit 1)

video-halt_mod-commands_i386_pc_halt.lst: commands/i386/pc/halt.c $(commands/i386/pc/halt.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(halt_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh halt > $@ || (rm -f $@; exit 1)

halt_mod_CFLAGS = $(COMMON_CFLAGS)
halt_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For vbe.mod.
vbe_mod_SOURCES = video/i386/pc/vbe.c

clean-module-vbe.mod.1:
	rm -f vbe.mod mod-vbe.o mod-vbe.c pre-vbe.o vbe_mod-video_i386_pc_vbe.o und-vbe.lst

CLEAN_MODULE_TARGETS += clean-module-vbe.mod.1

clean-module-vbe.mod-symbol.1:
	rm -f def-vbe.lst

CLEAN_MODULE_TARGETS += clean-module-vbe.mod-symbol.1
DEFSYMFILES += def-vbe.lst
mostlyclean-module-vbe.mod.1:
	rm -f vbe_mod-video_i386_pc_vbe.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-vbe.mod.1
UNDSYMFILES += und-vbe.lst

ifeq ($(TARGET_NO_MODULES), yes)
vbe.mod: pre-vbe.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(vbe_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-vbe.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
vbe.mod: pre-vbe.o mod-vbe.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(vbe_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-vbe.o mod-vbe.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
vbe.mod: pre-vbe.o mod-vbe.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(vbe_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-vbe.o mod-vbe.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-vbe.o: $(vbe_mod_DEPENDENCIES) vbe_mod-video_i386_pc_vbe.o
	-rm -f $@
	$(TARGET_CC) $(vbe_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ vbe_mod-video_i386_pc_vbe.o

mod-vbe.o: mod-vbe.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(vbe_mod_CFLAGS) -DGRUB_FILE=\"mod-vbe.c\" -c -o $@ $<

mod-vbe.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'vbe' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-vbe.lst: pre-vbe.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 vbe/' > $@
else
def-vbe.lst: pre-vbe.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 vbe/' > $@
endif

und-vbe.lst: pre-vbe.o
	echo 'vbe' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

vbe_mod-video_i386_pc_vbe.o: video/i386/pc/vbe.c $(video/i386/pc/vbe.c_DEPENDENCIES)
	$(TARGET_CC) -Ivideo/i386/pc -I$(srcdir)/video/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vbe_mod_CFLAGS) -DGRUB_FILE=\"video/i386/pc/vbe.c\" -MD -c -o $@ $<
-include vbe_mod-video_i386_pc_vbe.d

clean-module-vbe_mod-video_i386_pc_vbe-extra.1:
	rm -f cmd-vbe_mod-video_i386_pc_vbe.lst fs-vbe_mod-video_i386_pc_vbe.lst partmap-vbe_mod-video_i386_pc_vbe.lst handler-vbe_mod-video_i386_pc_vbe.lst parttool-vbe_mod-video_i386_pc_vbe.lst video-vbe_mod-video_i386_pc_vbe.lst terminal-vbe_mod-video_i386_pc_vbe.lst

CLEAN_MODULE_TARGETS += clean-module-vbe_mod-video_i386_pc_vbe-extra.1

COMMANDFILES += cmd-vbe_mod-video_i386_pc_vbe.lst
FSFILES += fs-vbe_mod-video_i386_pc_vbe.lst
PARTTOOLFILES += parttool-vbe_mod-video_i386_pc_vbe.lst
PARTMAPFILES += partmap-vbe_mod-video_i386_pc_vbe.lst
HANDLERFILES += handler-vbe_mod-video_i386_pc_vbe.lst
TERMINALFILES += terminal-vbe_mod-video_i386_pc_vbe.lst
VIDEOFILES += video-vbe_mod-video_i386_pc_vbe.lst

cmd-vbe_mod-video_i386_pc_vbe.lst: video/i386/pc/vbe.c $(video/i386/pc/vbe.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Ivideo/i386/pc -I$(srcdir)/video/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vbe_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh vbe > $@ || (rm -f $@; exit 1)

fs-vbe_mod-video_i386_pc_vbe.lst: video/i386/pc/vbe.c $(video/i386/pc/vbe.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Ivideo/i386/pc -I$(srcdir)/video/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(vbe_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh vbe > $@ || (rm -f $@; exit 1)

parttool-vbe_mod-video_i386_pc_vbe.lst: video/i386/pc/vbe.c $(video/i386/pc/vbe.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Ivideo/i386/pc -I$(srcdir)/video/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vbe_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh vbe > $@ || (rm -f $@; exit 1)

partmap-vbe_mod-video_i386_pc_vbe.lst: video/i386/pc/vbe.c $(video/i386/pc/vbe.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Ivideo/i386/pc -I$(srcdir)/video/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(vbe_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh vbe > $@ || (rm -f $@; exit 1)

handler-vbe_mod-video_i386_pc_vbe.lst: video/i386/pc/vbe.c $(video/i386/pc/vbe.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Ivideo/i386/pc -I$(srcdir)/video/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vbe_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh vbe > $@ || (rm -f $@; exit 1)

terminal-vbe_mod-video_i386_pc_vbe.lst: video/i386/pc/vbe.c $(video/i386/pc/vbe.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Ivideo/i386/pc -I$(srcdir)/video/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vbe_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh vbe > $@ || (rm -f $@; exit 1)

video-vbe_mod-video_i386_pc_vbe.lst: video/i386/pc/vbe.c $(video/i386/pc/vbe.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Ivideo/i386/pc -I$(srcdir)/video/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(vbe_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh vbe > $@ || (rm -f $@; exit 1)

vbe_mod_CFLAGS = $(COMMON_CFLAGS)
vbe_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For vbeinfo.mod.
vbeinfo_mod_SOURCES = commands/i386/pc/vbeinfo.c

clean-module-vbeinfo.mod.1:
	rm -f vbeinfo.mod mod-vbeinfo.o mod-vbeinfo.c pre-vbeinfo.o vbeinfo_mod-commands_i386_pc_vbeinfo.o und-vbeinfo.lst

CLEAN_MODULE_TARGETS += clean-module-vbeinfo.mod.1

clean-module-vbeinfo.mod-symbol.1:
	rm -f def-vbeinfo.lst

CLEAN_MODULE_TARGETS += clean-module-vbeinfo.mod-symbol.1
DEFSYMFILES += def-vbeinfo.lst
mostlyclean-module-vbeinfo.mod.1:
	rm -f vbeinfo_mod-commands_i386_pc_vbeinfo.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-vbeinfo.mod.1
UNDSYMFILES += und-vbeinfo.lst

ifeq ($(TARGET_NO_MODULES), yes)
vbeinfo.mod: pre-vbeinfo.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(vbeinfo_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-vbeinfo.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
vbeinfo.mod: pre-vbeinfo.o mod-vbeinfo.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(vbeinfo_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-vbeinfo.o mod-vbeinfo.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
vbeinfo.mod: pre-vbeinfo.o mod-vbeinfo.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(vbeinfo_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-vbeinfo.o mod-vbeinfo.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-vbeinfo.o: $(vbeinfo_mod_DEPENDENCIES) vbeinfo_mod-commands_i386_pc_vbeinfo.o
	-rm -f $@
	$(TARGET_CC) $(vbeinfo_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ vbeinfo_mod-commands_i386_pc_vbeinfo.o

mod-vbeinfo.o: mod-vbeinfo.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(vbeinfo_mod_CFLAGS) -DGRUB_FILE=\"mod-vbeinfo.c\" -c -o $@ $<

mod-vbeinfo.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'vbeinfo' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-vbeinfo.lst: pre-vbeinfo.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 vbeinfo/' > $@
else
def-vbeinfo.lst: pre-vbeinfo.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 vbeinfo/' > $@
endif

und-vbeinfo.lst: pre-vbeinfo.o
	echo 'vbeinfo' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

vbeinfo_mod-commands_i386_pc_vbeinfo.o: commands/i386/pc/vbeinfo.c $(commands/i386/pc/vbeinfo.c_DEPENDENCIES)
	$(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vbeinfo_mod_CFLAGS) -DGRUB_FILE=\"commands/i386/pc/vbeinfo.c\" -MD -c -o $@ $<
-include vbeinfo_mod-commands_i386_pc_vbeinfo.d

clean-module-vbeinfo_mod-commands_i386_pc_vbeinfo-extra.1:
	rm -f cmd-vbeinfo_mod-commands_i386_pc_vbeinfo.lst fs-vbeinfo_mod-commands_i386_pc_vbeinfo.lst partmap-vbeinfo_mod-commands_i386_pc_vbeinfo.lst handler-vbeinfo_mod-commands_i386_pc_vbeinfo.lst parttool-vbeinfo_mod-commands_i386_pc_vbeinfo.lst video-vbeinfo_mod-commands_i386_pc_vbeinfo.lst terminal-vbeinfo_mod-commands_i386_pc_vbeinfo.lst

CLEAN_MODULE_TARGETS += clean-module-vbeinfo_mod-commands_i386_pc_vbeinfo-extra.1

COMMANDFILES += cmd-vbeinfo_mod-commands_i386_pc_vbeinfo.lst
FSFILES += fs-vbeinfo_mod-commands_i386_pc_vbeinfo.lst
PARTTOOLFILES += parttool-vbeinfo_mod-commands_i386_pc_vbeinfo.lst
PARTMAPFILES += partmap-vbeinfo_mod-commands_i386_pc_vbeinfo.lst
HANDLERFILES += handler-vbeinfo_mod-commands_i386_pc_vbeinfo.lst
TERMINALFILES += terminal-vbeinfo_mod-commands_i386_pc_vbeinfo.lst
VIDEOFILES += video-vbeinfo_mod-commands_i386_pc_vbeinfo.lst

cmd-vbeinfo_mod-commands_i386_pc_vbeinfo.lst: commands/i386/pc/vbeinfo.c $(commands/i386/pc/vbeinfo.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vbeinfo_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh vbeinfo > $@ || (rm -f $@; exit 1)

fs-vbeinfo_mod-commands_i386_pc_vbeinfo.lst: commands/i386/pc/vbeinfo.c $(commands/i386/pc/vbeinfo.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(vbeinfo_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh vbeinfo > $@ || (rm -f $@; exit 1)

parttool-vbeinfo_mod-commands_i386_pc_vbeinfo.lst: commands/i386/pc/vbeinfo.c $(commands/i386/pc/vbeinfo.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vbeinfo_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh vbeinfo > $@ || (rm -f $@; exit 1)

partmap-vbeinfo_mod-commands_i386_pc_vbeinfo.lst: commands/i386/pc/vbeinfo.c $(commands/i386/pc/vbeinfo.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(vbeinfo_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh vbeinfo > $@ || (rm -f $@; exit 1)

handler-vbeinfo_mod-commands_i386_pc_vbeinfo.lst: commands/i386/pc/vbeinfo.c $(commands/i386/pc/vbeinfo.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vbeinfo_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh vbeinfo > $@ || (rm -f $@; exit 1)

terminal-vbeinfo_mod-commands_i386_pc_vbeinfo.lst: commands/i386/pc/vbeinfo.c $(commands/i386/pc/vbeinfo.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vbeinfo_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh vbeinfo > $@ || (rm -f $@; exit 1)

video-vbeinfo_mod-commands_i386_pc_vbeinfo.lst: commands/i386/pc/vbeinfo.c $(commands/i386/pc/vbeinfo.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(vbeinfo_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh vbeinfo > $@ || (rm -f $@; exit 1)

vbeinfo_mod_CFLAGS = $(COMMON_CFLAGS)
vbeinfo_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For vbetest.mod.
vbetest_mod_SOURCES = commands/i386/pc/vbetest.c

clean-module-vbetest.mod.1:
	rm -f vbetest.mod mod-vbetest.o mod-vbetest.c pre-vbetest.o vbetest_mod-commands_i386_pc_vbetest.o und-vbetest.lst

CLEAN_MODULE_TARGETS += clean-module-vbetest.mod.1

clean-module-vbetest.mod-symbol.1:
	rm -f def-vbetest.lst

CLEAN_MODULE_TARGETS += clean-module-vbetest.mod-symbol.1
DEFSYMFILES += def-vbetest.lst
mostlyclean-module-vbetest.mod.1:
	rm -f vbetest_mod-commands_i386_pc_vbetest.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-vbetest.mod.1
UNDSYMFILES += und-vbetest.lst

ifeq ($(TARGET_NO_MODULES), yes)
vbetest.mod: pre-vbetest.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(vbetest_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-vbetest.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
vbetest.mod: pre-vbetest.o mod-vbetest.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(vbetest_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-vbetest.o mod-vbetest.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
vbetest.mod: pre-vbetest.o mod-vbetest.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(vbetest_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-vbetest.o mod-vbetest.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-vbetest.o: $(vbetest_mod_DEPENDENCIES) vbetest_mod-commands_i386_pc_vbetest.o
	-rm -f $@
	$(TARGET_CC) $(vbetest_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ vbetest_mod-commands_i386_pc_vbetest.o

mod-vbetest.o: mod-vbetest.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(vbetest_mod_CFLAGS) -DGRUB_FILE=\"mod-vbetest.c\" -c -o $@ $<

mod-vbetest.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'vbetest' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-vbetest.lst: pre-vbetest.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 vbetest/' > $@
else
def-vbetest.lst: pre-vbetest.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 vbetest/' > $@
endif

und-vbetest.lst: pre-vbetest.o
	echo 'vbetest' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

vbetest_mod-commands_i386_pc_vbetest.o: commands/i386/pc/vbetest.c $(commands/i386/pc/vbetest.c_DEPENDENCIES)
	$(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vbetest_mod_CFLAGS) -DGRUB_FILE=\"commands/i386/pc/vbetest.c\" -MD -c -o $@ $<
-include vbetest_mod-commands_i386_pc_vbetest.d

clean-module-vbetest_mod-commands_i386_pc_vbetest-extra.1:
	rm -f cmd-vbetest_mod-commands_i386_pc_vbetest.lst fs-vbetest_mod-commands_i386_pc_vbetest.lst partmap-vbetest_mod-commands_i386_pc_vbetest.lst handler-vbetest_mod-commands_i386_pc_vbetest.lst parttool-vbetest_mod-commands_i386_pc_vbetest.lst video-vbetest_mod-commands_i386_pc_vbetest.lst terminal-vbetest_mod-commands_i386_pc_vbetest.lst

CLEAN_MODULE_TARGETS += clean-module-vbetest_mod-commands_i386_pc_vbetest-extra.1

COMMANDFILES += cmd-vbetest_mod-commands_i386_pc_vbetest.lst
FSFILES += fs-vbetest_mod-commands_i386_pc_vbetest.lst
PARTTOOLFILES += parttool-vbetest_mod-commands_i386_pc_vbetest.lst
PARTMAPFILES += partmap-vbetest_mod-commands_i386_pc_vbetest.lst
HANDLERFILES += handler-vbetest_mod-commands_i386_pc_vbetest.lst
TERMINALFILES += terminal-vbetest_mod-commands_i386_pc_vbetest.lst
VIDEOFILES += video-vbetest_mod-commands_i386_pc_vbetest.lst

cmd-vbetest_mod-commands_i386_pc_vbetest.lst: commands/i386/pc/vbetest.c $(commands/i386/pc/vbetest.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vbetest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh vbetest > $@ || (rm -f $@; exit 1)

fs-vbetest_mod-commands_i386_pc_vbetest.lst: commands/i386/pc/vbetest.c $(commands/i386/pc/vbetest.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(vbetest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh vbetest > $@ || (rm -f $@; exit 1)

parttool-vbetest_mod-commands_i386_pc_vbetest.lst: commands/i386/pc/vbetest.c $(commands/i386/pc/vbetest.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vbetest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh vbetest > $@ || (rm -f $@; exit 1)

partmap-vbetest_mod-commands_i386_pc_vbetest.lst: commands/i386/pc/vbetest.c $(commands/i386/pc/vbetest.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(vbetest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh vbetest > $@ || (rm -f $@; exit 1)

handler-vbetest_mod-commands_i386_pc_vbetest.lst: commands/i386/pc/vbetest.c $(commands/i386/pc/vbetest.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vbetest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh vbetest > $@ || (rm -f $@; exit 1)

terminal-vbetest_mod-commands_i386_pc_vbetest.lst: commands/i386/pc/vbetest.c $(commands/i386/pc/vbetest.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vbetest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh vbetest > $@ || (rm -f $@; exit 1)

video-vbetest_mod-commands_i386_pc_vbetest.lst: commands/i386/pc/vbetest.c $(commands/i386/pc/vbetest.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(vbetest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh vbetest > $@ || (rm -f $@; exit 1)

vbetest_mod_CFLAGS = $(COMMON_CFLAGS)
vbetest_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For vga.mod.
vga_mod_SOURCES = video/i386/pc/vga.c

clean-module-vga.mod.1:
	rm -f vga.mod mod-vga.o mod-vga.c pre-vga.o vga_mod-video_i386_pc_vga.o und-vga.lst

CLEAN_MODULE_TARGETS += clean-module-vga.mod.1

clean-module-vga.mod-symbol.1:
	rm -f def-vga.lst

CLEAN_MODULE_TARGETS += clean-module-vga.mod-symbol.1
DEFSYMFILES += def-vga.lst
mostlyclean-module-vga.mod.1:
	rm -f vga_mod-video_i386_pc_vga.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-vga.mod.1
UNDSYMFILES += und-vga.lst

ifeq ($(TARGET_NO_MODULES), yes)
vga.mod: pre-vga.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(vga_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-vga.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
vga.mod: pre-vga.o mod-vga.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(vga_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-vga.o mod-vga.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
vga.mod: pre-vga.o mod-vga.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(vga_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-vga.o mod-vga.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-vga.o: $(vga_mod_DEPENDENCIES) vga_mod-video_i386_pc_vga.o
	-rm -f $@
	$(TARGET_CC) $(vga_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ vga_mod-video_i386_pc_vga.o

mod-vga.o: mod-vga.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(vga_mod_CFLAGS) -DGRUB_FILE=\"mod-vga.c\" -c -o $@ $<

mod-vga.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'vga' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-vga.lst: pre-vga.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 vga/' > $@
else
def-vga.lst: pre-vga.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 vga/' > $@
endif

und-vga.lst: pre-vga.o
	echo 'vga' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

vga_mod-video_i386_pc_vga.o: video/i386/pc/vga.c $(video/i386/pc/vga.c_DEPENDENCIES)
	$(TARGET_CC) -Ivideo/i386/pc -I$(srcdir)/video/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vga_mod_CFLAGS) -DGRUB_FILE=\"video/i386/pc/vga.c\" -MD -c -o $@ $<
-include vga_mod-video_i386_pc_vga.d

clean-module-vga_mod-video_i386_pc_vga-extra.1:
	rm -f cmd-vga_mod-video_i386_pc_vga.lst fs-vga_mod-video_i386_pc_vga.lst partmap-vga_mod-video_i386_pc_vga.lst handler-vga_mod-video_i386_pc_vga.lst parttool-vga_mod-video_i386_pc_vga.lst video-vga_mod-video_i386_pc_vga.lst terminal-vga_mod-video_i386_pc_vga.lst

CLEAN_MODULE_TARGETS += clean-module-vga_mod-video_i386_pc_vga-extra.1

COMMANDFILES += cmd-vga_mod-video_i386_pc_vga.lst
FSFILES += fs-vga_mod-video_i386_pc_vga.lst
PARTTOOLFILES += parttool-vga_mod-video_i386_pc_vga.lst
PARTMAPFILES += partmap-vga_mod-video_i386_pc_vga.lst
HANDLERFILES += handler-vga_mod-video_i386_pc_vga.lst
TERMINALFILES += terminal-vga_mod-video_i386_pc_vga.lst
VIDEOFILES += video-vga_mod-video_i386_pc_vga.lst

cmd-vga_mod-video_i386_pc_vga.lst: video/i386/pc/vga.c $(video/i386/pc/vga.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Ivideo/i386/pc -I$(srcdir)/video/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vga_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh vga > $@ || (rm -f $@; exit 1)

fs-vga_mod-video_i386_pc_vga.lst: video/i386/pc/vga.c $(video/i386/pc/vga.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Ivideo/i386/pc -I$(srcdir)/video/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(vga_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh vga > $@ || (rm -f $@; exit 1)

parttool-vga_mod-video_i386_pc_vga.lst: video/i386/pc/vga.c $(video/i386/pc/vga.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Ivideo/i386/pc -I$(srcdir)/video/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vga_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh vga > $@ || (rm -f $@; exit 1)

partmap-vga_mod-video_i386_pc_vga.lst: video/i386/pc/vga.c $(video/i386/pc/vga.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Ivideo/i386/pc -I$(srcdir)/video/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(vga_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh vga > $@ || (rm -f $@; exit 1)

handler-vga_mod-video_i386_pc_vga.lst: video/i386/pc/vga.c $(video/i386/pc/vga.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Ivideo/i386/pc -I$(srcdir)/video/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vga_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh vga > $@ || (rm -f $@; exit 1)

terminal-vga_mod-video_i386_pc_vga.lst: video/i386/pc/vga.c $(video/i386/pc/vga.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Ivideo/i386/pc -I$(srcdir)/video/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(vga_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh vga > $@ || (rm -f $@; exit 1)

video-vga_mod-video_i386_pc_vga.lst: video/i386/pc/vga.c $(video/i386/pc/vga.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Ivideo/i386/pc -I$(srcdir)/video/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(vga_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh vga > $@ || (rm -f $@; exit 1)

vga_mod_CFLAGS = $(COMMON_CFLAGS)
vga_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For aout.mod
aout_mod_SOURCES = loader/aout.c

clean-module-aout.mod.1:
	rm -f aout.mod mod-aout.o mod-aout.c pre-aout.o aout_mod-loader_aout.o und-aout.lst

CLEAN_MODULE_TARGETS += clean-module-aout.mod.1

clean-module-aout.mod-symbol.1:
	rm -f def-aout.lst

CLEAN_MODULE_TARGETS += clean-module-aout.mod-symbol.1
DEFSYMFILES += def-aout.lst
mostlyclean-module-aout.mod.1:
	rm -f aout_mod-loader_aout.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-aout.mod.1
UNDSYMFILES += und-aout.lst

ifeq ($(TARGET_NO_MODULES), yes)
aout.mod: pre-aout.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(aout_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-aout.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
aout.mod: pre-aout.o mod-aout.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(aout_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-aout.o mod-aout.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
aout.mod: pre-aout.o mod-aout.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(aout_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-aout.o mod-aout.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-aout.o: $(aout_mod_DEPENDENCIES) aout_mod-loader_aout.o
	-rm -f $@
	$(TARGET_CC) $(aout_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ aout_mod-loader_aout.o

mod-aout.o: mod-aout.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(aout_mod_CFLAGS) -DGRUB_FILE=\"mod-aout.c\" -c -o $@ $<

mod-aout.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'aout' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-aout.lst: pre-aout.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 aout/' > $@
else
def-aout.lst: pre-aout.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 aout/' > $@
endif

und-aout.lst: pre-aout.o
	echo 'aout' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

aout_mod-loader_aout.o: loader/aout.c $(loader/aout.c_DEPENDENCIES)
	$(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(aout_mod_CFLAGS) -DGRUB_FILE=\"loader/aout.c\" -MD -c -o $@ $<
-include aout_mod-loader_aout.d

clean-module-aout_mod-loader_aout-extra.1:
	rm -f cmd-aout_mod-loader_aout.lst fs-aout_mod-loader_aout.lst partmap-aout_mod-loader_aout.lst handler-aout_mod-loader_aout.lst parttool-aout_mod-loader_aout.lst video-aout_mod-loader_aout.lst terminal-aout_mod-loader_aout.lst

CLEAN_MODULE_TARGETS += clean-module-aout_mod-loader_aout-extra.1

COMMANDFILES += cmd-aout_mod-loader_aout.lst
FSFILES += fs-aout_mod-loader_aout.lst
PARTTOOLFILES += parttool-aout_mod-loader_aout.lst
PARTMAPFILES += partmap-aout_mod-loader_aout.lst
HANDLERFILES += handler-aout_mod-loader_aout.lst
TERMINALFILES += terminal-aout_mod-loader_aout.lst
VIDEOFILES += video-aout_mod-loader_aout.lst

cmd-aout_mod-loader_aout.lst: loader/aout.c $(loader/aout.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(aout_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh aout > $@ || (rm -f $@; exit 1)

fs-aout_mod-loader_aout.lst: loader/aout.c $(loader/aout.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(aout_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh aout > $@ || (rm -f $@; exit 1)

parttool-aout_mod-loader_aout.lst: loader/aout.c $(loader/aout.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(aout_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh aout > $@ || (rm -f $@; exit 1)

partmap-aout_mod-loader_aout.lst: loader/aout.c $(loader/aout.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(aout_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh aout > $@ || (rm -f $@; exit 1)

handler-aout_mod-loader_aout.lst: loader/aout.c $(loader/aout.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(aout_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh aout > $@ || (rm -f $@; exit 1)

terminal-aout_mod-loader_aout.lst: loader/aout.c $(loader/aout.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(aout_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh aout > $@ || (rm -f $@; exit 1)

video-aout_mod-loader_aout.lst: loader/aout.c $(loader/aout.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iloader -I$(srcdir)/loader $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(aout_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh aout > $@ || (rm -f $@; exit 1)

aout_mod_CFLAGS = $(COMMON_CFLAGS)
aout_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For bsd.mod
bsd_mod_SOURCES = loader/i386/bsd.c loader/i386/bsd32.c loader/i386/bsd64.c loader/i386/bsd_helper.S loader/i386/bsd_trampoline.S

clean-module-bsd.mod.1:
	rm -f bsd.mod mod-bsd.o mod-bsd.c pre-bsd.o bsd_mod-loader_i386_bsd.o bsd_mod-loader_i386_bsd32.o bsd_mod-loader_i386_bsd64.o bsd_mod-loader_i386_bsd_helper.o bsd_mod-loader_i386_bsd_trampoline.o und-bsd.lst

CLEAN_MODULE_TARGETS += clean-module-bsd.mod.1

clean-module-bsd.mod-symbol.1:
	rm -f def-bsd.lst

CLEAN_MODULE_TARGETS += clean-module-bsd.mod-symbol.1
DEFSYMFILES += def-bsd.lst
mostlyclean-module-bsd.mod.1:
	rm -f bsd_mod-loader_i386_bsd.d bsd_mod-loader_i386_bsd32.d bsd_mod-loader_i386_bsd64.d bsd_mod-loader_i386_bsd_helper.d bsd_mod-loader_i386_bsd_trampoline.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-bsd.mod.1
UNDSYMFILES += und-bsd.lst

ifeq ($(TARGET_NO_MODULES), yes)
bsd.mod: pre-bsd.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(bsd_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-bsd.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
bsd.mod: pre-bsd.o mod-bsd.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(bsd_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-bsd.o mod-bsd.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
bsd.mod: pre-bsd.o mod-bsd.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(bsd_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-bsd.o mod-bsd.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-bsd.o: $(bsd_mod_DEPENDENCIES) bsd_mod-loader_i386_bsd.o bsd_mod-loader_i386_bsd32.o bsd_mod-loader_i386_bsd64.o bsd_mod-loader_i386_bsd_helper.o bsd_mod-loader_i386_bsd_trampoline.o
	-rm -f $@
	$(TARGET_CC) $(bsd_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ bsd_mod-loader_i386_bsd.o bsd_mod-loader_i386_bsd32.o bsd_mod-loader_i386_bsd64.o bsd_mod-loader_i386_bsd_helper.o bsd_mod-loader_i386_bsd_trampoline.o

mod-bsd.o: mod-bsd.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -DGRUB_FILE=\"mod-bsd.c\" -c -o $@ $<

mod-bsd.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'bsd' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-bsd.lst: pre-bsd.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 bsd/' > $@
else
def-bsd.lst: pre-bsd.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 bsd/' > $@
endif

und-bsd.lst: pre-bsd.o
	echo 'bsd' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

bsd_mod-loader_i386_bsd.o: loader/i386/bsd.c $(loader/i386/bsd.c_DEPENDENCIES)
	$(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -DGRUB_FILE=\"loader/i386/bsd.c\" -MD -c -o $@ $<
-include bsd_mod-loader_i386_bsd.d

clean-module-bsd_mod-loader_i386_bsd-extra.1:
	rm -f cmd-bsd_mod-loader_i386_bsd.lst fs-bsd_mod-loader_i386_bsd.lst partmap-bsd_mod-loader_i386_bsd.lst handler-bsd_mod-loader_i386_bsd.lst parttool-bsd_mod-loader_i386_bsd.lst video-bsd_mod-loader_i386_bsd.lst terminal-bsd_mod-loader_i386_bsd.lst

CLEAN_MODULE_TARGETS += clean-module-bsd_mod-loader_i386_bsd-extra.1

COMMANDFILES += cmd-bsd_mod-loader_i386_bsd.lst
FSFILES += fs-bsd_mod-loader_i386_bsd.lst
PARTTOOLFILES += parttool-bsd_mod-loader_i386_bsd.lst
PARTMAPFILES += partmap-bsd_mod-loader_i386_bsd.lst
HANDLERFILES += handler-bsd_mod-loader_i386_bsd.lst
TERMINALFILES += terminal-bsd_mod-loader_i386_bsd.lst
VIDEOFILES += video-bsd_mod-loader_i386_bsd.lst

cmd-bsd_mod-loader_i386_bsd.lst: loader/i386/bsd.c $(loader/i386/bsd.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh bsd > $@ || (rm -f $@; exit 1)

fs-bsd_mod-loader_i386_bsd.lst: loader/i386/bsd.c $(loader/i386/bsd.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh bsd > $@ || (rm -f $@; exit 1)

parttool-bsd_mod-loader_i386_bsd.lst: loader/i386/bsd.c $(loader/i386/bsd.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh bsd > $@ || (rm -f $@; exit 1)

partmap-bsd_mod-loader_i386_bsd.lst: loader/i386/bsd.c $(loader/i386/bsd.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh bsd > $@ || (rm -f $@; exit 1)

handler-bsd_mod-loader_i386_bsd.lst: loader/i386/bsd.c $(loader/i386/bsd.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh bsd > $@ || (rm -f $@; exit 1)

terminal-bsd_mod-loader_i386_bsd.lst: loader/i386/bsd.c $(loader/i386/bsd.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh bsd > $@ || (rm -f $@; exit 1)

video-bsd_mod-loader_i386_bsd.lst: loader/i386/bsd.c $(loader/i386/bsd.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh bsd > $@ || (rm -f $@; exit 1)

bsd_mod-loader_i386_bsd32.o: loader/i386/bsd32.c $(loader/i386/bsd32.c_DEPENDENCIES)
	$(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -DGRUB_FILE=\"loader/i386/bsd32.c\" -MD -c -o $@ $<
-include bsd_mod-loader_i386_bsd32.d

clean-module-bsd_mod-loader_i386_bsd32-extra.1:
	rm -f cmd-bsd_mod-loader_i386_bsd32.lst fs-bsd_mod-loader_i386_bsd32.lst partmap-bsd_mod-loader_i386_bsd32.lst handler-bsd_mod-loader_i386_bsd32.lst parttool-bsd_mod-loader_i386_bsd32.lst video-bsd_mod-loader_i386_bsd32.lst terminal-bsd_mod-loader_i386_bsd32.lst

CLEAN_MODULE_TARGETS += clean-module-bsd_mod-loader_i386_bsd32-extra.1

COMMANDFILES += cmd-bsd_mod-loader_i386_bsd32.lst
FSFILES += fs-bsd_mod-loader_i386_bsd32.lst
PARTTOOLFILES += parttool-bsd_mod-loader_i386_bsd32.lst
PARTMAPFILES += partmap-bsd_mod-loader_i386_bsd32.lst
HANDLERFILES += handler-bsd_mod-loader_i386_bsd32.lst
TERMINALFILES += terminal-bsd_mod-loader_i386_bsd32.lst
VIDEOFILES += video-bsd_mod-loader_i386_bsd32.lst

cmd-bsd_mod-loader_i386_bsd32.lst: loader/i386/bsd32.c $(loader/i386/bsd32.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh bsd > $@ || (rm -f $@; exit 1)

fs-bsd_mod-loader_i386_bsd32.lst: loader/i386/bsd32.c $(loader/i386/bsd32.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh bsd > $@ || (rm -f $@; exit 1)

parttool-bsd_mod-loader_i386_bsd32.lst: loader/i386/bsd32.c $(loader/i386/bsd32.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh bsd > $@ || (rm -f $@; exit 1)

partmap-bsd_mod-loader_i386_bsd32.lst: loader/i386/bsd32.c $(loader/i386/bsd32.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh bsd > $@ || (rm -f $@; exit 1)

handler-bsd_mod-loader_i386_bsd32.lst: loader/i386/bsd32.c $(loader/i386/bsd32.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh bsd > $@ || (rm -f $@; exit 1)

terminal-bsd_mod-loader_i386_bsd32.lst: loader/i386/bsd32.c $(loader/i386/bsd32.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh bsd > $@ || (rm -f $@; exit 1)

video-bsd_mod-loader_i386_bsd32.lst: loader/i386/bsd32.c $(loader/i386/bsd32.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh bsd > $@ || (rm -f $@; exit 1)

bsd_mod-loader_i386_bsd64.o: loader/i386/bsd64.c $(loader/i386/bsd64.c_DEPENDENCIES)
	$(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -DGRUB_FILE=\"loader/i386/bsd64.c\" -MD -c -o $@ $<
-include bsd_mod-loader_i386_bsd64.d

clean-module-bsd_mod-loader_i386_bsd64-extra.1:
	rm -f cmd-bsd_mod-loader_i386_bsd64.lst fs-bsd_mod-loader_i386_bsd64.lst partmap-bsd_mod-loader_i386_bsd64.lst handler-bsd_mod-loader_i386_bsd64.lst parttool-bsd_mod-loader_i386_bsd64.lst video-bsd_mod-loader_i386_bsd64.lst terminal-bsd_mod-loader_i386_bsd64.lst

CLEAN_MODULE_TARGETS += clean-module-bsd_mod-loader_i386_bsd64-extra.1

COMMANDFILES += cmd-bsd_mod-loader_i386_bsd64.lst
FSFILES += fs-bsd_mod-loader_i386_bsd64.lst
PARTTOOLFILES += parttool-bsd_mod-loader_i386_bsd64.lst
PARTMAPFILES += partmap-bsd_mod-loader_i386_bsd64.lst
HANDLERFILES += handler-bsd_mod-loader_i386_bsd64.lst
TERMINALFILES += terminal-bsd_mod-loader_i386_bsd64.lst
VIDEOFILES += video-bsd_mod-loader_i386_bsd64.lst

cmd-bsd_mod-loader_i386_bsd64.lst: loader/i386/bsd64.c $(loader/i386/bsd64.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh bsd > $@ || (rm -f $@; exit 1)

fs-bsd_mod-loader_i386_bsd64.lst: loader/i386/bsd64.c $(loader/i386/bsd64.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh bsd > $@ || (rm -f $@; exit 1)

parttool-bsd_mod-loader_i386_bsd64.lst: loader/i386/bsd64.c $(loader/i386/bsd64.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh bsd > $@ || (rm -f $@; exit 1)

partmap-bsd_mod-loader_i386_bsd64.lst: loader/i386/bsd64.c $(loader/i386/bsd64.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh bsd > $@ || (rm -f $@; exit 1)

handler-bsd_mod-loader_i386_bsd64.lst: loader/i386/bsd64.c $(loader/i386/bsd64.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh bsd > $@ || (rm -f $@; exit 1)

terminal-bsd_mod-loader_i386_bsd64.lst: loader/i386/bsd64.c $(loader/i386/bsd64.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh bsd > $@ || (rm -f $@; exit 1)

video-bsd_mod-loader_i386_bsd64.lst: loader/i386/bsd64.c $(loader/i386/bsd64.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(bsd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh bsd > $@ || (rm -f $@; exit 1)

bsd_mod-loader_i386_bsd_helper.o: loader/i386/bsd_helper.S $(loader/i386/bsd_helper.S_DEPENDENCIES)
	$(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(bsd_mod_ASFLAGS) -DGRUB_FILE=\"loader/i386/bsd_helper.S\" -MD -c -o $@ $<
-include bsd_mod-loader_i386_bsd_helper.d

clean-module-bsd_mod-loader_i386_bsd_helper-extra.1:
	rm -f cmd-bsd_mod-loader_i386_bsd_helper.lst fs-bsd_mod-loader_i386_bsd_helper.lst partmap-bsd_mod-loader_i386_bsd_helper.lst handler-bsd_mod-loader_i386_bsd_helper.lst parttool-bsd_mod-loader_i386_bsd_helper.lst video-bsd_mod-loader_i386_bsd_helper.lst terminal-bsd_mod-loader_i386_bsd_helper.lst

CLEAN_MODULE_TARGETS += clean-module-bsd_mod-loader_i386_bsd_helper-extra.1

COMMANDFILES += cmd-bsd_mod-loader_i386_bsd_helper.lst
FSFILES += fs-bsd_mod-loader_i386_bsd_helper.lst
PARTTOOLFILES += parttool-bsd_mod-loader_i386_bsd_helper.lst
PARTMAPFILES += partmap-bsd_mod-loader_i386_bsd_helper.lst
HANDLERFILES += handler-bsd_mod-loader_i386_bsd_helper.lst
TERMINALFILES += terminal-bsd_mod-loader_i386_bsd_helper.lst
VIDEOFILES += video-bsd_mod-loader_i386_bsd_helper.lst

cmd-bsd_mod-loader_i386_bsd_helper.lst: loader/i386/bsd_helper.S $(loader/i386/bsd_helper.S_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(bsd_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh bsd > $@ || (rm -f $@; exit 1)

fs-bsd_mod-loader_i386_bsd_helper.lst: loader/i386/bsd_helper.S $(loader/i386/bsd_helper.S_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS) -DASM_FILE=1 -DGRUB_LST_GENERATOR $(TARGET_ASFLAGS) $(bsd_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh bsd > $@ || (rm -f $@; exit 1)

parttool-bsd_mod-loader_i386_bsd_helper.lst: loader/i386/bsd_helper.S $(loader/i386/bsd_helper.S_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(bsd_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh bsd > $@ || (rm -f $@; exit 1)

partmap-bsd_mod-loader_i386_bsd_helper.lst: loader/i386/bsd_helper.S $(loader/i386/bsd_helper.S_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS) -DASM_FILE=1 -DGRUB_LST_GENERATOR $(TARGET_ASFLAGS) $(bsd_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh bsd > $@ || (rm -f $@; exit 1)

handler-bsd_mod-loader_i386_bsd_helper.lst: loader/i386/bsd_helper.S $(loader/i386/bsd_helper.S_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(bsd_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh bsd > $@ || (rm -f $@; exit 1)

terminal-bsd_mod-loader_i386_bsd_helper.lst: loader/i386/bsd_helper.S $(loader/i386/bsd_helper.S_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(bsd_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh bsd > $@ || (rm -f $@; exit 1)

video-bsd_mod-loader_i386_bsd_helper.lst: loader/i386/bsd_helper.S $(loader/i386/bsd_helper.S_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS) -DASM_FILE=1 -DGRUB_LST_GENERATOR $(TARGET_ASFLAGS) $(bsd_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh bsd > $@ || (rm -f $@; exit 1)

bsd_mod-loader_i386_bsd_trampoline.o: loader/i386/bsd_trampoline.S $(loader/i386/bsd_trampoline.S_DEPENDENCIES)
	$(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(bsd_mod_ASFLAGS) -DGRUB_FILE=\"loader/i386/bsd_trampoline.S\" -MD -c -o $@ $<
-include bsd_mod-loader_i386_bsd_trampoline.d

clean-module-bsd_mod-loader_i386_bsd_trampoline-extra.1:
	rm -f cmd-bsd_mod-loader_i386_bsd_trampoline.lst fs-bsd_mod-loader_i386_bsd_trampoline.lst partmap-bsd_mod-loader_i386_bsd_trampoline.lst handler-bsd_mod-loader_i386_bsd_trampoline.lst parttool-bsd_mod-loader_i386_bsd_trampoline.lst video-bsd_mod-loader_i386_bsd_trampoline.lst terminal-bsd_mod-loader_i386_bsd_trampoline.lst

CLEAN_MODULE_TARGETS += clean-module-bsd_mod-loader_i386_bsd_trampoline-extra.1

COMMANDFILES += cmd-bsd_mod-loader_i386_bsd_trampoline.lst
FSFILES += fs-bsd_mod-loader_i386_bsd_trampoline.lst
PARTTOOLFILES += parttool-bsd_mod-loader_i386_bsd_trampoline.lst
PARTMAPFILES += partmap-bsd_mod-loader_i386_bsd_trampoline.lst
HANDLERFILES += handler-bsd_mod-loader_i386_bsd_trampoline.lst
TERMINALFILES += terminal-bsd_mod-loader_i386_bsd_trampoline.lst
VIDEOFILES += video-bsd_mod-loader_i386_bsd_trampoline.lst

cmd-bsd_mod-loader_i386_bsd_trampoline.lst: loader/i386/bsd_trampoline.S $(loader/i386/bsd_trampoline.S_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(bsd_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh bsd > $@ || (rm -f $@; exit 1)

fs-bsd_mod-loader_i386_bsd_trampoline.lst: loader/i386/bsd_trampoline.S $(loader/i386/bsd_trampoline.S_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS) -DASM_FILE=1 -DGRUB_LST_GENERATOR $(TARGET_ASFLAGS) $(bsd_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh bsd > $@ || (rm -f $@; exit 1)

parttool-bsd_mod-loader_i386_bsd_trampoline.lst: loader/i386/bsd_trampoline.S $(loader/i386/bsd_trampoline.S_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(bsd_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh bsd > $@ || (rm -f $@; exit 1)

partmap-bsd_mod-loader_i386_bsd_trampoline.lst: loader/i386/bsd_trampoline.S $(loader/i386/bsd_trampoline.S_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS) -DASM_FILE=1 -DGRUB_LST_GENERATOR $(TARGET_ASFLAGS) $(bsd_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh bsd > $@ || (rm -f $@; exit 1)

handler-bsd_mod-loader_i386_bsd_trampoline.lst: loader/i386/bsd_trampoline.S $(loader/i386/bsd_trampoline.S_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(bsd_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh bsd > $@ || (rm -f $@; exit 1)

terminal-bsd_mod-loader_i386_bsd_trampoline.lst: loader/i386/bsd_trampoline.S $(loader/i386/bsd_trampoline.S_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS) -DASM_FILE=1 $(TARGET_ASFLAGS) $(bsd_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh bsd > $@ || (rm -f $@; exit 1)

video-bsd_mod-loader_i386_bsd_trampoline.lst: loader/i386/bsd_trampoline.S $(loader/i386/bsd_trampoline.S_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iloader/i386 -I$(srcdir)/loader/i386 $(TARGET_CPPFLAGS) -DASM_FILE=1 -DGRUB_LST_GENERATOR $(TARGET_ASFLAGS) $(bsd_mod_ASFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh bsd > $@ || (rm -f $@; exit 1)

bsd_mod_CFLAGS = $(COMMON_CFLAGS)
bsd_mod_LDFLAGS = $(COMMON_LDFLAGS)
bsd_mod_ASFLAGS = $(COMMON_ASFLAGS)

# For usb.mod
usb_mod_SOURCES = bus/usb/usb.c bus/usb/usbtrans.c bus/usb/usbhub.c

clean-module-usb.mod.1:
	rm -f usb.mod mod-usb.o mod-usb.c pre-usb.o usb_mod-bus_usb_usb.o usb_mod-bus_usb_usbtrans.o usb_mod-bus_usb_usbhub.o und-usb.lst

CLEAN_MODULE_TARGETS += clean-module-usb.mod.1

clean-module-usb.mod-symbol.1:
	rm -f def-usb.lst

CLEAN_MODULE_TARGETS += clean-module-usb.mod-symbol.1
DEFSYMFILES += def-usb.lst
mostlyclean-module-usb.mod.1:
	rm -f usb_mod-bus_usb_usb.d usb_mod-bus_usb_usbtrans.d usb_mod-bus_usb_usbhub.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-usb.mod.1
UNDSYMFILES += und-usb.lst

ifeq ($(TARGET_NO_MODULES), yes)
usb.mod: pre-usb.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(usb_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-usb.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
usb.mod: pre-usb.o mod-usb.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(usb_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-usb.o mod-usb.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
usb.mod: pre-usb.o mod-usb.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(usb_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-usb.o mod-usb.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-usb.o: $(usb_mod_DEPENDENCIES) usb_mod-bus_usb_usb.o usb_mod-bus_usb_usbtrans.o usb_mod-bus_usb_usbhub.o
	-rm -f $@
	$(TARGET_CC) $(usb_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ usb_mod-bus_usb_usb.o usb_mod-bus_usb_usbtrans.o usb_mod-bus_usb_usbhub.o

mod-usb.o: mod-usb.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -DGRUB_FILE=\"mod-usb.c\" -c -o $@ $<

mod-usb.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'usb' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-usb.lst: pre-usb.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 usb/' > $@
else
def-usb.lst: pre-usb.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 usb/' > $@
endif

und-usb.lst: pre-usb.o
	echo 'usb' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

usb_mod-bus_usb_usb.o: bus/usb/usb.c $(bus/usb/usb.c_DEPENDENCIES)
	$(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -DGRUB_FILE=\"bus/usb/usb.c\" -MD -c -o $@ $<
-include usb_mod-bus_usb_usb.d

clean-module-usb_mod-bus_usb_usb-extra.1:
	rm -f cmd-usb_mod-bus_usb_usb.lst fs-usb_mod-bus_usb_usb.lst partmap-usb_mod-bus_usb_usb.lst handler-usb_mod-bus_usb_usb.lst parttool-usb_mod-bus_usb_usb.lst video-usb_mod-bus_usb_usb.lst terminal-usb_mod-bus_usb_usb.lst

CLEAN_MODULE_TARGETS += clean-module-usb_mod-bus_usb_usb-extra.1

COMMANDFILES += cmd-usb_mod-bus_usb_usb.lst
FSFILES += fs-usb_mod-bus_usb_usb.lst
PARTTOOLFILES += parttool-usb_mod-bus_usb_usb.lst
PARTMAPFILES += partmap-usb_mod-bus_usb_usb.lst
HANDLERFILES += handler-usb_mod-bus_usb_usb.lst
TERMINALFILES += terminal-usb_mod-bus_usb_usb.lst
VIDEOFILES += video-usb_mod-bus_usb_usb.lst

cmd-usb_mod-bus_usb_usb.lst: bus/usb/usb.c $(bus/usb/usb.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh usb > $@ || (rm -f $@; exit 1)

fs-usb_mod-bus_usb_usb.lst: bus/usb/usb.c $(bus/usb/usb.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh usb > $@ || (rm -f $@; exit 1)

parttool-usb_mod-bus_usb_usb.lst: bus/usb/usb.c $(bus/usb/usb.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh usb > $@ || (rm -f $@; exit 1)

partmap-usb_mod-bus_usb_usb.lst: bus/usb/usb.c $(bus/usb/usb.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh usb > $@ || (rm -f $@; exit 1)

handler-usb_mod-bus_usb_usb.lst: bus/usb/usb.c $(bus/usb/usb.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh usb > $@ || (rm -f $@; exit 1)

terminal-usb_mod-bus_usb_usb.lst: bus/usb/usb.c $(bus/usb/usb.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh usb > $@ || (rm -f $@; exit 1)

video-usb_mod-bus_usb_usb.lst: bus/usb/usb.c $(bus/usb/usb.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh usb > $@ || (rm -f $@; exit 1)

usb_mod-bus_usb_usbtrans.o: bus/usb/usbtrans.c $(bus/usb/usbtrans.c_DEPENDENCIES)
	$(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -DGRUB_FILE=\"bus/usb/usbtrans.c\" -MD -c -o $@ $<
-include usb_mod-bus_usb_usbtrans.d

clean-module-usb_mod-bus_usb_usbtrans-extra.1:
	rm -f cmd-usb_mod-bus_usb_usbtrans.lst fs-usb_mod-bus_usb_usbtrans.lst partmap-usb_mod-bus_usb_usbtrans.lst handler-usb_mod-bus_usb_usbtrans.lst parttool-usb_mod-bus_usb_usbtrans.lst video-usb_mod-bus_usb_usbtrans.lst terminal-usb_mod-bus_usb_usbtrans.lst

CLEAN_MODULE_TARGETS += clean-module-usb_mod-bus_usb_usbtrans-extra.1

COMMANDFILES += cmd-usb_mod-bus_usb_usbtrans.lst
FSFILES += fs-usb_mod-bus_usb_usbtrans.lst
PARTTOOLFILES += parttool-usb_mod-bus_usb_usbtrans.lst
PARTMAPFILES += partmap-usb_mod-bus_usb_usbtrans.lst
HANDLERFILES += handler-usb_mod-bus_usb_usbtrans.lst
TERMINALFILES += terminal-usb_mod-bus_usb_usbtrans.lst
VIDEOFILES += video-usb_mod-bus_usb_usbtrans.lst

cmd-usb_mod-bus_usb_usbtrans.lst: bus/usb/usbtrans.c $(bus/usb/usbtrans.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh usb > $@ || (rm -f $@; exit 1)

fs-usb_mod-bus_usb_usbtrans.lst: bus/usb/usbtrans.c $(bus/usb/usbtrans.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh usb > $@ || (rm -f $@; exit 1)

parttool-usb_mod-bus_usb_usbtrans.lst: bus/usb/usbtrans.c $(bus/usb/usbtrans.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh usb > $@ || (rm -f $@; exit 1)

partmap-usb_mod-bus_usb_usbtrans.lst: bus/usb/usbtrans.c $(bus/usb/usbtrans.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh usb > $@ || (rm -f $@; exit 1)

handler-usb_mod-bus_usb_usbtrans.lst: bus/usb/usbtrans.c $(bus/usb/usbtrans.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh usb > $@ || (rm -f $@; exit 1)

terminal-usb_mod-bus_usb_usbtrans.lst: bus/usb/usbtrans.c $(bus/usb/usbtrans.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh usb > $@ || (rm -f $@; exit 1)

video-usb_mod-bus_usb_usbtrans.lst: bus/usb/usbtrans.c $(bus/usb/usbtrans.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh usb > $@ || (rm -f $@; exit 1)

usb_mod-bus_usb_usbhub.o: bus/usb/usbhub.c $(bus/usb/usbhub.c_DEPENDENCIES)
	$(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -DGRUB_FILE=\"bus/usb/usbhub.c\" -MD -c -o $@ $<
-include usb_mod-bus_usb_usbhub.d

clean-module-usb_mod-bus_usb_usbhub-extra.1:
	rm -f cmd-usb_mod-bus_usb_usbhub.lst fs-usb_mod-bus_usb_usbhub.lst partmap-usb_mod-bus_usb_usbhub.lst handler-usb_mod-bus_usb_usbhub.lst parttool-usb_mod-bus_usb_usbhub.lst video-usb_mod-bus_usb_usbhub.lst terminal-usb_mod-bus_usb_usbhub.lst

CLEAN_MODULE_TARGETS += clean-module-usb_mod-bus_usb_usbhub-extra.1

COMMANDFILES += cmd-usb_mod-bus_usb_usbhub.lst
FSFILES += fs-usb_mod-bus_usb_usbhub.lst
PARTTOOLFILES += parttool-usb_mod-bus_usb_usbhub.lst
PARTMAPFILES += partmap-usb_mod-bus_usb_usbhub.lst
HANDLERFILES += handler-usb_mod-bus_usb_usbhub.lst
TERMINALFILES += terminal-usb_mod-bus_usb_usbhub.lst
VIDEOFILES += video-usb_mod-bus_usb_usbhub.lst

cmd-usb_mod-bus_usb_usbhub.lst: bus/usb/usbhub.c $(bus/usb/usbhub.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh usb > $@ || (rm -f $@; exit 1)

fs-usb_mod-bus_usb_usbhub.lst: bus/usb/usbhub.c $(bus/usb/usbhub.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh usb > $@ || (rm -f $@; exit 1)

parttool-usb_mod-bus_usb_usbhub.lst: bus/usb/usbhub.c $(bus/usb/usbhub.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh usb > $@ || (rm -f $@; exit 1)

partmap-usb_mod-bus_usb_usbhub.lst: bus/usb/usbhub.c $(bus/usb/usbhub.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh usb > $@ || (rm -f $@; exit 1)

handler-usb_mod-bus_usb_usbhub.lst: bus/usb/usbhub.c $(bus/usb/usbhub.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh usb > $@ || (rm -f $@; exit 1)

terminal-usb_mod-bus_usb_usbhub.lst: bus/usb/usbhub.c $(bus/usb/usbhub.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh usb > $@ || (rm -f $@; exit 1)

video-usb_mod-bus_usb_usbhub.lst: bus/usb/usbhub.c $(bus/usb/usbhub.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(usb_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh usb > $@ || (rm -f $@; exit 1)

usb_mod_CFLAGS = $(COMMON_CFLAGS)
usb_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For usbtest.mod
usbtest_mod_SOURCES = commands/usbtest.c

clean-module-usbtest.mod.1:
	rm -f usbtest.mod mod-usbtest.o mod-usbtest.c pre-usbtest.o usbtest_mod-commands_usbtest.o und-usbtest.lst

CLEAN_MODULE_TARGETS += clean-module-usbtest.mod.1

clean-module-usbtest.mod-symbol.1:
	rm -f def-usbtest.lst

CLEAN_MODULE_TARGETS += clean-module-usbtest.mod-symbol.1
DEFSYMFILES += def-usbtest.lst
mostlyclean-module-usbtest.mod.1:
	rm -f usbtest_mod-commands_usbtest.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-usbtest.mod.1
UNDSYMFILES += und-usbtest.lst

ifeq ($(TARGET_NO_MODULES), yes)
usbtest.mod: pre-usbtest.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(usbtest_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-usbtest.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
usbtest.mod: pre-usbtest.o mod-usbtest.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(usbtest_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-usbtest.o mod-usbtest.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
usbtest.mod: pre-usbtest.o mod-usbtest.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(usbtest_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-usbtest.o mod-usbtest.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-usbtest.o: $(usbtest_mod_DEPENDENCIES) usbtest_mod-commands_usbtest.o
	-rm -f $@
	$(TARGET_CC) $(usbtest_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ usbtest_mod-commands_usbtest.o

mod-usbtest.o: mod-usbtest.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(usbtest_mod_CFLAGS) -DGRUB_FILE=\"mod-usbtest.c\" -c -o $@ $<

mod-usbtest.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'usbtest' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-usbtest.lst: pre-usbtest.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 usbtest/' > $@
else
def-usbtest.lst: pre-usbtest.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 usbtest/' > $@
endif

und-usbtest.lst: pre-usbtest.o
	echo 'usbtest' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

usbtest_mod-commands_usbtest.o: commands/usbtest.c $(commands/usbtest.c_DEPENDENCIES)
	$(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usbtest_mod_CFLAGS) -DGRUB_FILE=\"commands/usbtest.c\" -MD -c -o $@ $<
-include usbtest_mod-commands_usbtest.d

clean-module-usbtest_mod-commands_usbtest-extra.1:
	rm -f cmd-usbtest_mod-commands_usbtest.lst fs-usbtest_mod-commands_usbtest.lst partmap-usbtest_mod-commands_usbtest.lst handler-usbtest_mod-commands_usbtest.lst parttool-usbtest_mod-commands_usbtest.lst video-usbtest_mod-commands_usbtest.lst terminal-usbtest_mod-commands_usbtest.lst

CLEAN_MODULE_TARGETS += clean-module-usbtest_mod-commands_usbtest-extra.1

COMMANDFILES += cmd-usbtest_mod-commands_usbtest.lst
FSFILES += fs-usbtest_mod-commands_usbtest.lst
PARTTOOLFILES += parttool-usbtest_mod-commands_usbtest.lst
PARTMAPFILES += partmap-usbtest_mod-commands_usbtest.lst
HANDLERFILES += handler-usbtest_mod-commands_usbtest.lst
TERMINALFILES += terminal-usbtest_mod-commands_usbtest.lst
VIDEOFILES += video-usbtest_mod-commands_usbtest.lst

cmd-usbtest_mod-commands_usbtest.lst: commands/usbtest.c $(commands/usbtest.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usbtest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh usbtest > $@ || (rm -f $@; exit 1)

fs-usbtest_mod-commands_usbtest.lst: commands/usbtest.c $(commands/usbtest.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(usbtest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh usbtest > $@ || (rm -f $@; exit 1)

parttool-usbtest_mod-commands_usbtest.lst: commands/usbtest.c $(commands/usbtest.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usbtest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh usbtest > $@ || (rm -f $@; exit 1)

partmap-usbtest_mod-commands_usbtest.lst: commands/usbtest.c $(commands/usbtest.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(usbtest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh usbtest > $@ || (rm -f $@; exit 1)

handler-usbtest_mod-commands_usbtest.lst: commands/usbtest.c $(commands/usbtest.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usbtest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh usbtest > $@ || (rm -f $@; exit 1)

terminal-usbtest_mod-commands_usbtest.lst: commands/usbtest.c $(commands/usbtest.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usbtest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh usbtest > $@ || (rm -f $@; exit 1)

video-usbtest_mod-commands_usbtest.lst: commands/usbtest.c $(commands/usbtest.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(usbtest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh usbtest > $@ || (rm -f $@; exit 1)

usbtest_mod_CFLAGS = $(COMMON_CFLAGS)
usbtest_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For uhci.mod
uhci_mod_SOURCES = bus/usb/uhci.c

clean-module-uhci.mod.1:
	rm -f uhci.mod mod-uhci.o mod-uhci.c pre-uhci.o uhci_mod-bus_usb_uhci.o und-uhci.lst

CLEAN_MODULE_TARGETS += clean-module-uhci.mod.1

clean-module-uhci.mod-symbol.1:
	rm -f def-uhci.lst

CLEAN_MODULE_TARGETS += clean-module-uhci.mod-symbol.1
DEFSYMFILES += def-uhci.lst
mostlyclean-module-uhci.mod.1:
	rm -f uhci_mod-bus_usb_uhci.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-uhci.mod.1
UNDSYMFILES += und-uhci.lst

ifeq ($(TARGET_NO_MODULES), yes)
uhci.mod: pre-uhci.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(uhci_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-uhci.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
uhci.mod: pre-uhci.o mod-uhci.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(uhci_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-uhci.o mod-uhci.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
uhci.mod: pre-uhci.o mod-uhci.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(uhci_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-uhci.o mod-uhci.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-uhci.o: $(uhci_mod_DEPENDENCIES) uhci_mod-bus_usb_uhci.o
	-rm -f $@
	$(TARGET_CC) $(uhci_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ uhci_mod-bus_usb_uhci.o

mod-uhci.o: mod-uhci.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(uhci_mod_CFLAGS) -DGRUB_FILE=\"mod-uhci.c\" -c -o $@ $<

mod-uhci.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'uhci' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-uhci.lst: pre-uhci.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 uhci/' > $@
else
def-uhci.lst: pre-uhci.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 uhci/' > $@
endif

und-uhci.lst: pre-uhci.o
	echo 'uhci' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

uhci_mod-bus_usb_uhci.o: bus/usb/uhci.c $(bus/usb/uhci.c_DEPENDENCIES)
	$(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(uhci_mod_CFLAGS) -DGRUB_FILE=\"bus/usb/uhci.c\" -MD -c -o $@ $<
-include uhci_mod-bus_usb_uhci.d

clean-module-uhci_mod-bus_usb_uhci-extra.1:
	rm -f cmd-uhci_mod-bus_usb_uhci.lst fs-uhci_mod-bus_usb_uhci.lst partmap-uhci_mod-bus_usb_uhci.lst handler-uhci_mod-bus_usb_uhci.lst parttool-uhci_mod-bus_usb_uhci.lst video-uhci_mod-bus_usb_uhci.lst terminal-uhci_mod-bus_usb_uhci.lst

CLEAN_MODULE_TARGETS += clean-module-uhci_mod-bus_usb_uhci-extra.1

COMMANDFILES += cmd-uhci_mod-bus_usb_uhci.lst
FSFILES += fs-uhci_mod-bus_usb_uhci.lst
PARTTOOLFILES += parttool-uhci_mod-bus_usb_uhci.lst
PARTMAPFILES += partmap-uhci_mod-bus_usb_uhci.lst
HANDLERFILES += handler-uhci_mod-bus_usb_uhci.lst
TERMINALFILES += terminal-uhci_mod-bus_usb_uhci.lst
VIDEOFILES += video-uhci_mod-bus_usb_uhci.lst

cmd-uhci_mod-bus_usb_uhci.lst: bus/usb/uhci.c $(bus/usb/uhci.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(uhci_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh uhci > $@ || (rm -f $@; exit 1)

fs-uhci_mod-bus_usb_uhci.lst: bus/usb/uhci.c $(bus/usb/uhci.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(uhci_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh uhci > $@ || (rm -f $@; exit 1)

parttool-uhci_mod-bus_usb_uhci.lst: bus/usb/uhci.c $(bus/usb/uhci.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(uhci_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh uhci > $@ || (rm -f $@; exit 1)

partmap-uhci_mod-bus_usb_uhci.lst: bus/usb/uhci.c $(bus/usb/uhci.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(uhci_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh uhci > $@ || (rm -f $@; exit 1)

handler-uhci_mod-bus_usb_uhci.lst: bus/usb/uhci.c $(bus/usb/uhci.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(uhci_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh uhci > $@ || (rm -f $@; exit 1)

terminal-uhci_mod-bus_usb_uhci.lst: bus/usb/uhci.c $(bus/usb/uhci.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(uhci_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh uhci > $@ || (rm -f $@; exit 1)

video-uhci_mod-bus_usb_uhci.lst: bus/usb/uhci.c $(bus/usb/uhci.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(uhci_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh uhci > $@ || (rm -f $@; exit 1)

uhci_mod_CFLAGS = $(COMMON_CFLAGS)
uhci_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For ohci.mod
ohci_mod_SOURCES = bus/usb/ohci.c

clean-module-ohci.mod.1:
	rm -f ohci.mod mod-ohci.o mod-ohci.c pre-ohci.o ohci_mod-bus_usb_ohci.o und-ohci.lst

CLEAN_MODULE_TARGETS += clean-module-ohci.mod.1

clean-module-ohci.mod-symbol.1:
	rm -f def-ohci.lst

CLEAN_MODULE_TARGETS += clean-module-ohci.mod-symbol.1
DEFSYMFILES += def-ohci.lst
mostlyclean-module-ohci.mod.1:
	rm -f ohci_mod-bus_usb_ohci.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-ohci.mod.1
UNDSYMFILES += und-ohci.lst

ifeq ($(TARGET_NO_MODULES), yes)
ohci.mod: pre-ohci.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(ohci_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-ohci.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
ohci.mod: pre-ohci.o mod-ohci.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(ohci_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-ohci.o mod-ohci.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ohci.mod: pre-ohci.o mod-ohci.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(ohci_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-ohci.o mod-ohci.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-ohci.o: $(ohci_mod_DEPENDENCIES) ohci_mod-bus_usb_ohci.o
	-rm -f $@
	$(TARGET_CC) $(ohci_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ ohci_mod-bus_usb_ohci.o

mod-ohci.o: mod-ohci.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(ohci_mod_CFLAGS) -DGRUB_FILE=\"mod-ohci.c\" -c -o $@ $<

mod-ohci.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'ohci' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-ohci.lst: pre-ohci.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 ohci/' > $@
else
def-ohci.lst: pre-ohci.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 ohci/' > $@
endif

und-ohci.lst: pre-ohci.o
	echo 'ohci' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

ohci_mod-bus_usb_ohci.o: bus/usb/ohci.c $(bus/usb/ohci.c_DEPENDENCIES)
	$(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(ohci_mod_CFLAGS) -DGRUB_FILE=\"bus/usb/ohci.c\" -MD -c -o $@ $<
-include ohci_mod-bus_usb_ohci.d

clean-module-ohci_mod-bus_usb_ohci-extra.1:
	rm -f cmd-ohci_mod-bus_usb_ohci.lst fs-ohci_mod-bus_usb_ohci.lst partmap-ohci_mod-bus_usb_ohci.lst handler-ohci_mod-bus_usb_ohci.lst parttool-ohci_mod-bus_usb_ohci.lst video-ohci_mod-bus_usb_ohci.lst terminal-ohci_mod-bus_usb_ohci.lst

CLEAN_MODULE_TARGETS += clean-module-ohci_mod-bus_usb_ohci-extra.1

COMMANDFILES += cmd-ohci_mod-bus_usb_ohci.lst
FSFILES += fs-ohci_mod-bus_usb_ohci.lst
PARTTOOLFILES += parttool-ohci_mod-bus_usb_ohci.lst
PARTMAPFILES += partmap-ohci_mod-bus_usb_ohci.lst
HANDLERFILES += handler-ohci_mod-bus_usb_ohci.lst
TERMINALFILES += terminal-ohci_mod-bus_usb_ohci.lst
VIDEOFILES += video-ohci_mod-bus_usb_ohci.lst

cmd-ohci_mod-bus_usb_ohci.lst: bus/usb/ohci.c $(bus/usb/ohci.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(ohci_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh ohci > $@ || (rm -f $@; exit 1)

fs-ohci_mod-bus_usb_ohci.lst: bus/usb/ohci.c $(bus/usb/ohci.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(ohci_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh ohci > $@ || (rm -f $@; exit 1)

parttool-ohci_mod-bus_usb_ohci.lst: bus/usb/ohci.c $(bus/usb/ohci.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(ohci_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh ohci > $@ || (rm -f $@; exit 1)

partmap-ohci_mod-bus_usb_ohci.lst: bus/usb/ohci.c $(bus/usb/ohci.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(ohci_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh ohci > $@ || (rm -f $@; exit 1)

handler-ohci_mod-bus_usb_ohci.lst: bus/usb/ohci.c $(bus/usb/ohci.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(ohci_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh ohci > $@ || (rm -f $@; exit 1)

terminal-ohci_mod-bus_usb_ohci.lst: bus/usb/ohci.c $(bus/usb/ohci.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(ohci_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh ohci > $@ || (rm -f $@; exit 1)

video-ohci_mod-bus_usb_ohci.lst: bus/usb/ohci.c $(bus/usb/ohci.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Ibus/usb -I$(srcdir)/bus/usb $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(ohci_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh ohci > $@ || (rm -f $@; exit 1)

ohci_mod_CFLAGS = $(COMMON_CFLAGS)
ohci_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For usbms.mod
usbms_mod_SOURCES = disk/usbms.c

clean-module-usbms.mod.1:
	rm -f usbms.mod mod-usbms.o mod-usbms.c pre-usbms.o usbms_mod-disk_usbms.o und-usbms.lst

CLEAN_MODULE_TARGETS += clean-module-usbms.mod.1

clean-module-usbms.mod-symbol.1:
	rm -f def-usbms.lst

CLEAN_MODULE_TARGETS += clean-module-usbms.mod-symbol.1
DEFSYMFILES += def-usbms.lst
mostlyclean-module-usbms.mod.1:
	rm -f usbms_mod-disk_usbms.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-usbms.mod.1
UNDSYMFILES += und-usbms.lst

ifeq ($(TARGET_NO_MODULES), yes)
usbms.mod: pre-usbms.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(usbms_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-usbms.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
usbms.mod: pre-usbms.o mod-usbms.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(usbms_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-usbms.o mod-usbms.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
usbms.mod: pre-usbms.o mod-usbms.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(usbms_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-usbms.o mod-usbms.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-usbms.o: $(usbms_mod_DEPENDENCIES) usbms_mod-disk_usbms.o
	-rm -f $@
	$(TARGET_CC) $(usbms_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ usbms_mod-disk_usbms.o

mod-usbms.o: mod-usbms.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(usbms_mod_CFLAGS) -DGRUB_FILE=\"mod-usbms.c\" -c -o $@ $<

mod-usbms.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'usbms' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-usbms.lst: pre-usbms.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 usbms/' > $@
else
def-usbms.lst: pre-usbms.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 usbms/' > $@
endif

und-usbms.lst: pre-usbms.o
	echo 'usbms' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

usbms_mod-disk_usbms.o: disk/usbms.c $(disk/usbms.c_DEPENDENCIES)
	$(TARGET_CC) -Idisk -I$(srcdir)/disk $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usbms_mod_CFLAGS) -DGRUB_FILE=\"disk/usbms.c\" -MD -c -o $@ $<
-include usbms_mod-disk_usbms.d

clean-module-usbms_mod-disk_usbms-extra.1:
	rm -f cmd-usbms_mod-disk_usbms.lst fs-usbms_mod-disk_usbms.lst partmap-usbms_mod-disk_usbms.lst handler-usbms_mod-disk_usbms.lst parttool-usbms_mod-disk_usbms.lst video-usbms_mod-disk_usbms.lst terminal-usbms_mod-disk_usbms.lst

CLEAN_MODULE_TARGETS += clean-module-usbms_mod-disk_usbms-extra.1

COMMANDFILES += cmd-usbms_mod-disk_usbms.lst
FSFILES += fs-usbms_mod-disk_usbms.lst
PARTTOOLFILES += parttool-usbms_mod-disk_usbms.lst
PARTMAPFILES += partmap-usbms_mod-disk_usbms.lst
HANDLERFILES += handler-usbms_mod-disk_usbms.lst
TERMINALFILES += terminal-usbms_mod-disk_usbms.lst
VIDEOFILES += video-usbms_mod-disk_usbms.lst

cmd-usbms_mod-disk_usbms.lst: disk/usbms.c $(disk/usbms.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Idisk -I$(srcdir)/disk $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usbms_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh usbms > $@ || (rm -f $@; exit 1)

fs-usbms_mod-disk_usbms.lst: disk/usbms.c $(disk/usbms.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Idisk -I$(srcdir)/disk $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(usbms_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh usbms > $@ || (rm -f $@; exit 1)

parttool-usbms_mod-disk_usbms.lst: disk/usbms.c $(disk/usbms.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Idisk -I$(srcdir)/disk $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usbms_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh usbms > $@ || (rm -f $@; exit 1)

partmap-usbms_mod-disk_usbms.lst: disk/usbms.c $(disk/usbms.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Idisk -I$(srcdir)/disk $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(usbms_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh usbms > $@ || (rm -f $@; exit 1)

handler-usbms_mod-disk_usbms.lst: disk/usbms.c $(disk/usbms.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Idisk -I$(srcdir)/disk $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usbms_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh usbms > $@ || (rm -f $@; exit 1)

terminal-usbms_mod-disk_usbms.lst: disk/usbms.c $(disk/usbms.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Idisk -I$(srcdir)/disk $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usbms_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh usbms > $@ || (rm -f $@; exit 1)

video-usbms_mod-disk_usbms.lst: disk/usbms.c $(disk/usbms.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Idisk -I$(srcdir)/disk $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(usbms_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh usbms > $@ || (rm -f $@; exit 1)

usbms_mod_CFLAGS = $(COMMON_CFLAGS)
usbms_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For usb_keyboard.mod
usb_keyboard_mod_SOURCES = term/usb_keyboard.c

clean-module-usb_keyboard.mod.1:
	rm -f usb_keyboard.mod mod-usb_keyboard.o mod-usb_keyboard.c pre-usb_keyboard.o usb_keyboard_mod-term_usb_keyboard.o und-usb_keyboard.lst

CLEAN_MODULE_TARGETS += clean-module-usb_keyboard.mod.1

clean-module-usb_keyboard.mod-symbol.1:
	rm -f def-usb_keyboard.lst

CLEAN_MODULE_TARGETS += clean-module-usb_keyboard.mod-symbol.1
DEFSYMFILES += def-usb_keyboard.lst
mostlyclean-module-usb_keyboard.mod.1:
	rm -f usb_keyboard_mod-term_usb_keyboard.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-usb_keyboard.mod.1
UNDSYMFILES += und-usb_keyboard.lst

ifeq ($(TARGET_NO_MODULES), yes)
usb_keyboard.mod: pre-usb_keyboard.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(usb_keyboard_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-usb_keyboard.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
usb_keyboard.mod: pre-usb_keyboard.o mod-usb_keyboard.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(usb_keyboard_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-usb_keyboard.o mod-usb_keyboard.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
usb_keyboard.mod: pre-usb_keyboard.o mod-usb_keyboard.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(usb_keyboard_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-usb_keyboard.o mod-usb_keyboard.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-usb_keyboard.o: $(usb_keyboard_mod_DEPENDENCIES) usb_keyboard_mod-term_usb_keyboard.o
	-rm -f $@
	$(TARGET_CC) $(usb_keyboard_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ usb_keyboard_mod-term_usb_keyboard.o

mod-usb_keyboard.o: mod-usb_keyboard.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(usb_keyboard_mod_CFLAGS) -DGRUB_FILE=\"mod-usb_keyboard.c\" -c -o $@ $<

mod-usb_keyboard.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'usb_keyboard' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-usb_keyboard.lst: pre-usb_keyboard.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 usb_keyboard/' > $@
else
def-usb_keyboard.lst: pre-usb_keyboard.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 usb_keyboard/' > $@
endif

und-usb_keyboard.lst: pre-usb_keyboard.o
	echo 'usb_keyboard' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

usb_keyboard_mod-term_usb_keyboard.o: term/usb_keyboard.c $(term/usb_keyboard.c_DEPENDENCIES)
	$(TARGET_CC) -Iterm -I$(srcdir)/term $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_keyboard_mod_CFLAGS) -DGRUB_FILE=\"term/usb_keyboard.c\" -MD -c -o $@ $<
-include usb_keyboard_mod-term_usb_keyboard.d

clean-module-usb_keyboard_mod-term_usb_keyboard-extra.1:
	rm -f cmd-usb_keyboard_mod-term_usb_keyboard.lst fs-usb_keyboard_mod-term_usb_keyboard.lst partmap-usb_keyboard_mod-term_usb_keyboard.lst handler-usb_keyboard_mod-term_usb_keyboard.lst parttool-usb_keyboard_mod-term_usb_keyboard.lst video-usb_keyboard_mod-term_usb_keyboard.lst terminal-usb_keyboard_mod-term_usb_keyboard.lst

CLEAN_MODULE_TARGETS += clean-module-usb_keyboard_mod-term_usb_keyboard-extra.1

COMMANDFILES += cmd-usb_keyboard_mod-term_usb_keyboard.lst
FSFILES += fs-usb_keyboard_mod-term_usb_keyboard.lst
PARTTOOLFILES += parttool-usb_keyboard_mod-term_usb_keyboard.lst
PARTMAPFILES += partmap-usb_keyboard_mod-term_usb_keyboard.lst
HANDLERFILES += handler-usb_keyboard_mod-term_usb_keyboard.lst
TERMINALFILES += terminal-usb_keyboard_mod-term_usb_keyboard.lst
VIDEOFILES += video-usb_keyboard_mod-term_usb_keyboard.lst

cmd-usb_keyboard_mod-term_usb_keyboard.lst: term/usb_keyboard.c $(term/usb_keyboard.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Iterm -I$(srcdir)/term $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_keyboard_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh usb_keyboard > $@ || (rm -f $@; exit 1)

fs-usb_keyboard_mod-term_usb_keyboard.lst: term/usb_keyboard.c $(term/usb_keyboard.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Iterm -I$(srcdir)/term $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(usb_keyboard_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh usb_keyboard > $@ || (rm -f $@; exit 1)

parttool-usb_keyboard_mod-term_usb_keyboard.lst: term/usb_keyboard.c $(term/usb_keyboard.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Iterm -I$(srcdir)/term $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_keyboard_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh usb_keyboard > $@ || (rm -f $@; exit 1)

partmap-usb_keyboard_mod-term_usb_keyboard.lst: term/usb_keyboard.c $(term/usb_keyboard.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Iterm -I$(srcdir)/term $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(usb_keyboard_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh usb_keyboard > $@ || (rm -f $@; exit 1)

handler-usb_keyboard_mod-term_usb_keyboard.lst: term/usb_keyboard.c $(term/usb_keyboard.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Iterm -I$(srcdir)/term $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_keyboard_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh usb_keyboard > $@ || (rm -f $@; exit 1)

terminal-usb_keyboard_mod-term_usb_keyboard.lst: term/usb_keyboard.c $(term/usb_keyboard.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Iterm -I$(srcdir)/term $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(usb_keyboard_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh usb_keyboard > $@ || (rm -f $@; exit 1)

video-usb_keyboard_mod-term_usb_keyboard.lst: term/usb_keyboard.c $(term/usb_keyboard.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Iterm -I$(srcdir)/term $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(usb_keyboard_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh usb_keyboard > $@ || (rm -f $@; exit 1)

usb_keyboard_mod_CFLAGS = $(COMMON_CFLAGS)
usb_keyboard_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For pxe.mod
pxe_mod_SOURCES = fs/i386/pc/pxe.c

clean-module-pxe.mod.1:
	rm -f pxe.mod mod-pxe.o mod-pxe.c pre-pxe.o pxe_mod-fs_i386_pc_pxe.o und-pxe.lst

CLEAN_MODULE_TARGETS += clean-module-pxe.mod.1

clean-module-pxe.mod-symbol.1:
	rm -f def-pxe.lst

CLEAN_MODULE_TARGETS += clean-module-pxe.mod-symbol.1
DEFSYMFILES += def-pxe.lst
mostlyclean-module-pxe.mod.1:
	rm -f pxe_mod-fs_i386_pc_pxe.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-pxe.mod.1
UNDSYMFILES += und-pxe.lst

ifeq ($(TARGET_NO_MODULES), yes)
pxe.mod: pre-pxe.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(pxe_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-pxe.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
pxe.mod: pre-pxe.o mod-pxe.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(pxe_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-pxe.o mod-pxe.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
pxe.mod: pre-pxe.o mod-pxe.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(pxe_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-pxe.o mod-pxe.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-pxe.o: $(pxe_mod_DEPENDENCIES) pxe_mod-fs_i386_pc_pxe.o
	-rm -f $@
	$(TARGET_CC) $(pxe_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pxe_mod-fs_i386_pc_pxe.o

mod-pxe.o: mod-pxe.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(pxe_mod_CFLAGS) -DGRUB_FILE=\"mod-pxe.c\" -c -o $@ $<

mod-pxe.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'pxe' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-pxe.lst: pre-pxe.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 pxe/' > $@
else
def-pxe.lst: pre-pxe.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 pxe/' > $@
endif

und-pxe.lst: pre-pxe.o
	echo 'pxe' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

pxe_mod-fs_i386_pc_pxe.o: fs/i386/pc/pxe.c $(fs/i386/pc/pxe.c_DEPENDENCIES)
	$(TARGET_CC) -Ifs/i386/pc -I$(srcdir)/fs/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(pxe_mod_CFLAGS) -DGRUB_FILE=\"fs/i386/pc/pxe.c\" -MD -c -o $@ $<
-include pxe_mod-fs_i386_pc_pxe.d

clean-module-pxe_mod-fs_i386_pc_pxe-extra.1:
	rm -f cmd-pxe_mod-fs_i386_pc_pxe.lst fs-pxe_mod-fs_i386_pc_pxe.lst partmap-pxe_mod-fs_i386_pc_pxe.lst handler-pxe_mod-fs_i386_pc_pxe.lst parttool-pxe_mod-fs_i386_pc_pxe.lst video-pxe_mod-fs_i386_pc_pxe.lst terminal-pxe_mod-fs_i386_pc_pxe.lst

CLEAN_MODULE_TARGETS += clean-module-pxe_mod-fs_i386_pc_pxe-extra.1

COMMANDFILES += cmd-pxe_mod-fs_i386_pc_pxe.lst
FSFILES += fs-pxe_mod-fs_i386_pc_pxe.lst
PARTTOOLFILES += parttool-pxe_mod-fs_i386_pc_pxe.lst
PARTMAPFILES += partmap-pxe_mod-fs_i386_pc_pxe.lst
HANDLERFILES += handler-pxe_mod-fs_i386_pc_pxe.lst
TERMINALFILES += terminal-pxe_mod-fs_i386_pc_pxe.lst
VIDEOFILES += video-pxe_mod-fs_i386_pc_pxe.lst

cmd-pxe_mod-fs_i386_pc_pxe.lst: fs/i386/pc/pxe.c $(fs/i386/pc/pxe.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Ifs/i386/pc -I$(srcdir)/fs/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(pxe_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh pxe > $@ || (rm -f $@; exit 1)

fs-pxe_mod-fs_i386_pc_pxe.lst: fs/i386/pc/pxe.c $(fs/i386/pc/pxe.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Ifs/i386/pc -I$(srcdir)/fs/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(pxe_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh pxe > $@ || (rm -f $@; exit 1)

parttool-pxe_mod-fs_i386_pc_pxe.lst: fs/i386/pc/pxe.c $(fs/i386/pc/pxe.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Ifs/i386/pc -I$(srcdir)/fs/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(pxe_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh pxe > $@ || (rm -f $@; exit 1)

partmap-pxe_mod-fs_i386_pc_pxe.lst: fs/i386/pc/pxe.c $(fs/i386/pc/pxe.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Ifs/i386/pc -I$(srcdir)/fs/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(pxe_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh pxe > $@ || (rm -f $@; exit 1)

handler-pxe_mod-fs_i386_pc_pxe.lst: fs/i386/pc/pxe.c $(fs/i386/pc/pxe.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Ifs/i386/pc -I$(srcdir)/fs/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(pxe_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh pxe > $@ || (rm -f $@; exit 1)

terminal-pxe_mod-fs_i386_pc_pxe.lst: fs/i386/pc/pxe.c $(fs/i386/pc/pxe.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Ifs/i386/pc -I$(srcdir)/fs/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(pxe_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh pxe > $@ || (rm -f $@; exit 1)

video-pxe_mod-fs_i386_pc_pxe.lst: fs/i386/pc/pxe.c $(fs/i386/pc/pxe.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Ifs/i386/pc -I$(srcdir)/fs/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(pxe_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh pxe > $@ || (rm -f $@; exit 1)

pxe_mod_CFLAGS = $(COMMON_CFLAGS)
pxe_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For pxecmd.mod
pxecmd_mod_SOURCES = commands/i386/pc/pxecmd.c

clean-module-pxecmd.mod.1:
	rm -f pxecmd.mod mod-pxecmd.o mod-pxecmd.c pre-pxecmd.o pxecmd_mod-commands_i386_pc_pxecmd.o und-pxecmd.lst

CLEAN_MODULE_TARGETS += clean-module-pxecmd.mod.1

clean-module-pxecmd.mod-symbol.1:
	rm -f def-pxecmd.lst

CLEAN_MODULE_TARGETS += clean-module-pxecmd.mod-symbol.1
DEFSYMFILES += def-pxecmd.lst
mostlyclean-module-pxecmd.mod.1:
	rm -f pxecmd_mod-commands_i386_pc_pxecmd.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-pxecmd.mod.1
UNDSYMFILES += und-pxecmd.lst

ifeq ($(TARGET_NO_MODULES), yes)
pxecmd.mod: pre-pxecmd.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(pxecmd_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-pxecmd.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
pxecmd.mod: pre-pxecmd.o mod-pxecmd.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(pxecmd_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-pxecmd.o mod-pxecmd.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
pxecmd.mod: pre-pxecmd.o mod-pxecmd.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(pxecmd_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-pxecmd.o mod-pxecmd.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-pxecmd.o: $(pxecmd_mod_DEPENDENCIES) pxecmd_mod-commands_i386_pc_pxecmd.o
	-rm -f $@
	$(TARGET_CC) $(pxecmd_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pxecmd_mod-commands_i386_pc_pxecmd.o

mod-pxecmd.o: mod-pxecmd.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(pxecmd_mod_CFLAGS) -DGRUB_FILE=\"mod-pxecmd.c\" -c -o $@ $<

mod-pxecmd.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'pxecmd' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-pxecmd.lst: pre-pxecmd.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 pxecmd/' > $@
else
def-pxecmd.lst: pre-pxecmd.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 pxecmd/' > $@
endif

und-pxecmd.lst: pre-pxecmd.o
	echo 'pxecmd' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

pxecmd_mod-commands_i386_pc_pxecmd.o: commands/i386/pc/pxecmd.c $(commands/i386/pc/pxecmd.c_DEPENDENCIES)
	$(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(pxecmd_mod_CFLAGS) -DGRUB_FILE=\"commands/i386/pc/pxecmd.c\" -MD -c -o $@ $<
-include pxecmd_mod-commands_i386_pc_pxecmd.d

clean-module-pxecmd_mod-commands_i386_pc_pxecmd-extra.1:
	rm -f cmd-pxecmd_mod-commands_i386_pc_pxecmd.lst fs-pxecmd_mod-commands_i386_pc_pxecmd.lst partmap-pxecmd_mod-commands_i386_pc_pxecmd.lst handler-pxecmd_mod-commands_i386_pc_pxecmd.lst parttool-pxecmd_mod-commands_i386_pc_pxecmd.lst video-pxecmd_mod-commands_i386_pc_pxecmd.lst terminal-pxecmd_mod-commands_i386_pc_pxecmd.lst

CLEAN_MODULE_TARGETS += clean-module-pxecmd_mod-commands_i386_pc_pxecmd-extra.1

COMMANDFILES += cmd-pxecmd_mod-commands_i386_pc_pxecmd.lst
FSFILES += fs-pxecmd_mod-commands_i386_pc_pxecmd.lst
PARTTOOLFILES += parttool-pxecmd_mod-commands_i386_pc_pxecmd.lst
PARTMAPFILES += partmap-pxecmd_mod-commands_i386_pc_pxecmd.lst
HANDLERFILES += handler-pxecmd_mod-commands_i386_pc_pxecmd.lst
TERMINALFILES += terminal-pxecmd_mod-commands_i386_pc_pxecmd.lst
VIDEOFILES += video-pxecmd_mod-commands_i386_pc_pxecmd.lst

cmd-pxecmd_mod-commands_i386_pc_pxecmd.lst: commands/i386/pc/pxecmd.c $(commands/i386/pc/pxecmd.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(pxecmd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh pxecmd > $@ || (rm -f $@; exit 1)

fs-pxecmd_mod-commands_i386_pc_pxecmd.lst: commands/i386/pc/pxecmd.c $(commands/i386/pc/pxecmd.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(pxecmd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh pxecmd > $@ || (rm -f $@; exit 1)

parttool-pxecmd_mod-commands_i386_pc_pxecmd.lst: commands/i386/pc/pxecmd.c $(commands/i386/pc/pxecmd.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(pxecmd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh pxecmd > $@ || (rm -f $@; exit 1)

partmap-pxecmd_mod-commands_i386_pc_pxecmd.lst: commands/i386/pc/pxecmd.c $(commands/i386/pc/pxecmd.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(pxecmd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh pxecmd > $@ || (rm -f $@; exit 1)

handler-pxecmd_mod-commands_i386_pc_pxecmd.lst: commands/i386/pc/pxecmd.c $(commands/i386/pc/pxecmd.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(pxecmd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh pxecmd > $@ || (rm -f $@; exit 1)

terminal-pxecmd_mod-commands_i386_pc_pxecmd.lst: commands/i386/pc/pxecmd.c $(commands/i386/pc/pxecmd.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(pxecmd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh pxecmd > $@ || (rm -f $@; exit 1)

video-pxecmd_mod-commands_i386_pc_pxecmd.lst: commands/i386/pc/pxecmd.c $(commands/i386/pc/pxecmd.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386/pc -I$(srcdir)/commands/i386/pc $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(pxecmd_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh pxecmd > $@ || (rm -f $@; exit 1)

pxecmd_mod_CFLAGS = $(COMMON_CFLAGS)
pxecmd_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For datetime.mod
datetime_mod_SOURCES = lib/cmos_datetime.c

clean-module-datetime.mod.1:
	rm -f datetime.mod mod-datetime.o mod-datetime.c pre-datetime.o datetime_mod-lib_cmos_datetime.o und-datetime.lst

CLEAN_MODULE_TARGETS += clean-module-datetime.mod.1

clean-module-datetime.mod-symbol.1:
	rm -f def-datetime.lst

CLEAN_MODULE_TARGETS += clean-module-datetime.mod-symbol.1
DEFSYMFILES += def-datetime.lst
mostlyclean-module-datetime.mod.1:
	rm -f datetime_mod-lib_cmos_datetime.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-datetime.mod.1
UNDSYMFILES += und-datetime.lst

ifeq ($(TARGET_NO_MODULES), yes)
datetime.mod: pre-datetime.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(datetime_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-datetime.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
datetime.mod: pre-datetime.o mod-datetime.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(datetime_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-datetime.o mod-datetime.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
datetime.mod: pre-datetime.o mod-datetime.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(datetime_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-datetime.o mod-datetime.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-datetime.o: $(datetime_mod_DEPENDENCIES) datetime_mod-lib_cmos_datetime.o
	-rm -f $@
	$(TARGET_CC) $(datetime_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ datetime_mod-lib_cmos_datetime.o

mod-datetime.o: mod-datetime.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(datetime_mod_CFLAGS) -DGRUB_FILE=\"mod-datetime.c\" -c -o $@ $<

mod-datetime.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'datetime' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-datetime.lst: pre-datetime.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 datetime/' > $@
else
def-datetime.lst: pre-datetime.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 datetime/' > $@
endif

und-datetime.lst: pre-datetime.o
	echo 'datetime' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

datetime_mod-lib_cmos_datetime.o: lib/cmos_datetime.c $(lib/cmos_datetime.c_DEPENDENCIES)
	$(TARGET_CC) -Ilib -I$(srcdir)/lib $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(datetime_mod_CFLAGS) -DGRUB_FILE=\"lib/cmos_datetime.c\" -MD -c -o $@ $<
-include datetime_mod-lib_cmos_datetime.d

clean-module-datetime_mod-lib_cmos_datetime-extra.1:
	rm -f cmd-datetime_mod-lib_cmos_datetime.lst fs-datetime_mod-lib_cmos_datetime.lst partmap-datetime_mod-lib_cmos_datetime.lst handler-datetime_mod-lib_cmos_datetime.lst parttool-datetime_mod-lib_cmos_datetime.lst video-datetime_mod-lib_cmos_datetime.lst terminal-datetime_mod-lib_cmos_datetime.lst

CLEAN_MODULE_TARGETS += clean-module-datetime_mod-lib_cmos_datetime-extra.1

COMMANDFILES += cmd-datetime_mod-lib_cmos_datetime.lst
FSFILES += fs-datetime_mod-lib_cmos_datetime.lst
PARTTOOLFILES += parttool-datetime_mod-lib_cmos_datetime.lst
PARTMAPFILES += partmap-datetime_mod-lib_cmos_datetime.lst
HANDLERFILES += handler-datetime_mod-lib_cmos_datetime.lst
TERMINALFILES += terminal-datetime_mod-lib_cmos_datetime.lst
VIDEOFILES += video-datetime_mod-lib_cmos_datetime.lst

cmd-datetime_mod-lib_cmos_datetime.lst: lib/cmos_datetime.c $(lib/cmos_datetime.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Ilib -I$(srcdir)/lib $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(datetime_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh datetime > $@ || (rm -f $@; exit 1)

fs-datetime_mod-lib_cmos_datetime.lst: lib/cmos_datetime.c $(lib/cmos_datetime.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Ilib -I$(srcdir)/lib $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(datetime_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh datetime > $@ || (rm -f $@; exit 1)

parttool-datetime_mod-lib_cmos_datetime.lst: lib/cmos_datetime.c $(lib/cmos_datetime.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Ilib -I$(srcdir)/lib $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(datetime_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh datetime > $@ || (rm -f $@; exit 1)

partmap-datetime_mod-lib_cmos_datetime.lst: lib/cmos_datetime.c $(lib/cmos_datetime.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Ilib -I$(srcdir)/lib $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(datetime_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh datetime > $@ || (rm -f $@; exit 1)

handler-datetime_mod-lib_cmos_datetime.lst: lib/cmos_datetime.c $(lib/cmos_datetime.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Ilib -I$(srcdir)/lib $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(datetime_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh datetime > $@ || (rm -f $@; exit 1)

terminal-datetime_mod-lib_cmos_datetime.lst: lib/cmos_datetime.c $(lib/cmos_datetime.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Ilib -I$(srcdir)/lib $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(datetime_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh datetime > $@ || (rm -f $@; exit 1)

video-datetime_mod-lib_cmos_datetime.lst: lib/cmos_datetime.c $(lib/cmos_datetime.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Ilib -I$(srcdir)/lib $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(datetime_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh datetime > $@ || (rm -f $@; exit 1)

datetime_mod_CFLAGS = $(COMMON_CFLAGS)
datetime_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For ata_pthru.mod.
ata_pthru_mod_SOURCES = disk/ata_pthru.c

clean-module-ata_pthru.mod.1:
	rm -f ata_pthru.mod mod-ata_pthru.o mod-ata_pthru.c pre-ata_pthru.o ata_pthru_mod-disk_ata_pthru.o und-ata_pthru.lst

CLEAN_MODULE_TARGETS += clean-module-ata_pthru.mod.1

clean-module-ata_pthru.mod-symbol.1:
	rm -f def-ata_pthru.lst

CLEAN_MODULE_TARGETS += clean-module-ata_pthru.mod-symbol.1
DEFSYMFILES += def-ata_pthru.lst
mostlyclean-module-ata_pthru.mod.1:
	rm -f ata_pthru_mod-disk_ata_pthru.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-ata_pthru.mod.1
UNDSYMFILES += und-ata_pthru.lst

ifeq ($(TARGET_NO_MODULES), yes)
ata_pthru.mod: pre-ata_pthru.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(ata_pthru_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-ata_pthru.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
ata_pthru.mod: pre-ata_pthru.o mod-ata_pthru.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(ata_pthru_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-ata_pthru.o mod-ata_pthru.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ata_pthru.mod: pre-ata_pthru.o mod-ata_pthru.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(ata_pthru_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-ata_pthru.o mod-ata_pthru.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-ata_pthru.o: $(ata_pthru_mod_DEPENDENCIES) ata_pthru_mod-disk_ata_pthru.o
	-rm -f $@
	$(TARGET_CC) $(ata_pthru_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ ata_pthru_mod-disk_ata_pthru.o

mod-ata_pthru.o: mod-ata_pthru.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(ata_pthru_mod_CFLAGS) -DGRUB_FILE=\"mod-ata_pthru.c\" -c -o $@ $<

mod-ata_pthru.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'ata_pthru' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-ata_pthru.lst: pre-ata_pthru.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 ata_pthru/' > $@
else
def-ata_pthru.lst: pre-ata_pthru.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 ata_pthru/' > $@
endif

und-ata_pthru.lst: pre-ata_pthru.o
	echo 'ata_pthru' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

ata_pthru_mod-disk_ata_pthru.o: disk/ata_pthru.c $(disk/ata_pthru.c_DEPENDENCIES)
	$(TARGET_CC) -Idisk -I$(srcdir)/disk $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(ata_pthru_mod_CFLAGS) -DGRUB_FILE=\"disk/ata_pthru.c\" -MD -c -o $@ $<
-include ata_pthru_mod-disk_ata_pthru.d

clean-module-ata_pthru_mod-disk_ata_pthru-extra.1:
	rm -f cmd-ata_pthru_mod-disk_ata_pthru.lst fs-ata_pthru_mod-disk_ata_pthru.lst partmap-ata_pthru_mod-disk_ata_pthru.lst handler-ata_pthru_mod-disk_ata_pthru.lst parttool-ata_pthru_mod-disk_ata_pthru.lst video-ata_pthru_mod-disk_ata_pthru.lst terminal-ata_pthru_mod-disk_ata_pthru.lst

CLEAN_MODULE_TARGETS += clean-module-ata_pthru_mod-disk_ata_pthru-extra.1

COMMANDFILES += cmd-ata_pthru_mod-disk_ata_pthru.lst
FSFILES += fs-ata_pthru_mod-disk_ata_pthru.lst
PARTTOOLFILES += parttool-ata_pthru_mod-disk_ata_pthru.lst
PARTMAPFILES += partmap-ata_pthru_mod-disk_ata_pthru.lst
HANDLERFILES += handler-ata_pthru_mod-disk_ata_pthru.lst
TERMINALFILES += terminal-ata_pthru_mod-disk_ata_pthru.lst
VIDEOFILES += video-ata_pthru_mod-disk_ata_pthru.lst

cmd-ata_pthru_mod-disk_ata_pthru.lst: disk/ata_pthru.c $(disk/ata_pthru.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Idisk -I$(srcdir)/disk $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(ata_pthru_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh ata_pthru > $@ || (rm -f $@; exit 1)

fs-ata_pthru_mod-disk_ata_pthru.lst: disk/ata_pthru.c $(disk/ata_pthru.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Idisk -I$(srcdir)/disk $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(ata_pthru_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh ata_pthru > $@ || (rm -f $@; exit 1)

parttool-ata_pthru_mod-disk_ata_pthru.lst: disk/ata_pthru.c $(disk/ata_pthru.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Idisk -I$(srcdir)/disk $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(ata_pthru_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh ata_pthru > $@ || (rm -f $@; exit 1)

partmap-ata_pthru_mod-disk_ata_pthru.lst: disk/ata_pthru.c $(disk/ata_pthru.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Idisk -I$(srcdir)/disk $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(ata_pthru_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh ata_pthru > $@ || (rm -f $@; exit 1)

handler-ata_pthru_mod-disk_ata_pthru.lst: disk/ata_pthru.c $(disk/ata_pthru.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Idisk -I$(srcdir)/disk $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(ata_pthru_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh ata_pthru > $@ || (rm -f $@; exit 1)

terminal-ata_pthru_mod-disk_ata_pthru.lst: disk/ata_pthru.c $(disk/ata_pthru.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Idisk -I$(srcdir)/disk $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(ata_pthru_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh ata_pthru > $@ || (rm -f $@; exit 1)

video-ata_pthru_mod-disk_ata_pthru.lst: disk/ata_pthru.c $(disk/ata_pthru.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Idisk -I$(srcdir)/disk $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(ata_pthru_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh ata_pthru > $@ || (rm -f $@; exit 1)

ata_pthru_mod_CFLAGS = $(COMMON_CFLAGS)
ata_pthru_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For hdparm.mod.
hdparm_mod_SOURCES = commands/hdparm.c lib/hexdump.c

clean-module-hdparm.mod.1:
	rm -f hdparm.mod mod-hdparm.o mod-hdparm.c pre-hdparm.o hdparm_mod-commands_hdparm.o hdparm_mod-lib_hexdump.o und-hdparm.lst

CLEAN_MODULE_TARGETS += clean-module-hdparm.mod.1

clean-module-hdparm.mod-symbol.1:
	rm -f def-hdparm.lst

CLEAN_MODULE_TARGETS += clean-module-hdparm.mod-symbol.1
DEFSYMFILES += def-hdparm.lst
mostlyclean-module-hdparm.mod.1:
	rm -f hdparm_mod-commands_hdparm.d hdparm_mod-lib_hexdump.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-hdparm.mod.1
UNDSYMFILES += und-hdparm.lst

ifeq ($(TARGET_NO_MODULES), yes)
hdparm.mod: pre-hdparm.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(hdparm_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-hdparm.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
hdparm.mod: pre-hdparm.o mod-hdparm.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(hdparm_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-hdparm.o mod-hdparm.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
hdparm.mod: pre-hdparm.o mod-hdparm.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(hdparm_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-hdparm.o mod-hdparm.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-hdparm.o: $(hdparm_mod_DEPENDENCIES) hdparm_mod-commands_hdparm.o hdparm_mod-lib_hexdump.o
	-rm -f $@
	$(TARGET_CC) $(hdparm_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ hdparm_mod-commands_hdparm.o hdparm_mod-lib_hexdump.o

mod-hdparm.o: mod-hdparm.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(hdparm_mod_CFLAGS) -DGRUB_FILE=\"mod-hdparm.c\" -c -o $@ $<

mod-hdparm.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'hdparm' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-hdparm.lst: pre-hdparm.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 hdparm/' > $@
else
def-hdparm.lst: pre-hdparm.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 hdparm/' > $@
endif

und-hdparm.lst: pre-hdparm.o
	echo 'hdparm' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

hdparm_mod-commands_hdparm.o: commands/hdparm.c $(commands/hdparm.c_DEPENDENCIES)
	$(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(hdparm_mod_CFLAGS) -DGRUB_FILE=\"commands/hdparm.c\" -MD -c -o $@ $<
-include hdparm_mod-commands_hdparm.d

clean-module-hdparm_mod-commands_hdparm-extra.1:
	rm -f cmd-hdparm_mod-commands_hdparm.lst fs-hdparm_mod-commands_hdparm.lst partmap-hdparm_mod-commands_hdparm.lst handler-hdparm_mod-commands_hdparm.lst parttool-hdparm_mod-commands_hdparm.lst video-hdparm_mod-commands_hdparm.lst terminal-hdparm_mod-commands_hdparm.lst

CLEAN_MODULE_TARGETS += clean-module-hdparm_mod-commands_hdparm-extra.1

COMMANDFILES += cmd-hdparm_mod-commands_hdparm.lst
FSFILES += fs-hdparm_mod-commands_hdparm.lst
PARTTOOLFILES += parttool-hdparm_mod-commands_hdparm.lst
PARTMAPFILES += partmap-hdparm_mod-commands_hdparm.lst
HANDLERFILES += handler-hdparm_mod-commands_hdparm.lst
TERMINALFILES += terminal-hdparm_mod-commands_hdparm.lst
VIDEOFILES += video-hdparm_mod-commands_hdparm.lst

cmd-hdparm_mod-commands_hdparm.lst: commands/hdparm.c $(commands/hdparm.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(hdparm_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh hdparm > $@ || (rm -f $@; exit 1)

fs-hdparm_mod-commands_hdparm.lst: commands/hdparm.c $(commands/hdparm.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(hdparm_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh hdparm > $@ || (rm -f $@; exit 1)

parttool-hdparm_mod-commands_hdparm.lst: commands/hdparm.c $(commands/hdparm.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(hdparm_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh hdparm > $@ || (rm -f $@; exit 1)

partmap-hdparm_mod-commands_hdparm.lst: commands/hdparm.c $(commands/hdparm.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(hdparm_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh hdparm > $@ || (rm -f $@; exit 1)

handler-hdparm_mod-commands_hdparm.lst: commands/hdparm.c $(commands/hdparm.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(hdparm_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh hdparm > $@ || (rm -f $@; exit 1)

terminal-hdparm_mod-commands_hdparm.lst: commands/hdparm.c $(commands/hdparm.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(hdparm_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh hdparm > $@ || (rm -f $@; exit 1)

video-hdparm_mod-commands_hdparm.lst: commands/hdparm.c $(commands/hdparm.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Icommands -I$(srcdir)/commands $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(hdparm_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh hdparm > $@ || (rm -f $@; exit 1)

hdparm_mod-lib_hexdump.o: lib/hexdump.c $(lib/hexdump.c_DEPENDENCIES)
	$(TARGET_CC) -Ilib -I$(srcdir)/lib $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(hdparm_mod_CFLAGS) -DGRUB_FILE=\"lib/hexdump.c\" -MD -c -o $@ $<
-include hdparm_mod-lib_hexdump.d

clean-module-hdparm_mod-lib_hexdump-extra.1:
	rm -f cmd-hdparm_mod-lib_hexdump.lst fs-hdparm_mod-lib_hexdump.lst partmap-hdparm_mod-lib_hexdump.lst handler-hdparm_mod-lib_hexdump.lst parttool-hdparm_mod-lib_hexdump.lst video-hdparm_mod-lib_hexdump.lst terminal-hdparm_mod-lib_hexdump.lst

CLEAN_MODULE_TARGETS += clean-module-hdparm_mod-lib_hexdump-extra.1

COMMANDFILES += cmd-hdparm_mod-lib_hexdump.lst
FSFILES += fs-hdparm_mod-lib_hexdump.lst
PARTTOOLFILES += parttool-hdparm_mod-lib_hexdump.lst
PARTMAPFILES += partmap-hdparm_mod-lib_hexdump.lst
HANDLERFILES += handler-hdparm_mod-lib_hexdump.lst
TERMINALFILES += terminal-hdparm_mod-lib_hexdump.lst
VIDEOFILES += video-hdparm_mod-lib_hexdump.lst

cmd-hdparm_mod-lib_hexdump.lst: lib/hexdump.c $(lib/hexdump.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Ilib -I$(srcdir)/lib $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(hdparm_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh hdparm > $@ || (rm -f $@; exit 1)

fs-hdparm_mod-lib_hexdump.lst: lib/hexdump.c $(lib/hexdump.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Ilib -I$(srcdir)/lib $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(hdparm_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh hdparm > $@ || (rm -f $@; exit 1)

parttool-hdparm_mod-lib_hexdump.lst: lib/hexdump.c $(lib/hexdump.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Ilib -I$(srcdir)/lib $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(hdparm_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh hdparm > $@ || (rm -f $@; exit 1)

partmap-hdparm_mod-lib_hexdump.lst: lib/hexdump.c $(lib/hexdump.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Ilib -I$(srcdir)/lib $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(hdparm_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh hdparm > $@ || (rm -f $@; exit 1)

handler-hdparm_mod-lib_hexdump.lst: lib/hexdump.c $(lib/hexdump.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Ilib -I$(srcdir)/lib $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(hdparm_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh hdparm > $@ || (rm -f $@; exit 1)

terminal-hdparm_mod-lib_hexdump.lst: lib/hexdump.c $(lib/hexdump.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Ilib -I$(srcdir)/lib $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(hdparm_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh hdparm > $@ || (rm -f $@; exit 1)

video-hdparm_mod-lib_hexdump.lst: lib/hexdump.c $(lib/hexdump.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Ilib -I$(srcdir)/lib $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(hdparm_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh hdparm > $@ || (rm -f $@; exit 1)

hdparm_mod_CFLAGS = $(COMMON_CFLAGS)
hdparm_mod_LDFLAGS = $(COMMON_LDFLAGS)

# For cmostest.mod
pkglib_MODULES += cmostest.mod
cmostest_mod_SOURCES = commands/i386/cmostest.c

clean-module-cmostest.mod.1:
	rm -f cmostest.mod mod-cmostest.o mod-cmostest.c pre-cmostest.o cmostest_mod-commands_i386_cmostest.o und-cmostest.lst

CLEAN_MODULE_TARGETS += clean-module-cmostest.mod.1

clean-module-cmostest.mod-symbol.1:
	rm -f def-cmostest.lst

CLEAN_MODULE_TARGETS += clean-module-cmostest.mod-symbol.1
DEFSYMFILES += def-cmostest.lst
mostlyclean-module-cmostest.mod.1:
	rm -f cmostest_mod-commands_i386_cmostest.d

MOSTLYCLEAN_MODULE_TARGETS += mostlyclean-module-cmostest.mod.1
UNDSYMFILES += und-cmostest.lst

ifeq ($(TARGET_NO_MODULES), yes)
cmostest.mod: pre-cmostest.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(cmostest_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-cmostest.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
ifneq ($(TARGET_APPLE_CC),1)
cmostest.mod: pre-cmostest.o mod-cmostest.o $(TARGET_OBJ2ELF)
	-rm -f $@
	$(TARGET_CC) $(cmostest_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ pre-cmostest.o mod-cmostest.o
	if test ! -z "$(TARGET_OBJ2ELF)"; then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K grub_mod_init -K grub_mod_fini -K _grub_mod_init -K _grub_mod_fini -R .note -R .comment $@; fi
else
cmostest.mod: pre-cmostest.o mod-cmostest.o $(TARGET_OBJ2ELF)
	-rm -f $@
	-rm -f $@.bin
	$(TARGET_CC) $(cmostest_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@.bin pre-cmostest.o mod-cmostest.o
	$(OBJCONV) -f$(TARGET_MODULE_FORMAT) -nr:_grub_mod_init:grub_mod_init -nr:_grub_mod_fini:grub_mod_fini -wd1106 -ew2030 -ew2050 -nu -nd $@.bin $@
	-rm -f $@.bin
endif
endif

pre-cmostest.o: $(cmostest_mod_DEPENDENCIES) cmostest_mod-commands_i386_cmostest.o
	-rm -f $@
	$(TARGET_CC) $(cmostest_mod_LDFLAGS) $(TARGET_LDFLAGS) -Wl,-r,-d -o $@ cmostest_mod-commands_i386_cmostest.o

mod-cmostest.o: mod-cmostest.c
	$(TARGET_CC) $(TARGET_CPPFLAGS) $(TARGET_CFLAGS) $(cmostest_mod_CFLAGS) -DGRUB_FILE=\"mod-cmostest.c\" -c -o $@ $<

mod-cmostest.c: $(builddir)/moddep.lst $(srcdir)/genmodsrc.sh
	sh $(srcdir)/genmodsrc.sh 'cmostest' $< > $@ || (rm -f $@; exit 1)

ifneq ($(TARGET_APPLE_CC),1)
def-cmostest.lst: pre-cmostest.o
	$(NM) -g --defined-only -P -p $< | sed 's/^\([^ ]*\).*/\1 cmostest/' > $@
else
def-cmostest.lst: pre-cmostest.o
	$(NM) -g -P -p $< | grep -E '^[a-zA-Z0-9_]* [TDS]'  | sed 's/^\([^ ]*\).*/\1 cmostest/' > $@
endif

und-cmostest.lst: pre-cmostest.o
	echo 'cmostest' > $@
	$(NM) -u -P -p $< | cut -f1 -d' ' >> $@

cmostest_mod-commands_i386_cmostest.o: commands/i386/cmostest.c $(commands/i386/cmostest.c_DEPENDENCIES)
	$(TARGET_CC) -Icommands/i386 -I$(srcdir)/commands/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(cmostest_mod_CFLAGS) -DGRUB_FILE=\"commands/i386/cmostest.c\" -MD -c -o $@ $<
-include cmostest_mod-commands_i386_cmostest.d

clean-module-cmostest_mod-commands_i386_cmostest-extra.1:
	rm -f cmd-cmostest_mod-commands_i386_cmostest.lst fs-cmostest_mod-commands_i386_cmostest.lst partmap-cmostest_mod-commands_i386_cmostest.lst handler-cmostest_mod-commands_i386_cmostest.lst parttool-cmostest_mod-commands_i386_cmostest.lst video-cmostest_mod-commands_i386_cmostest.lst terminal-cmostest_mod-commands_i386_cmostest.lst

CLEAN_MODULE_TARGETS += clean-module-cmostest_mod-commands_i386_cmostest-extra.1

COMMANDFILES += cmd-cmostest_mod-commands_i386_cmostest.lst
FSFILES += fs-cmostest_mod-commands_i386_cmostest.lst
PARTTOOLFILES += parttool-cmostest_mod-commands_i386_cmostest.lst
PARTMAPFILES += partmap-cmostest_mod-commands_i386_cmostest.lst
HANDLERFILES += handler-cmostest_mod-commands_i386_cmostest.lst
TERMINALFILES += terminal-cmostest_mod-commands_i386_cmostest.lst
VIDEOFILES += video-cmostest_mod-commands_i386_cmostest.lst

cmd-cmostest_mod-commands_i386_cmostest.lst: commands/i386/cmostest.c $(commands/i386/cmostest.c_DEPENDENCIES) gencmdlist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386 -I$(srcdir)/commands/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(cmostest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/gencmdlist.sh cmostest > $@ || (rm -f $@; exit 1)

fs-cmostest_mod-commands_i386_cmostest.lst: commands/i386/cmostest.c $(commands/i386/cmostest.c_DEPENDENCIES) genfslist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386 -I$(srcdir)/commands/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(cmostest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genfslist.sh cmostest > $@ || (rm -f $@; exit 1)

parttool-cmostest_mod-commands_i386_cmostest.lst: commands/i386/cmostest.c $(commands/i386/cmostest.c_DEPENDENCIES) genparttoollist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386 -I$(srcdir)/commands/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(cmostest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genparttoollist.sh cmostest > $@ || (rm -f $@; exit 1)

partmap-cmostest_mod-commands_i386_cmostest.lst: commands/i386/cmostest.c $(commands/i386/cmostest.c_DEPENDENCIES) genpartmaplist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386 -I$(srcdir)/commands/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(cmostest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genpartmaplist.sh cmostest > $@ || (rm -f $@; exit 1)

handler-cmostest_mod-commands_i386_cmostest.lst: commands/i386/cmostest.c $(commands/i386/cmostest.c_DEPENDENCIES) genhandlerlist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386 -I$(srcdir)/commands/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(cmostest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genhandlerlist.sh cmostest > $@ || (rm -f $@; exit 1)

terminal-cmostest_mod-commands_i386_cmostest.lst: commands/i386/cmostest.c $(commands/i386/cmostest.c_DEPENDENCIES) genterminallist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386 -I$(srcdir)/commands/i386 $(TARGET_CPPFLAGS)  $(TARGET_CFLAGS) $(cmostest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genterminallist.sh cmostest > $@ || (rm -f $@; exit 1)

video-cmostest_mod-commands_i386_cmostest.lst: commands/i386/cmostest.c $(commands/i386/cmostest.c_DEPENDENCIES) genvideolist.sh
	set -e; 	  $(TARGET_CC) -Icommands/i386 -I$(srcdir)/commands/i386 $(TARGET_CPPFLAGS)  -DGRUB_LST_GENERATOR $(TARGET_CFLAGS) $(cmostest_mod_CFLAGS) -E $< 	  | sh $(srcdir)/genvideolist.sh cmostest > $@ || (rm -f $@; exit 1)

cmostest_mod_CFLAGS = $(COMMON_CFLAGS)
cmostest_mod_LDFLAGS = $(COMMON_LDFLAGS)

ifeq ($(enable_efiemu), yes)

efiemu32.o: efiemu/runtime/efiemu.c $(TARGET_OBJ2ELF)
	-rm -f $@
ifeq ($(TARGET_APPLE_CC), 1)
	-rm -f $@.bin
	$(TARGET_CC) -c -m32 -DELF32 -DAPPLE_CC -o $@.bin -Wall -Werror $< -nostdlib -O2 -I$(srcdir)/efiemu/runtime -I$(srcdir)/include -Iinclude
	$(OBJCONV) -felf32 -nu -nd $@.bin $@
	-rm -f $@.bin
else
	$(TARGET_CC) -c -m32 -DELF32 -o $@ -Wall -Werror $< -nostdlib -O2 -I$(srcdir)/efiemu/runtime -I$(srcdir)/include -Iinclude
	if test ! -z $(TARGET_OBJ2ELF); then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
endif

efiemu64_c.o: efiemu/runtime/efiemu.c
ifeq ($(TARGET_APPLE_CC), 1)
	$(TARGET_CC) -c -m64 -DAPPLE_CC=1 -DELF64 -o $@ -Wall -Werror $< -nostdlib -mno-red-zone -O2 -I$(srcdir)/efiemu/runtime -I$(srcdir)/include -Iinclude
else
	$(TARGET_CC) -c -m64 -DELF64 -o $@ -Wall -Werror $< -nostdlib  -mcmodel=large -mno-red-zone -O2 -I$(srcdir)/efiemu/runtime -I$(srcdir)/include -Iinclude
endif

efiemu64_s.o: efiemu/runtime/efiemu.S
	-rm -f $@
ifeq ($(TARGET_APPLE_CC), 1)
	$(TARGET_CC) -c -m64 -DAPPLE_CC=1 -DELF64 -o $@ -Wall -Werror $< -nostdlib -mno-red-zone -O2 -I$(srcdir)/efiemu/runtime -I$(srcdir)/include -Iinclude
else
	$(TARGET_CC) -c -m64 -DELF64 -o $@ -Wall -Werror $< -nostdlib  -mcmodel=large -mno-red-zone -O2 -I$(srcdir)/efiemu/runtime -I$(srcdir)/include -Iinclude
endif

efiemu64.o: efiemu64_c.o efiemu64_s.o  $(TARGET_OBJ2ELF)
	-rm -f $@
ifeq ($(TARGET_APPLE_CC), 1)
	-rm -f $@.bin
	$(TARGET_CC) -m64 -o $@.bin -Wl,-r $^ -nostdlib
	$(OBJCONV) -felf64 -nu -nd $@.bin $@
	-rm -f $@.bin
else
	$(TARGET_CC) -m64 -o $@ -Wl,-r $^ -nostdlib
	if test ! -z $(TARGET_OBJ2ELF); then ./$(TARGET_OBJ2ELF) $@ || (rm -f $@; exit 1); fi
endif

CLEANFILES += efiemu32.o efiemu64.o efiemu64_c.o efiemu64_s.o
pkglib_DATA += efiemu32.o efiemu64.o

endif

include $(srcdir)/conf/i386.mk
include $(srcdir)/conf/common.mk
grub-setup: $(grub_setup_DEPENDENCIES) $(grub_setup_OBJECTS)
	$(CC) -o $@ $(grub_setup_OBJECTS) $(LDFLAGS) $(grub_setup_LDFLAGS)

CLEANFILES += kernel.img $(kernel_img_OBJECTS)
ifeq ($(kernel_img_RELOCATABLE),yes)
kernel.img: $(kernel_img_DEPENDENCIES) $(kernel_img_OBJECTS)
	$(TARGET_CC) -Wl,-r,-d -o $@ $(kernel_img_OBJECTS) $(TARGET_LDFLAGS) $(kernel_img_LDFLAGS)
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) --strip-unneeded -K start -R .note -R .comment $@; fi
else
kernel.img: $(kernel_img_DEPENDENCIES) $(kernel_img_OBJECTS)
	$(TARGET_CC) -o $@ $(kernel_img_OBJECTS) $(TARGET_LDFLAGS) $(kernel_img_LDFLAGS)
	if test x$(TARGET_NO_STRIP) != xyes ; then $(STRIP) -R .rel.dyn -R .reginfo -R .note -R .comment $@; fi
endif

